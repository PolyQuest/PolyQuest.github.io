polymorph true
:start
html true
btn_visible false
inv_visible false
style_backcolor = "#FFFFC8"
goto code

:-10
<html>
<div align="center"><img src="#quest_path$/Img/Cover.jpg" class="foto"></div><br>
<HR><br>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ</center>
Прежде чем отправиться в путешествие, вы можете <a href=btn:-9>ознакомиться с правилами игры</a>. Если же вы уже знакомы с ними, тогда <a href=btn:-2>вперед</a>!<br>
</html>

end

:-9
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
Перед тем как отправиться в путешествие,  необходимо определить, насколько вы сильный,  выносливый, искусный и обаятельный воин, то есть установить изначальные ЛОВКОСТЬ, СИЛУ и ОБАЯНИЕ.<br>
ЛОВКОСТЬ  - это умение владеть мечом, сражаться, противостоять  врагам. Иногда это и обычная ловкость рук. Одним словом, ваши физические возможности. Естественно, чем больше Ловкость, тем лучше, однако было бы наивно полагать, что все приключения рассчитаны только на здоровяков и сорвиголов. Не расстраивайтесь, если ваша изначальная ЛОВКОСТЬ будет не так высока, как хотелось бы, - есть немало других способов победить, не хватаясь каждые пять минут за оружие.<br><br>
<a href=btn:-8>Продолжите чтение правил</a> или <a href=btn:-2>начнете игру</a>?
</html>

end

:-8
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
СИЛА - это прежде всего показатель вашего здоровья на данный момент. Она отражает не только наличие или отсутствие мускул, но также и волю к жизни, решимость довести начатое дело до конца. Ведь и в действительности, когда говорят "сильный человек" - это не только про штангиста. Если показатель СИЛЫ становится равен нулю, вы погибаете, и придется начинать все сначала. Во время путешествия вы можете терять силы от усталости или ранений (вы даже можете внезапно умереть от истощения) или же, наоборот, восстанавливать их в результате отдыха или сытного обеда.<br>
ОБАЯНИЕ. Нередко для того, чтобы куда-нибудь попасть, совсем не обязательно применять силу. Например, чтобы вас пропустили, вы можете попытаться уговорить, убедить собеседника, рассказывая правдивые или выдуманные истории. И здесь на помощь придет проверка ОБАЯНИЯ. В случае успеха знайте, что ОБАЯНИЕ увеличилось на одну единицу, что окажется небесполезным в следующий раз. Если оно будет больше 12, в дальнейшем проверять его не имеет смысла. Вы чертовски обаятельны и можете смело этим пользоваться. Но верно и обратное. Если подстерегает неудача, ОБАЯНИЕ уменьшится также на одну единицу (что, разумеется, не мешает ему в следующий раз вновь повыситься). Однако если оно упало до 5, дальнейшие проверки опять же бессмысленны. Бывают люди настолько не внушающие доверия, что им никто не верит, даже если они говорят чистую правду. Отныне до конца игры вы становитесь именно таким человеком.<br><br>
<a href=btn:-7>Продолжите чтение правил</a> или <a href=btn:-2>начнете игру</a>?
</html>

end

:-7
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
Все три параметра для вас определит программа при каждом начале игры. Но учтите: в ходе путешествия вы крайне редко сумеете превысить эти изначальные параметры.<br>
Но у каждого искателя приключений есть и еще один параметр: УДАЧА. По сути дела, это благосклонность к вам Судьбы. В трудном путешествии не раз придется полагаться на волю случая и уповать только на свое везение. В таком случае вам будет предлагаться ПРОВЕРИТЬ СВОЮ УДАЧУ. Повезло вам или нет, без труда определит программа. По сути, здесь просто кидается кубик и выпавшая на нем грань зачеркивается. При этом, если при определении удачи в будущем снова выпадет эта грань, считается, что вам не повезло. А если при проверке удачи выпавшая грань кубика еще не зачеркнута, считается, что вы удачливы. Отображаемый параметр УДАЧА определяется количеством незачеркнутых граней кубика. Перед началом путешествия программа два раза проверяет удачу. Таким образом, одна или две грани кубика (уж как повезет) должны быть зачеркнуты еще до начала путешествия. Очень скоро станет понятно, что чем больше вы полагаетесь на удачу, тем меньше остается шансов на везение в будущем. Поэтому каждый раз, когда вам предложат ПРОВЕРИТЬ СВОЮ УДАЧУ, не обязательно проверять ее, но тогда придется считать, что вам не повезло. Кроме того, не исключено, что в дороге попадутся вещи, восстанавливающие удачу.<br><br>
<a href=btn:-6>Продолжите чтение правил</a> или <a href=btn:-2>начнете игру</a>?
</html>

end

:-6
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
На страницах книги вы нередко будете встречать врагов, с которыми придется сражаться. Если нет возможности избежать боя, а также если вы сами этого не хотите, поступайте следующим образом. Бой происходит пошагово: сначала вы, потом ваш противник. Цифры на экране покажут, сколько у него и у вас осталось сил. Каждый раз, когда вы нажмете кнопку "Сражаться", программа проведет один раунд боя.<br>
При определении победившего в раунде боя будет принята в расчет ваша Ловкость и Ловкость противника. Может так случиться, что вы просто обменяетесь ударами, но чаще всего один из вас будет ранен. При ранении необходимо вычесть из СИЛЫ раненого определенное количество единиц, в зависимости от того, чем нанесена рана. Ваш меч при каждом ранении отнимет у противника 2 СИЛЫ. Если специально не оговорено, к потере скольких единиц СИЛЫ приведет ранение вас противником, — вы каждый раз должны терять 2 СИЛЫ. Если ситуация иная, в тексте будет обязательно об этом сказано. Если Сила одного из сражающихся становится равна нулю, он погиб. Иногда вам придется сражаться не с одним, а с несколькими врагами одновременно. В этом случае перед началом каждого Раунда атаки выберите, в чью сторону будет направлен ваш удар. При этом с выбранным вами противником вы сражаетесь так же, как описано выше. Но, кроме того, ваша МОЩНОСТЬ УДАРА сравнивается с МОЩНОСТЬЮ УДАРА остальных врагов, поскольку каждый, у кого она будет больше вашей, ранит вас. Вы же можете ранить только своего непосредственного противника, даже если ваша МОЩНОСТЬ УДАРА больше, чем у остальных.<br><br>
<a href=btn:-5>Продолжите чтение правил</a> или <a href=btn:-2>начнете игру</a>?
</html>

end

:-5
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
Как будет сказано чуть позже, перед началом пути вам дается ЕДА на три дня. Каждая ЕДА сможет восстановить 4 СИЛЫ. При этом можно есть, не дожидаясь специального приглашения книги, в любой момент, когда почувствуете голод. Но только не во время боя! У вас будут не настолько легкие противники, чтобы бороться с ними с полным ртом.<br>
Для еды, а также всего, что только найдете или приобретете по пути, у вас с собой будет заплечный мешок. Однако он не бездонен - в нем есть место только для семи предметов. Еда на три дня займет место одного из них. Если впоследствии мешок будет полон, а вам захочется прихватить с собой что-нибудь еще, что-то придется выложить. Но не расстраивайтесь: далеко не все находки пригодятся в пути.<br><br>
<a href=btn:-4>Продолжите чтение правил</a> или <a href=btn:-2>начнете игру</a>?
</html>

end

:-4
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
На каждом экране вы увидите одну или несколько ссылок, по которым сможете пойти. В зависимости от вашего выбора будет меняться и сюжет игры. При этом не только одни и те же эпизоды можно проходить по-разному в зависимости от вашего желания. Можем вам пообещать, что пройдя игру до конца и даже выиграв, вы еще оставите для себя немало мест, в которых стоит побывать.<br><br>
<a href=btn:-3>Продолжите чтение правил</a> или <a href=btn:-2>начнете игру</a>?
</html>

end

:-3
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ПРАВИЛА ИГРЫ</center><br>
Теперь несколько слов о работе программы.<br><br>
На панели в нижней части экрана вы видите 5 кнопок. Это заплечный мешок, оружие, одежда, украшения (или другие предметы на человеке), заклятия. Те предметы из этих категорий, для которых есть соответствующие графические изображения, будут отображаться при нажатии кнопки выбранной категории. Все прочие предметы, которые вы можете нести с собой, помещаются в инвентаре в правой части игрового окна.<br>
Выделенные в тексте слова бывают двух типов: переходы на следующие параграфы и предметы, которые можно взять  с собой. Поэтому если в тексте вам предлагается взять какой-либо предмет, то щелкните на выделенном слове и этот предмет окажется у вас. В данной реализации игры нет ограничения на количество предметов в заплечном мешке - игра и без того непростая, поэтому можете смело брать все, что попадается вам по пути. Чтобы съесть еду из заплечного мешка, дважды щелкните левой кнопкой мыши на изображении еды. Об использовании прочих предметов вам беспокоиться не придется - когда по тексту книги вам будет предложено использовать какой-либо из них или совершить действие, соответствующие слова будут подчеркнуты и вы сможете щелкнуть по ним.<br><br>
И ЧТО БЫ НИ СЛУЧИЛОСЬ В ПУТИ,<br>
ПОМНИТЕ: <a href=btn:-2>ВСЕ ЗАВИСИТ ТОЛЬКО ОТ ВАС</a>!
</html>

end

:-2
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ВСТУПЛЕНИЕ</center><br>
Королевству Элгариол и всему Средиземью вновь угрожает опасность - на этот раз, черный маг Саурон, зловещая тень властелина первородного Зла Моргота. Затопить весь мир Тьмою ему мешает только одно - Кольцо Всевластья, выкованное эльфийскими кузнецами, потеряно им много веков назад и заботливо сберегается Советом Мудрых. Кольцо Всевластья нельзя уничтожить. Оно не горит в пламени, его нельзя расплющить или разорвать - древняя магия надежно защищает его. Единственная возможность - сбросить кольцо в огненное жерло горы Ородруин, из недр которой оно произошло. Однако это рискованный и крайне опасный путь, так как Ородруин находится в самом центре владений Саурона - <a href=btn:-1>Мордоре</a>.
</html>

end

:-1
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ВСТУПЛЕНИЕ</center><br>
Кольцо коварно и опасно. Оно может сделать невидимкой своего обладателя, если надеть его на палец, но от частых употреблений тот начинает развоплощаться и превращается в кольценосца - призрака, покорного владыке Тьмы. Оно может также предательски выскользнуть из рук, поэтому надежнее будет прикрепить его цепочкой к собственному поясу и скрыть от взора посторонних в одном из карманов.
Разумеется, во всем Средиземье найдется мало героев, способных проникнуть в Мордор с Кольцом Всевластья, а следовательно, подвергнуть опасности судьбу Мироздания. И <a href=btn:0>выбор падает на вас</a>, знаменитого победителя зловещих магов Барлада Дэрта, Анчера Шора и Вильяма Шелтона.
</html>

end

:0
RingUsed=0
Sword=1
onHorse=1
inv+ 4,Алмаз
let param=15
proc addGold
inv_visible true
<script>
if (newGame) { addItem('Меч'); addItem('Кинжал Майлина'); addItem('Кольцо Всевластья'); addItem('Еда'); addItem('Еда'); }
</script>
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ. ВСТУПЛЕНИЕ</center><br>
Но как вы сможете противостоять могущественному колдуну? Придворный астролог Майлин дарит вам светящийся в темноте кинжал (слабое утешение) и исписанную эльфийскими рунами диадему, которая, по его мнению, должна вас защитить. Однако три из ее семи бриллиантов утрачены, неизвестная сила уничтожает в королевстве все алмазы, а поскольку Майлин опасается, что оставшихся четырех недостаточно, остальные вам придется обрести в пути. Из-за того, что злая воля уничтожает также сапфиры, астролог советует не обходить вниманием и эти камни.
Король Элгариола отпускает вам на дорогу 15 золотых и еду на два дня (каждая восстановит 4 силы). Верный конь и меч также будут с вами к началу пути, так что если опасности и приключения не пугают вас, вы вновь решаете <a href=btn:1>бросить вызов Злу</a>.
</html>

end

:1
track=1
proc endmusicloop
<html>
<center>ПОВЕЛИТЕЛЬ ТЬМЫ</center>
Покинув границы Элгариола, вы устремляетесь по неизведанным, полным опасности равнинам Эриадора. От раздумий вас отвлекает первый перекресток дорог. Куда вы отправитесь: <a href=btn:217>на север</a>, по Великому Тракту, <a href=btn:68>на северо-восток</a>, к тенистым дубравам леса Фангорн или <a href=btn:182>на северо-запад</a>, к крепости Изенгард?
</html>

end

:2
<html>
<a href="javascript: CheckCharm('67', '111')">Проверьте ваше обаяние</a>.
</html>

end

:3
<script>
expr_action = 'AgilityFactor = 2; fightStart(10,12,"ПЕРВЫЙ ТРОЛЛЬ",10,8,"ВТОРОЙ ТРОЛЛЬ"); afterBattle("25")'
</script>
<html>
Вы трубите в рог, призывая на помощь Йарвена и чувствуете, как во время боя ваша ловкость увеличивается на 2 единицы. Теперь <a href="javascript: eval(expr_action)">сражайтесь</a>.
</html>

end

:4
<script>
modifyGold(-11);
expr_action = 'if (Gold > 0) { modifyGold(-1); if (Strength < Max_Strength) modifyStrength(2); } else alert("У Вас не хватает денег!")';
</script>
<html>
За 1 золотой вы ночуете у хозяина (можете <a href="javascript: eval(expr_action)">восстановить 2 силы</a>), а утром <a href=btn:236>отправляетесь в путь</a> (вычеркните 11 золотых с листка путешественника) и к полудню он оставляет вас на берегах Рунного озера.
</html>

end

:5
inv+ Алмаз
<script>
IncreaseLuck();
</script>
<html>
Вот и награда за победу - огромных размеров алмаз на куче сундуков, забитых золотом. Присовокупив его к убранству элгариольской диадемы и почистив один из квадратов удачи, вы выходите из пещеры. Предпочтёте <a href=btn:130>исследовать вторую</a> или <a href=btn:33>поспешите на вершину Ородруина</a>?
</html>

end

:6
<html>
Не мешкая, вы <a href=btn:85>бросаетесь в каменные туннели Мории</a>. Здесь злая воля бессильна. Желание одеть кольцо пропадает.
</html>

end

:7
<script>
if (newGame) CheckLuck();
</script>
<html>
Вы <a href=btn:117>отправляетесь дальше</a>, не будучи до конца уверенным, что сделали правильно, убив представителя Светлых Сил. Киньте кубик и зачеркните выпавшее на нем число удачи.
</html>

end

:8
proc lose
<html>
Саурон некоторое время смотрит в кратер, где горит его Кольцо Всевластья, а затем оборачивает на вас свой взор, обдавая ледяным дыханием Смерти. Вернуться в Элгариол вам уже не суждено, а волшебные камни на вашей диадеме, теряя блеск, превращаются в битое стекло...
</html>

end

:9
<html>
Предпочтете путь <a href=btn:70>на восток</a>, к реке Быстротечной или <a href=btn:73>на запад</a>, в Бурые Равнины?
</html>

end

:10
<html>
<a href=btn:96>Покинете Летописный чертог</a> или <a href=btn:23>попробуете найти что-нибудь еще</a>?
</html>

end

:11
<script>
expr_action = 'if (UrqEval("1 Перстень с топазом")) { readParagraph("77"); void(0); } else alert("У Вас нет такой вещи!")';
</script>
<html>
В самом центре Фангорна утопает в зелени дворец эльфийского короля Лориэн. Если у вас есть <a href="javascript: eval(expr_action)">перстень с топазом</a>, можете попытаться увидется с королем##59$ если нет, можете либо <a href=btn:95>обойти дворец стороной</a> либо, надев Кольцо, <a href=btn:119>невидимкой пробраться в королевскую сокровищницу</a>.
</html>

end

:12
<html>
На стенах, покрытых плесенью, треснувшая коллекция оружия. <a href=btn:21>Попробуйте что-нибудь взять для себя</a> или <a href=btn:103>продолжите осмотр</a>?
</html>

end

:13
RingUsed=RingUsed+1
<html>
Не в силах противостоять злой воле, вы надеваете Кольцо на палец и чувствуете присутствие Черного Мага, как если бы он находился рядом. С трудом оторвав его от пальца, вы понимаете, что Враг перехитрил вас и отныне знает, где и в чьих руках находится Кольцо Всевластья. Что ж, может быть, <a href=btn:85>морийские лабиринты послужат вам убежищем хотя бы на время</a>.
</html>

end

:14
<html>
При вашем прикосновении грозное на вид оружие <a href=btn:103>обращается в прах</a>.
</html>

end

:15
param=4
proc addStrength
<html>
На пороге радушный розовощекий хозяин, который, кажется, даже рад вашему появлению. Поужинав (можете восстановить 4 силы), он расспрашивает вас о цели путешествия. Конечно, вы не знаете, можно ли доверять ему, но ваши губы сами начинают рассказ, пока утаивать становиться нечего. Здесь явно не обходится без магии, но перед вами друг - повелитель Вековечного Леса Йарвен. Узнав о том, что вы исполнены решимости бороться со злом и желая помочь вам, он крайне не советует сворачивать к крепости Изенгард, ибо, по его словам, уже много лет, как там <a href=btn:218>поселилось Зло</a>.
</html>

end

:16
inv+ Перстень с изумрудом
<html>
К вечеру вы достигаете окраины Черного леса. Ваш спутник сбрасывает плащ, и вы видите перед собой благородных кровей принца в расшитом золотом камзоле. "Меня зовут Арагорн, путник, - говорит он. - Я потомок древних королей Арнора, земли которых поглотила Тьма. Твой путь труден и опасен, но чары врага не всесильны". Если вы доберетесь до Мордора и вам будут нужны союзники, прибавьте 80 к номеру параграфа, на котором будете находиться. Вы с удивлением благодарите принца, который, пожелав удачи, оставляет вам перстень с изумрудом<!-- (+80)--> и <a href=btn:304>исчезает в сумерках</a>.
</html>

end

:17
if 1 Перстень с изумрудом then str1="<a href=btn:97>Арагорна?</a>" else str1="Арагорна?"
if 1 Охотничий рог then str2="<a href=btn:3>Йарвена?</a>" else str2="Йарвена?"
if 1 Перстень с рубином then str3="<a href=btn:157>воинов Гондора?</a>" else str3="воинов Гондора?"
<html>
Кого вы хотите призвать в помощь? #str1$ #str2$ Или #str3$
</html>

end

:18
<script>
expr_action = "if (UrqEval('1 Медальон с эмблемой Мустангрима')) { readParagraph('87'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Резко осадив коней, ристанийцы говорят, что неподалеку от вас видели отряд орков, но вы на них непохожи. Неожиданно они спрашивают, не встречали ли вы на своем пути медальон со знаком Мустангрима? Если он у вас и вы захотите отдать его ристанийцам, <a href="javascript: eval(expr_action)">сделайте это</a>, <a href=btn:261>если же нет</a>.
</html>

end

:19
<html>
<a href=btn:466>Капризная река уносит вас бурным течением к высокому водопаду</a>.
</html>

end

:20
<html>
Однако так просто от огоньков не избавиться. Ярко-красные исчезли, зато появляется рой бледных и тусклых, как светлые струйки дыма, а еще мутные язычки пламени, пляшущие над невидимыми свечами. <a href=btn:233>Поспешите назад</a>, шагнете <a href=btn:224>к первым</a> или <a href=btn:235>ко вторым</a>?
</html>

end

:21
inv+ Алмаз
inv+ 3,Стрела
<html>
Среди поломанных копий и треснувших щитов ваше внимание привлекает украшенный алмазом (!) колчан, полный зловещих черных стрел (можете взять его с собой) и чудом сохранившаяся алебарда, которая повинуясь какому-то дьявольскому заклятью, падает прямо на вас. <a href="javascript: CheckLuck('101', '37')">Проверьте свою удачу</a>.
</html>

end

:22
<html>
Куда вы направитесь теперь? <a href=btn:81>На север</a>, к Серым Горам, <a href=btn:159>на запад</a>, к крепости Изенгард или <a href=btn:59>на северо-восток</a>?
</html>

end

:23
<html>
К сожалению, уцелело лишь несколько страниц старой летописи, где с трудом разбираются слова "Зеркальное озеро... огромный отряд врагов... удержали бы ворота, если бы не... чудовищный... они вызвали из..." и "мост". Мало что поняв, вы <a href=btn:96>покидаете Летописный чертог</a>.
</html>

end

:24
<html>
Ваш "проводник" мертв, а вы в сумерках <a href=btn:161>пытаетесь оглядеться</a>.
</html>

end

:25
<html>
Вы понимаете, что противник на этом не успокоится и, пользуясь этой не слишком продолжительной передышкой, готовитесь <a href=btn:302>швырнуть Кольцо в жерло роковой горы</a>.
</html>

end

:26
<html>
Хозяин трактира Лавр Наркисс говорит, что готов провести вас либо к берегам Рунного озера, либо через Мглистые горы - к Морийским подземельям он и близко не подойдет. Вы <a href=btn:126>согласны</a>? Если вас заинтересовали эти самые подземелья, <a href=btn:48>вернитесь</a> и сделайте другой выбор.
</html>

end

:27
inv+ Моргульский клинок
inv+ Плащ назгула
<script>
if (newGame) { addItem('Моргульский клинок'); addItem('Плащ назгула'); }
</script>
<html>
Теперь страшное оружие ваше и, когда будет желание им воспользоваться, с первой же раной прикончит любого врага. Использовать его можно только один раз, после чего в ваших руках клинок потеряет силу, но если вы считаете, что вам пригодится плащ поверженного неприятеля, можете <a href=btn:109>забрать с собою и его</a>.
</html>

end

:28
<html>
Когда вы покидаете Морию, над Средиземьем уже встает утро. Вокруг все так же безлюдно, а у вас остается только два желания - поесть и выспаться. Мглистые горы позади, устало несет на юг свои воды Великая река Андуин, так почему бы не сделать это сейчас, и вы <a href=btn:128>избираете Ирисную Низину</a>, укутавшись в плащ.
</html>

end

:29
<script>
expr_action = 'if (Gold >= 2) if (Strength < Max_Strength) { modifyGold(-2); modifyStrength(4); } else alert("Ваша сила равна максимальной!"); else alert("У Вас не хватает денег!")';
</script>
<html>
Трактир под вывеской "Гарцующий пони" к вашим услугам. Заплатив 2 золотых, можете <a href="javascript: eval(expr_action)">восстановить 4 силы</a>. Хозяин словоохотлив, но ни намеком не упоминает о нависшей над краем опасности. Народу в зале мало, и ваше внимание привлекают двое - рыжий верзила с видавшим виды прошлым и угрюмый человек в черном плаще. <a href=btn:269>Поедете дальше</a>? <a href=btn:93>Подумайте о проводнике</a> или вначале <a href=btn:48>поговорите с хозяином</a>?
</html>

end

:30
<html>
Появившийся откуда ни возьмись Горлум внезапно накидывается на вас и вам почему-то кажется, что он преследует вас от самого Эриадора. В завязавшейся драке перевес явно на вашей стороне, но цепкой твари все же удается сорвать Кольцо и, оступившись, навеки исчезнуть вместе с "прелестью" в огнедышащем жерле, когда из чудом возникшего сгустка облаков появляется <a href=btn:175>истинный хозяин Кольца</a>.
</html>

end

:31
<html>
"Я вижу, вы торопитесь на север - равнодушным голосом изрекает незнакомец. - Я знаю две дороги туда, и ни одну из них нельзя назвать приятной. Мглистые горы вам не пересечь, но вы можете воспользоваться подземными лабиринтами Мории. Другой путь - через места, которые мы зовет Лихолесьем". Куда вы отправитесь после рассказа вашего спутника: <a href=btn:16>в Черный лес</a>? <a href=btn:71>В покинутое царство гномов</a>?
</html>

end

:32
<html>
К вашему ужасу Кольцо оказывает обратный эффект. Надев его, вы вступаете в призрачный мир. Пустые глазницы Назгула еще лучше видят вас, а вы видите его в истинном облике древнего короля, но то, что вам казалось плащом, на самом деле обвивающий латы саван. Вы понимаете, что совершили ошибку, но снять Кольцо вы сможете только потом - <a href=btn:272>во время боя служитель Мордора вам это сделать не даст</a>.
</html>

end

:33
<script>
expr_action = "if (UrqEval('1 Веревка')) { readParagraph('463'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Подъем на вершину Ородруина труден и опасен, но вы кое-как карабкаетесь по его отвесным склонам. <a href="javascript: CheckLuck('484', '57')">Проверьте свою удачу</a>. А может быть, у вас имеется <a href="javascript: eval(expr_action)">моток веревки</a>?
</html>

end

:34
<html>
Дверь поддается вашим усилиям, и <a href=btn:91>вы попадаете в Легописный чертог</a>.
</html>

end

:35
<html>
Властелин Мордора вызывает Барлога, но <a href=btn:461>лишь громкое эхо служит ему ответом</a>.
</html>

end

:36
<script>
expr_action = 'if (UrqEval("onHorse=0")) AgilityFactor = -1; fightStart(8,8,"ПЕРВЫЙ ВСАДНИК",9,8,"ВТОРОЙ ВСАДНИК"); afterBattle("187")'
</script>
<html>
Ристанийцы принимают ваш вызов, однако, если вы не в седле, придется уменьшать на 1 свою ловкость во время боя. Теперь <a href="javascript: eval(expr_action)">деритесь</a>.
</html>

end

:37
proc lose
<html>
Алебарда точно отсекает вам голову. Увидеть Мордор вам уже не суждено.
</html>

end

:38
<script>
modifyGold(-11);
expr_action = 'if (Gold > 0) { modifyGold(-1); if (Strength < Max_Strength) modifyStrength(2); } else alert("У Вас не хватает денег!")';
</script>
<html>
За 1 золотой вы ночуете у хозяина (можете восстановить 2 силы), а утром отправляетесь в путь (вычеркните 11 золотых с листка путешественника). Мглистые горы кажутся отвесными, но Наркисс знает тайные тропы, которыми вы к полудню и пересекаете этот отвесный хребет. Впереди - Бурые Равнины, и хозяин, пожелав удачи, <a href=btn:73>расстается с вами</a>.
</html>

end

:39
<html>
Дракон повержен, и теперь вы можете осмотреть его пещеру. <a href=btn:5>Сделаете это</a> или <a href=btn:33>поторопитесь на вершину Ородруина</a>?
</html>

end

:40
<script>
expr_action = "if (UrqEval('1 Перстень с рубином')) { readParagraph('467'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Вы уже на границе Ристании и Гондора, когда вас настигают двое всадников на быстрых, как ветер, лошадях. <a href=btn:36>Обнажите меч</a> или <a href=btn:18>посмотрите, что они хотят</a>? А может, у вас имеется <a href="javascript: eval(expr_action)">перстень с рубином</a>?
</html>

end

:41
<script>
enemyStrengthFactor = 3;
expr_action  = "if (UrqEval('1 Моргульский клинок')) { readParagraph('90'); void(0) } else alert('У вас нет такой вещи!');"
expr_action2 = "if (UrqEval('1 Меч Исилдура')) { readParagraph('453'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Спустя мгновение посох в руках мага превращается в обоюдоострый двуручный меч, каждый удар которого, попавший в цель, отнимает у вас 3 силы. Это очень сильный противник, равного которому вам еще не встречалось. Его ловкость 13, а силы Тьмы питают его раны. Есть ли у вас <a href="javascript: eval(expr_action)">моргульский клинок</a>? Если нет, то <a href=btn:136>ваша участь решена</a>. Но может быть, с вами <a href="javascript: eval(expr_action2)">меч Исилдура</a>?
</html>

end

:42
<html>
Лицо эльфа вспыхивает. Он первым <a href=btn:124>начинает поединок</a>.
</html>

end

:43
<html>
Внимательно вглядевшись в дно оврага, вы замечаете вместо груды драгоценностей неясный туман, сухие листья и ... как будто блеск алмаза. Решите <a href=btn:84>начать спуск</a> или <a href=btn:171>обойдете подозрительное место</a>?</html>

end

:44
<script>
expr_action = "if (UrqEval('1 Веревка')) { readParagraph('474'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Если вы находили <a href="javascript: eval(expr_action)">моток веревки</a>, то знаете, как его использовать. В противном случае вам остается только одно - упорно <a href=btn:490>карабкаться к вершине</a>, хватаясь за ненадежные уступы подземных скал.
</html>

end

:45
FireSpell=1
<script>
if (newGame) addItem('Огонь');
</script>
<html>
Это заклятие огня. Если вам когда-нибудь попадется "огненный" противник, используйте его<!--, прибавьте 70 к номеру параграфа-->, и и магия защитит вас. Рискнете <a href=btn:83>произнести второе заклинание</a> или <a href=btn:298>покинете подземелье вместе с сапфиром</a>?
</html>
end

:46
param=1
proc removeStrength
inv+ Сапфир
if 1 Фляга then str="<a href='javascript: eval(expr_action)'>сделайте это</a>" else str="сделайте это"
<script>
expr_action = 'UrqExec("inv- Сапфир"); UrqExec("inv+ Алмаз")';
</script>
<html>
С превеликим трудом (потеряйте 1 силу) дверь удается открыть. Но вот и награда за усердие - огромный сапфир в заржавелом обруче (если знаете, как превратить его в алмаз, сделайте это) и два каких-то заклинания. Рискнете <a href=btn:45>произнести первое</a>, <a href=btn:83>второе</a> или <a href=btn:298>покинете подземелье, забрав с собой сапфир</a>?
</html>

end

:47
<html>
"Мэллон", - произносите вы. Звезда Феанора гаснет, и вы <a href=btn:91>входите в Летописный чертог</a>.
</html>

end

:48
<script>
expr_action = 'if (Gold > 9) { readParagraph("26"); void(0) } else alert("У Вас не хватает денег!")';
</script>
<html>
Хозяин говорит, что Рыжий - знаменитый Бит Осинник, следопыт и знаток здешних краев. Человека в черном он видит впервые, как впрочем, и вы. Но если вас интересует проводник, то и он, Лавр Наркисс, сможет указать вам дорогу за 10 золотых. Кого вы захотите иметь проводником: <a href="javascript: eval(expr_action)">хозяина, <a href=btn:80>Осинника</a>, <a href=btn:116>человека в плаще</a> или <a href=btn:269>продолжите путешествие в одиночестве</a>?
</html>

end

:49
<html>
Миновав отряды врагов и сторожевые посты, вы движетесь к Ородруину - главной цели своего путешествия, стараясь не смотреть в сторону Бастиона Тьмы - Барад-Дура. Вы уже подходите к горе, когда чувствуете, что Кольцо на пальце тяжелеет. <a href=btn:72>Попытаетесь его снять</a> или <a href=btn:60>продолжите путешествие невидимкой</a>?
</html>

end

:50
<script>
fightStart(9,8,"ПРЕДВОДИТЕЛЬ НАЗГУЛОВ"); prevStrength = Strength; afterBattle("100", "Strength < prevStrength", "die");
</script>
<html>
</html>

end

:51
<script>
expr_action = 'enemyStrengthFactor = 4; fightStart(10,8,"БАРЛОГ"); afterBattle("82")';
</script>
<html>
Вы ступаете на мост и доходите до его середины, когда перед вами начинает клубиться косматая туча и внутри нее - исполинская тень, свирепая мощь которой внушает ужас всему живому. Сгусток багровой тьмы уплотняется, и перед вами Барлог - Огонь Глубин. В руке его появляется раскаленный бич, каждый удар которого, попавший в цель, отнимает у вас 4 силы. Остается <a href="javascript: eval(expr_action)">принять бой</a>.
</html>

end

:52
<html>
Вы вступаете в развалины замка, от которого мало что сохранилось. Предпочтете исследовать <a href=btn:12>башню</a> или <a href=btn:86>подземелье</a>?
</html>

end

:53
<html>
Куда вы отправитесь, покинув Великий Тракт: к <a href=btn:304>Черному лесу</a>, <a href=btn:161>Мглистому кряжу</a> или же к не столь отвесным <a href=btn:245>Серым горам</a>?
</html>

end

:54
<script>
if (foodAmount == 0) modifyStrength(-4);
</script>
<html>
Если что-нибудь из еды осталось, поужинайте и восстановите 4 силы (пустой желудок отнимет столько же), после чего вы <a href=btn:280>укладываетесь на ночлег</a>.
</html>

end

:55
MoriaPassed=1
<html>
<a href=btn:28>Вы выбираетесь из Мории, с трудом разобравшись в хитросплетениях ее лабиринтов</a>.
</html>

end

:56
<html>
Рассекая воздух, оставшийся назгул <a href=btn:280>взмывает ввысь, вновь превращаясь в черную точку</a>.
</html>

end

:57
proc lose
<html>
Уже у самой вершины вы поскальзываетесь и с огромной высоты летите вниз. Увидеть Элгариол вам увы, не суждено.
</html>

end

:58
<script>
expr_action = 'fightStart(8,10,"ДРЕВЕНЬ"); afterBattle("76")';
</script>
<html>
На ваших глазах исполин расправляет ветви и, перебирая корнями, угрожающе приближается к вам. <a href="javascript: eval(expr_action)">Вы сильно удивлены, но не настолько, чтобы забыть о мече</a>.
</html>

end

:59
<html>
Ваше внимание привлекает глубокий овраг и вам кажется, что на дне покоятся груды драгоценностей. <a href=btn:84>Спуститесь в него</a> или <a href=btn:43>нет</a>?
</html>

end

:60
proc lose
<html>
Но тут вы с ужасом чувствуете, как чья-то злая воля бесповоротно овладевает вами. Отныне вы становитесь кошмарным назгулом и до скончания века будете верным слугой Черного Властелина.
</html>

end

:61
if BalrogKilled=1 then str1="<a href=btn:35>вы уничтожили Барлога</a>" & str2="нет" else str1="вы уничтожили Барлога" & str2="<a href=btn:115>нет</a>"
<html>
А главное - Черный маг не может уничтожить вас при помощи колдовства, хотя и сам не вступает в схватку, призывая на помощь Огонь Глубин. Если #str1$ - <...> Если же #str2$ - <...>
</html>

end

:62
<script>
expr_action = 'fightStart(9,12,"ТРОЛЛЬ"); afterBattle("99")';
</script>
<html>
Однако выспаться не удается, так как среди ночи вас будит рев пещерного тролля. Нащупав меч, вы вскакиваете на ноги, в то время как он <a href="javascript: eval(expr_action)">атакует вас секирой</a>.
</html>

end

:63
<html>
<a href="javascript: CheckWill('142', '60')">Проверьте свою волю.</a>
</html>

end

:64
<html>
Вам повезло и старичок охотно называет себя. Это Радагаст Карий, знаменитый маг и чародей, повелитель зверей и птиц, цветов и трав. <a href=btn:198>Расскажете ему о цели путешествия</a>, испросив совета, как сделать это лучше или не будете рисковать, попрощаетесь с ним и <a href=btn:159>продолжите путь</a>?
</html>

end

:65
<html>
С трудом сорвав с пальца дьявольское Кольцо, вы <a href=btn:221>оглядываетесь в поисках врагов</a>.
</html>
end

:66
<html>
Решив, что будет безопаснее оставить на месте злосчастный камень, вы <a href=btn:131>поднимаетесь на ноги</a>.
</html>

end

:67
<html>
Эльф говорит, что лучше вам встретиться с королем, чей дворец, он уверен, вам не миновать, если поедете по левой дороге. А чтобы вас пропустили, он отдает [[ перстень с топазом | inv+ Перстень с топазом & goto 117 ]]<!-- (+66)-->, после чего вы расстаетесь, пожелав друг другу удачи.
</html>

end

:68
<html>
Вы углубляетесь в лес и вскоре перед вами первая развилка. Поедете <a href=btn:181>направо</a>, <a href=btn:190>налево</a>?
</html>

end

:69
<html>
Вы выбираете Морию - Подгорное царство гномов, оставленное обитателями много лет назад. Внезапно вы чувствуете, как звезды застилает пелена, а ночное пространство пронизывает чей-то всевидящий взгляд. <a href="javascript: CheckWill('6', '13')">Проверьте свою волю</a>.
</html>

end

:70
<html>
Вы легко находите брод и вскоре оказываетесь на противоположном берегу реки. Теперь вы можете устремиться в <a href=btn:40>Ристанийские степи</a>. Или вам по душе прямой путь через <a href=btn:244>Гнилые топи</a>? А может, вас привлекают <a href=btn:501>развалины древней крепости неподалеку</a>?
</html>

end

:71
MellonSpell=1
<html>
Вы избираете Морию и до восхода солнца оказываетесь перед ее негостеприимным провалом. С последними лучами солнца ваш спутник сбрасывает плащ, и вы видите перед собой благородных кровей принца в камзоле, расшитом золотом. "Меня зовут Арагорн, путник, - говорит он. - Я потомок древних королей Арнора, земли которых поглотила Тьма. Твой путь труден и опасен, но чары врага не всесильны. Звезду Феанора открывает заклятие "Мэллон". За ней ты найдешь все, что тебе нужно". Вы с удивлением благодарите принца, который оставляет вам [[ перстень с изумрудом | inv+ Перстень с изумрудом & goto 118 ]] и исчезает в темноте<!-- (+80)-->. Если вы доберетесь до Мордора и вам понадобится помощь, то с помощью этого перстня вы сможете ее получить. Теперь - <...>
</html>

end

:72
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if (dice1 + dice2 >= Agility) { readParagraph('60'); void(0) } else { readParagraph('65'); void(0) }"
</script>
<html>
<a href="javascript: eval(expr_action)">Киньте кубик дважды</a>, после чего сравните результат с вашей изначальной ловкостью.
</html>

end

:73
<html>
Вы не успеваете как следует углубится в Бурые Равнины, когда с неба спускается на крылатом коне предводитель назгулов - преданнейших слуг Саурона. Через забрало на вас бессмысленным взором смотрят пустые глазницы, но так только кажется. На его челе ослепительным светом сверкает бриллиант, который неплохо украсил бы вашу коллекцию, однако перед этим придется иметь дело с его обладателем. Между тем король - мертвец заносит для удара моргульский клинок. При свете дня он неповоротлив, но даже одна рана таким клинком будет стоить вам жизни. Если противник внушает вам страх, можете попробовать <a href=btn:32>надеть Кольцо и сражаться невидимкой</a>, <a href=btn:271>если же нет</a> - <...>.
</html>

end

:74
<html>
Поскольку у вас нет ни малейшего желания оставаться здесь, вы отправляетесь, покинув Дул-Гулдур, к <a href=btn:19>Приречному взгорью реки Изен</a>.
</html>

end

:75
<script>
expr_action = 'fightStart(8,8,"ГОБЛИН"); afterBattle("158")';
</script>
<html>
На берегу озера вы нос к носу сталкиваетесь с огромным гоблином. Тот, рыча от злости, вытаскивает ятаган. <a href="javascript: eval(expr_action)">Бой неизбежен</a>.
</html>

end

:76
inv+ Веревка
inv+ Медальон с эмблемой Мустангрима
<html>
Обрубив ветви и корни, вы валите столь необычного врага на траву, а в его дупле находите прочный моток веревки<!-- (+430)--> и медальон с эмблемой Мустангрима<!-- (+69)-->. Можете взять с собой и то, и другое, после чего ваш путь лежит либо к <a href=btn:385>реке Изен</a>, либо к <a href=btn:236>Рунному озеру</a>.</html>

end

:77
param=6
proc addStrength
<html>
Вы показываете страже перстень, и охранники ведут вас во внутренние чертоги, где вы предстаете перед королем и рассказываете о своей миссии. Владыка эльфов угощает вас роскошным ужином (можете восстановить 6 сил). В разгар пира в залу входит тот самый эльф, которого вы видели утром на развилке, и <a href=btn:127>не спеша приближается к подножию трона</a>.
</html>

end

:78
if RingUsed=0 then str="<a href=btn:105>В первый?</a> Во второй? В третий?"
if RingUsed=1 then str="В первый? <a href=btn:63>Во второй?</a> В третий?"
if RingUsed=2 then str="В первый? Во второй? <a href=btn:60>В третий</a>?"
<html>
К вечеру вы достигаете Изгарных гор - непосредственной границы Мордора. Проходы усеяны тысячами прислужников Врага - орками. Разумеется, проникнуть незамеченным вам не удастся, и вы можете решиться одеть Кольцо, чтобы стать невидимым. Но в который раз судьба вынуждает вас им воспользоваться: #str$ А может, стоит <a href=btn:201>поискать обходные пути</a>?</html>

end

:79
<html>
Поборов желание, вызванное злой волей Врага, вы <a href=btn:241>продолжаете путь, который преграждает сухонький старичок</a>.
</html>

end

:80
<script>
expr_action = "if (Gold > 7) { modifyGold(-8); readParagraph('88'); void(0); } else alert('У Вас не хватает денег!'); ";
</script>
<html>
Бит Осинник с явной охотой берется за ваше предложение и говорит, что лучшего знатока здешних мест вам не найти. 8 золотых для него достаточно, и он готов провести вас через Мглистые горы. <a href="javascript: eval(expr_action)">Согласитесь</a> или <a href=btn:48>вернетесь</a> и сделаете другой выбор?
</html>

end

:81
param=4
proc addStrength
<html>
Закат застает вас в самой сердцевине Серых гор. Поужинав и восстановив 4 силы, <a href=btn:62>вы укладываетесь на ночлег в одной из расщелин, укутавшись в плащ</a>.
</html>

end

:82
BalrogKilled=1
inv+ Огненный бич
StrengthFactor=4
<html>
Теперь огненный бич<!-- (+38)--> ваш и с каждой раной отнимет 4 силы у вашего врага. Пока нет очередного боя, можете использовать его как пояс - вреда своему хозяину он не причинит. <a href=btn:312>Теперь</a> - <...>
</html>

end

:83
proc lose
<html>
Так действует заклятие Разрушения, наложенное Врагом на замок. Мгновение спустя вы уже завалены грудой обломков. Ни Мордор, ни Элгариол вам более не суждено увидеть.
</html>

end

:84
<html>
Вы спускаетесь на дно оврага и зачерпываете пригоршню золотых монет, которые на ваших глазах превращаются в сухие листья, а <a href=btn:135>вас бросает в гибельный сон</a>.
</html>

end

:85
onHorse=0
<html>
К сожалению, конь не приучен лазать по подземельям и его придется оставить на произвол судьбы. Спешившись, вы ступаете вниз по каменным ступеням. Кинжал Майлина ярко вспыхивает, освещая дорогу. Подземный лабиринт загадочен и непостижим. То тут, то там на тщательно отполированных стенах проступают и гаснут неизвестные надписи. Шлифованные гроты отделаны морийским серебром - мифрилом. Какая грозная сила сокрушила Подземное царство? Может, гоблины, а может быть гномы, вгрызаясь в недра, разбудили еще более древнее Зло? Перед вами первая развилка. Направитесь <a href=btn:423>налево</a>, <a href=btn:424>прямо</a> или <a href=btn:427>направо</a>?
</html>

end

:86
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if (dice1 + dice2 >= Agility) { readParagraph('298'); void(0) } else { readParagraph('46'); void(0) }"
</script>
<html>
Дверь подземелья не поддается. <a href="javascript: eval(expr_action)">Киньте кубик дважды</a>. Если результат больше или равен вашей ловкости, то эту затею придется оставить.<!-- Если меньше, то 46.-->
</html>

end

:87
inv- Медальон с эмблемой Мустангрима
inv+ Сапфир
<html>
Вы отдаете ристанийцам медальон, и <a href=btn:261>всадники в благодарность дарят вам сверкающий всеми гранями сапфир</a>.
</html>

end

:88
<script>
if (Gold > 0) { modifyGold(-1); modifyStrength(2); }
</script>
<html>
За 1 золотой вам вполне по карману снять у хозяина комнату (сон восстановит 2 силы), а наутро <a href=btn:170>вы отправляетесь в путь, взяв с собой сопровождающего</a>.
</html>

end

:89
<html>
Вы покидаете постоялый двор и выезжаете на Тракт, к своему удивлению замечая благородную, чуть ли не королевскую осанку вашего спутника. Однако проявлять излишнее любопытство к незнакомцу, который пускает коня галопом, вы не рискуете и молча <a href=btn:267>устремляетесь вслед за ним</a>.
</html>

end

:90
<script>
expr_action = 'StrengthFactor = 2; fightStart(13,2,"САУРОН"); afterBattle("532")';
</script>
<html>
Вы обнажаете отобранный у назгула моргульский клинок. Саурон бледнеет, но готов наказать обидчика. Вам остается ранить его всего один раз, но берегитесь - <a href="javascript: eval(expr_action)">вы имеете дело с чрезвычайно ловким противником</a>.
</html>

end

:91
inv+ Сапфир
<html>
У дальней стены вы замечаете величественный трон морийских владык, а на нем диадему, украшенную великолепным сапфиром. Выломать его не составляет труда и <a href=btn:10>вам остается лишь гадать, почему орки, разграбив Морию, оставили нетронутой диадему с древними рунами, сапфир который вы можете присовокупить к своей коллекции</a>.
</html>

end

:92
duelElf=1
<script>
expr_action = "UrqExec('inv+ Перстень с топазом'); readParagraph('117')";
</script>
<html>
Протянув противнику руку и помогая ему встать, вы даете понять, что бой окончен. Вы отправляетесь дальше, оставляя эльфа залечивать раны, однако тот в благодарность уступает вам свой <a href="javascript: eval(expr_action)">перстень с топазом<!-- (+66)--></a>.
</html>

end

:93
<html>
К кому вы подойдете: к <a href=btn:80>рыжему завсегдатаю</a> или <a href=btn:116>человеку в плаще</a>?
</html>

end

:94
<html>
Черный лес изобилует буреломами, а кроны мрачных деревьев силятся застлать солнце. По ветвям ползают огромные пауки, но вас они не трогают, и вы ступаете дальше, постоянно спотыкаясь и продираясь сквозь липкую паутину, взяв коня под уздцы. Неожиданно чаща расступается и перед вами Дул-Гулдур - бывшая резиденция Врага, изгнанного отсюда много лет назад. <a href=btn:108>Предпочтете исследовать развалины</a> или <a href=btn:493>минуете не внушающее доверия место</a>?
</html>

end

:95
param=2
proc addStrength
<html>
Ночь застает вас на самых границах Фангорна. Если за предыдущий день ничего не ели, поужинайте и восстановите 4 силы. Сон добавит еще 2, а наутро вы <a href=btn:496>отправляетесь дальше</a>.
</html>

end

:96
<html>
Куда вы двинетесь теперь? <a href=btn:55>Налево</a>? <a href=btn:151>Направо</a>? Или <a href=btn:312>вверх</a> по лестнице?
</html>

end

:97
<script>
expr_action = 'callAllies(11,8,"АРАГОРН"); fightStart(10,8,"ПЕРВЫЙ ТРОЛЛЬ",10,12,"ВТОРОЙ ТРОЛЛЬ"); afterBattle("25")';
</script>
<html>
Вы зовете на помощь Арагорна, и <a href="javascript: eval(expr_action)">принц не замедляет появиться</a>. Если побеждаете вы, то можете помочь своему союзнику (см. правила о битве с несколькими противниками наоборот, т.е. все раны причиняются вашему союзнику). Если побеждает Арагорн, то он поможет вам (но удары испытываете вы). Если же принц убит, вам придется продолжить схватку самому с одним условием - сила врагов уже не восстановится. Когда вы расправитесь с ними, таинственный принц исчезает, а вас ожидают новые испытания.
</html>

end

:98
<html>
Перед вами уютные холмы, на одном из которых расположился неказистый охотничий домик. <a href=btn:15>Подойдете к нему</a> или <a href=btn:143>не станете этого делать</a>?
</html>
end

:99
param=10
proc addGold
inv+ Сапфир
<html>
В мошне тролля вы находите 10 золотых и... великолепный сапфир, который можете взять с собой. Однако сон пропал, и остаток ночи вы проводите у костра, ожидая новых сюрпризов, а с рассветом вновь <a href=btn:122>отправляетесь в путь</a>.
</html>

end

:100
inv+ Моргульский клинок
inv+ Алмаз
<script>
if (newGame) addItem('Моргульский клинок');
</script>
<html>
Теперь у вас в руках моргульский клинок, отмеченный печатью Моргота - властелина Первородного Зла. Использовать его можно только один раз, после чего он теряет силу, зато с первой же раной отнимет жизнь у любого врага. Осторожно вложив его в ножны, и пополнив диадему алмазом Неприятеля (как знать, может, пригодится и то, и это), вы отправляетесь дальше. Впереди три дороги: напрямую, <a href=btn:172>к Белым горам</a>, в объезд налево, <a href=btn:133>к реке Брандуин</a> или направо, <a href=btn:367>к реке Быстротечной</a>.
</html>

end

:101
<html>
Вам удается отскочить в сторону, и алебарда с лязгом падает на каменный пол, поднимая ворох пыли. <a href=btn:14>Попробуете взять ее в руки</a> или <a href=btn:103>оставите там, где лежит</a>?
</html>

end

:102
<html>
Но какую тропинку можно найти среди этих отвесных скал? Ничего не поделаешь, и <a href=btn:69>вы отправляетесь в пещеру</a>.
</html>

end

:103
<html>
Большего обнаружить не удается, и <a href=btn:174>вы покидаете башню</a>.
</html>

end

:104
<html>
Большая часть пути пройдена, поэтому можно, переправившись через Гнилые Топи, направиться прямо <a href=btn:228>в Мордор</a>. А можно <a href=btn:172>в обход, через раскинувшиеся неподалеку Белые горы</a>.
</html>

end

:105
RingUsed=RingUsed+1
<html>
Вашей силе воли можно позавидовать. Что ж, может, это как раз тот момент, когда использовать Кольцо необходимо, хотя в этот момент вы особенно уязвимы для Черного Мага. <a href=btn:49>Вы одеваете Кольцо и становитесь невидимым</a>.
</html>

end

:106
<html>
Куда вы направитесь, покинув Фангорн: <a href=btn:263>в мрачные глубины Лихолесья</a>, <a href=btn:95>к Рунному озеру</a> или <a href=btn:81>к Серым Горам</a>?
</html>

end

:107
if FireSpell=1 then str="<a href=btn:177>произнесите его</a>" else str="произнесите его"
<html>
Вы ступаете в пещеру, где злым огнем светятся два горящих глаза, и спустя секунду вас атакует дракон. Грот озаряет пламя. Если вам ведомо заклятие огня, #str$. <a href=btn:179>Если нет</a>.
</html>

end

:108
<html>
Оставив коня пастись, вы направляетесь к крепости. Древняя цитадель Черного Властелина грозно возвышается над вашей головой, его присутствие здесь еще не истаяло, и вы чувствуете неодолимый приказ надеть Кольцо. <a href="javascript: CheckWill('232', '238')">Проверьте свою волю</a>.
</html>

end

:109
<html>
Новый всадник попадается вам неподалеку. На этот раз, хотя бы, эльф, куда-то скачущий во весь опор. Странно, что вы заметили его первым, ведь эльфы - осторожные и чуткие существа. Резко осадив коня, положив руку на эфес меча, он нетерпеливо спрашивает, кто вы и откуда. <a href=btn:2>Расскажете все как есть</a>, <a href=btn:42>потребуете, чтобы он уступил дорогу</a> или <a href=btn:124>молча обнажите меч</a>, давая понять, что будете разговаривать с ним на языке оружия?
</html>

end

:110
<script>
expr_action = 'fightStart(8,8,"НАЗГУЛ"); prevStrength = Strength; afterBattle("27", "Strength < prevStrength", "die")';
</script>
<html>
Если вы разделались с ним без единого ранения, <a href="javascript: eval(expr_action)">то</a>...
</html>

end

:111
<html>
Эльф не верит ни одному вашему слову, <a href=btn:124>подозревая в вас шпиона Черного мага</a>.
</html>

end

:112
<html>
<a href="javascript: CheckCharm('210', '193')">Проверьте ваше обаяние</a>.
</html>

end

:113
RingUsed=RingUsed+1
<script>
expr_action = 'fightStart(10,8,"НАЗГУЛ"); prevStrength = Strength; afterBattle("27", "Strength < prevStrength", "die")';
</script>
<html>
К вашему ужасу Кольцо оказывает обратный эффект. Пустые глазницы назгула еще лучше видят вас, а вы видите его в истинном облике древнего короля, но то, что вам казалось плащом, на самом деле обвивающий латы саван. Вы понимаете, что совершили ошибку, но <a href="javascript: eval(expr_action)">снять Кольцо во время боя служитель Мордора вам не даст</a>.
</html>

end

:114
<script>
expr_action = "UrqExec('inv+ Охотничий рог'); readParagraph('212'); void(0)"
</script>
<html>
Йарвен явно симпатизирует вам, если предлагает взять в подарок <a href="javascript: eval(expr_action)">охотничий рог</a><!-- (-14)-->. Когда появится возможность, можете протрубить в него, и благосклонный к вам лесной маг придет на выручку. Однако сделать это вы сможете только один раз, после чего рог потеряет силу.
</html>

end

:115
if FireSpell=1 then str="<a href=btn:185>вы знаете, что надо делать</a>" else str="вы знаете, что надо делать"
<script>
expr_action = 'enemyStrengthFactor = 4; fightStart(10,8,"БАРЛОГ"); afterBattle("461")';
</script>
<html>
Вы едва не падаете со скалы, когда видите, какого соперника выставил вам Черный маг. В неясном сгустке косматой тучи перед вами появляется исполин с огненным бичом в руке, каждый удар которого, попавший в цель отнимет у вас 4 силы. Это Барлог - Повелитель Багровой Тьмы. Если вам ведомо заклятие огня, то #str$. Если нет - <a href="javascript: eval(expr_action)">сражайтесь</a>.
</html>

end

:116
<script>
expr_action = "if (Gold > 4) { modifyGold(-5); readParagraph('89'); void(0); } else alert('У Вас не хватает денег!')";
</script>
<html>
Кажется, человек в плаще рад вашему предложению. За 5 золотых он готов провести вас куда угодно, но в пределах Эриадора и немедленно. <a href="javascript: eval(expr_action)">Согласитесь</a> или <a href=btn:48>вернетесь</a> и сделаете другой выбор?
</html>

end

:117
<html>
Куда вы направитесь после встречи с эльфом: <a href=btn:11>налево</a>, <a href=btn:143>направо</a>, <a href=btn:98>прямо</a>?
</html>

end

:118
<html>
Оставшись в одиночестве, вы чувствуете, как звезды застилает пелена, а ночное пространство пронизывает чей-то всевидящий взгляд. Рука нащупывает Кольцо и вы чувствуете непреодолимое желание одеть его, как будто кто-то заставляет вас сделать это. <a href="javascript: CheckWill('6', '13')">Проверьте свою волю</a>.
</html>

end

:119
inv+ Сапфир
<script>
if (newGame) CheckLuck();
</script>
<html>
Стреножив жеребца, надев Кольцо и без помех пробравшись мимо стражи, вы тратите остаток дня на то, чтобы отыскать сокровищницу. Но то ли алмазы здесь не в почете, то ли злое колдовство уничтожило их и здесь. Наконец среди жемчужин и груды золотых монет (можете набить карманы до отказа и не нуждаться в средствах до конца игры) вам попадается сапфир, забрав который, вы покидаете Лориэн. Однако вы и сами понимаете, что поступили бесчестно, обчистив королевские сокровища. <a href=btn:106>Киньте кубик и зачеркните выпавшее на нем число удачи</a>.
</html>

end

:120
<script>
expr_action = 'UrqExec("inv- Стрела"); dice = Math.floor(Math.random() * 6) + 1; if (dice % 2) nazgulCount = nazgulCount + 1; readParagraph("120")';
expr_action2 = 'num_killed = nazgulCount; if (num_killed == 3) { readParagraph("56"); void(0) } ';
expr_action2 += 'if (num_killed) { if (num_killed == 2) fightStart(8,8,"НАЗГУЛ"); ';
expr_action2 += 'else if (num_killed == 1) { fightStart(8,8,"ПЕРВЫЙ НАЗГУЛ",8,8,"ВТОРОЙ НАЗГУЛ"); battleEndCondition("num_killed == 1"); }  } ';
expr_action2 += 'else { fightStart(8,8,"ПЕРВЫЙ НАЗГУЛ",8,8,"ВТОРОЙ НАЗГУЛ",8,8,"ТРЕТИЙ НАЗГУЛ"); battleEndCondition("num_killed == 2"); } afterBattle("56");';
</script>
if Стрела then str="<a href='javascript: eval(expr_action)'>выпускаете их в небо одну за другой</a>" else str="выпускаете их в небо одну за другой"
if Стрела then str2="сражаетесь с оставшимися" else str2="<a href='javascript: eval(expr_action2)'>сражаетесь с оставшимися</a>"
<html>
Вы вспоминаете о стрелах и, натянув лук, #str$. Киньте кубик трижды. С каждым четным числом стрела попадает в цель, а вы #str2$ (их ловкость и сила 8). Если вам удалось утихомирить двух из них - <...><br/>
Поражено: #nazgulCount$ назгулов
</html>

end

:121
param=2
proc removeStrength
inv- Охотничий рог
<html>
Слабеющий рукой вы трубите в рог, призывая на помощь Йарвена. Мгла вокруг вас рассеивается, леденящий холод сменяют солнечный свет и чистый лесной воздух. Силы, хотя и медленно, возвращаются к вам (потеряйте 2 единицы), когда вы замечаете у своих ног блеск алмаза. <a href=btn:137>Возьмете его с собой</a> или <a href=btn:66>оставьте лежать, где лежал</a>?
</html>

end

:122
<html>
На полпути к Мордору вы чувствуете непреодолимое желание одеть Кольцо. <a href="javascript: CheckWill('79', '141')">Проверьте свою волю</a>.
</html>

end

:123
<html>
Тогда перед вами опять две дороги. Предпочтете отправиться <a href=btn:133>к реке Брандуин</a>? Или вам больше по душе <a href=btn:244>Гнилые Топи</a>, раскинувшиеся неподалеку?
</html>

end

:124
<script>
expr_action = 'fightStart(10,10,"ЭЛЬФ"); battleEndCondition("enemy [0].Strength == 2"); afterBattle("124.1")';
</script>
<html>
Итак, <a href="javascript: eval(expr_action)">сражение неизбежно</a>.
</html>

end

:124.1
<html>
Теперь вы можете <a href=btn:92>сохранить ему жизнь</a> или же <a href=btn:132>прикончить того, кто посмел устраивать вам допрос посреди леса</a>.
</html>

end

:125
<html>
"Их будет предостаточно", - усмехается старичок, после чего вы, раскланявшись, уступаете друг другу путь и <a href=btn:499>направляетесь дальше</a>.
</html>

end

:126
<html>
Куда вы предпочтете двинуться завтра утром в компании проводника: <a href=btn:38>через Мглистые горы</a> или <a href=btn:4>к Рунному озеру</a>?
</html>

end

:127
inv+ Лук
if duelElf=1 then str="<a href=btn:213>между вами был поединок</a>" else str="между вами был поединок"
<html>
Встретившийся вам эльф, оказавшийся королю наследником, упрашивает его подарить вам изумительный работы лук - гордость эльфийских мастеров и говорит, что если найдете для него черные стрелы, вашим врагам придется несладко. Поблагодарив короля и принца, вы с сожалением <a href=btn:106>покидаете Лориэн</a>. Однако, если #str$, <...>
</html>

end

:128
param=2
proc addStrength
<html>
Сон ваш крепок, но чуток (восстановите 2 силы и 4 силы восстановит дорожная еда). В полдень вы <a href=btn:9>отправляетесь дальше</a>.
</html>

end

:129
param=2
proc addStrength
<html>
Вода холодна и приятна на вкус. Восстановив 2 силы и налюбовавшись зеркальной гладью озера, вы вновь <a href=btn:104>отправляетесь в путь</a>.
</html>

end

:130
proc lose
<html>
Пещера битком набита гоблинами, орками и разной прочей нечистью, видеть которую ранее вам никогда раньше не приходилось. Что ж, вы удовлетворили свое любопытство но, как ни прискорбно, живым из этой пещеры вам уже не выйти.</html>

end

:131
<html>
Куда вы направитесь, выбравшись из оврага: <a href=btn:81>к Серым горам</a> или <a href=btn:160>к Рунному озеру</a>?</html>

end

:132
<script>
expr_action = 'fightStart(10,2,"ЭЛЬФ"); afterBattle("7")';
</script>
<html>
<a href="javascript: eval(expr_action)">Вы продолжаете бой.</a>
</html>

end

:133
<html>
Вы едва достигли берега, как путь преграждает многочисленный отряд орков. <a href=btn:195>Броситесь в реку</a>, чтобы уйти от преследователей или <a href=btn:207>примете бой</a>?
</html>

end

:134
<html>
Воины говорят, что белый маг Саруман давно дожидается вашего прибытия и готовы проводить вас в его цитадель. <a href=btn:164>Согласитесь</a> или <a href=btn:183>откажитесь</a>?
</html>

end

:135
if 1 Охотничий рог then str="<a href=btn:121>воспользуйтесь им</a>" else str="воспользуйтесь им"
<html>
Полузаледеневшим вы просыпаетесь в Могильнике окутанным в истлевший саван. Вокруг горят свечи и нет сил подняться. Остается позвать на помощь и, если у вас есть охотничий рог, #str$. <a href=btn:140>Иначе</a>.
</html>

end

:136
proc lose
<html>
Последним ударом ссекая голову дерзкому обидчику, Саурон поднимает упавшую с вашего чела диадему, полную драгоценных камней и эльфийских рун. И, может быть, она поможет ему возместить потерю Кольца Всевластья, о чем он и позаботится.
</html>

end

:137
inv+ Алмаз
<html>
Алмаз, несомненно, займет в вашей коллекции заслуженное место, а вы, отряхиваясь, <a href=btn:131>поднимаетесь на ноги</a>.
</html>

end

:138
proc lose
<html>
Речь Сарумана чиста как ручей, глаза светятся бесконечной добротой и вас незаметно для себя завораживают чары его дьявольского обаяния. Вы понимаете, что только такой великий (да к тому же белый) маг может противостоять Врагу и без колебаний отдаете ему Кольцо Всевластья. Теперь участь Саурона решена, но жители Средиземья не смогут спать спокойно - его место займет Саруман ЧЕРНЫЙ...
</html>

end

:139
<html>
Вы кидаетесь на старика с таким пылом, как если бы то был сам Черный Властелин. Но... ваш меч проходит сквозь воздух, а далеко слышен едва заметный смешок. В недоумении оглядевшись по сторонам, вы <a href=btn:499>отправляетесь дальше</a>.
</html>

end

:140
proc lose
<html>
Еще несколько минут вы судорожно пытаетесь подняться, после чего сон вновь овладевает вами, на этот раз, навсегда. Обитатели Могильников - Умертвия - сделали свое дело, и последнее, что вы чувствуете, не в силах разжать усталые веки - их холодные, цепкие прикосновения.
</html>

end

:141
RingUsed=RingUsed+1
<html>
Не в силах противостоять злой воле, вы надеваете Кольцо и чувствуете присутствие Черного мага, как если бы он находился рядом. Враг перехитрил вас и теперь знает, где и в чьих руках находится Кольцо Всевластья. Внезапно односторонний контакт с хозяином Кольца пропадает, и вы срываете его с пальца, а на пути - <a href=btn:241>сухонький старичок</a>.
</html>

end

:142
RingUsed=RingUsed+1
<html>
Вы чуть было не стали рабом Кольца, решившись на повторный эксперимент, но ваша воля сильнее, и вы <a href=btn:49>продолжаете путешествие невидимкой</a>.
</html>

end

:143
param=6
proc addStrength
<html>
Остаток дня проходит спокойно. Ужин и сон добавят вам 6 сил, а на рассвете следующего дня вы вновь <a href=btn:59>отправляетесь в путь</a>.
</html>

end

:144
<html>
Новая развилка не заставляет себя ждать. Куда вы двинетесь: <a href=btn:145>направо</a> или <a href=btn:148>прямо</a>?
</html>

end

:145
<html>
Вы проходите через казавшиеся жилыми ярусы, однако груды костей, треснувшиеся щиты, боевые топоры гномов, разбитая утварь и кривые мечи - излюбленное оружие горных орков - красноречиво напоминают о том, что произошло здесь много лет назад. Очередной коридор вновь разветвляется. <a href=btn:155>Изберете поворот налево</a> или <a href=btn:154>не станете сворачивать</a>?
</html>

end

:146
<script>
IncreaseLuck();
</script>
<html>
Вам повезло. Это Гэндальф, белый маг и непримиримый враг Саурона. Гэндальф предостерегает вас не пытаться проникнуть в Мордор через Гнилые топи и <a href=btn:240>избрать другой путь</a>.
</html>

end

:147
<html>
Меч проходит сквозь топь, не встречая никакого препятствия и... тает в пустоте. <a href=btn:209>Рискнете его найти</a> и, быть может, достать рукой алмаз или <a href=btn:234>поспешите прочь</a>?
</html>

end

:148
<html>
Вы проходите через казавшиеся жилыми ярусы, однако груды костей, треснувшиеся щиты, боевые топоры гномов, разбитая утварь и кривые мечи - излюбленное оружие горных орков - красноречиво напоминают о разыгравшейся много лет назад трагедии. Очередной коридор кончается, и вам предстоит выбор: по какому туннелю идти дальше. По <a href=btn:149>левому</a> или <a href=btn:151>правому</a>?
</html>

end

:149
if MellonSpell=1 then str="<a href=btn:47>знаете ли вы</a>" else str="знаете ли вы"
<html>
Вы избираете левый коридор и замечаете в его конце массивные двери. От вашего прикосновения на вратах вспыхивает старинный эльфийский знак - звезда Феанора. Но #str$, как открыть ворота? Если нет, придется <a href=btn:151>идти дальше</a>.
</html>

end

:150
<script>
expr_action = "if (Gold > 9) { modifyGold(-10); readParagraph('242'); void(0); } else alert('У Вас не хватает денег!')";
</script>
<html>
Гэндальф также предлагает за 10 золотых <a href="javascript: eval(expr_action)">обучить вас заклятию огня</a>. <a href=btn:223>Если вы не хотите или не можете себе это позволить</a> - <...>
</html>

end

:151
<html>
Впереди новая развилка. <a href=btn:152>Войдете в левую арку</a> или <a href=btn:153>пойдете по коридору прямо</a>? А может быть, <a href=btn:154>вниз по лестнице</a>?
</html>

end

:152
<html>
Вы оказываетесь на берегу подземного озера, о глубине которого лучше не думать. В тусклой полутьме вы замечаете мост, о существовании которого вы, может быть, даже не догадывались. <a href=btn:51>Пойдете по нему</a> или <a href=btn:312>поищите другой путь</a>?
</html>

end

:153
<html>
Проход завален обломками. <a href=btn:151>Вернитесь</a> и сделайте другой выбор.
</html>

end

:154
proc lose
<html>
Страшный грохот за вашей спиной заставляет обернуться. Наверное, вы попали в чью-то ловушку и теперь замурованы в каменном мешке обвалившихся скал. Как ни печально, увидеть солнце вам уже не суждено.
</html>

end

:155
if 1 Медальон с лилией then str="<a href=btn:520>Но есть ли у вас соответствующий медальон?</a>" else str="Но есть ли у вас соответствующий медальон?"
<html>
Ваше внимание привлекают массивные двери. От вашего прикосновения на вратах вспыхивает старинный эльфийский знак - Белая Лилия. #str$ Или <a href=btn:525>попробуете их выломать</a>? Если двинетесь дальше, <a href=btn:96>то</a>.
</html>

end

:156
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if (dice1 + dice2 >= Agility) { readParagraph('96'); void(0) } else { readParagraph('34'); void(0) }"
</script>
<html>
<a href="javascript: eval(expr_action)">Киньте кубик дважды</a>. Если сумма чисел больше или равна вашей ловкости, то придется оставить затею.
</html>

end

:157
<script>
expr_action = 'callAllies(9,12,"ПЕРВЫЙ ЛАТНИК",11,6,"ВТОРОЙ ЛАТНИК"); fightStart(10,12,"ПЕРВЫЙ ТРОЛЛЬ",10,8,"ВТОРОЙ ТРОЛЛЬ"); afterBattle("25")';
</script>
<html>
Повернув рубин на перстне внутрь оправы, вы <a href="javascript: eval(expr_action)">призываете на помощь воинов Гондора</a>. Если гибнет один из троллей, латник помогает своему собрату добить оставшегося##59$ если один из латников, то наоборот##59$ если погибли оба воина, продолжать схватку придется вам. Когда тролли повержены, таинственные латники исчезнут, а вас ожидают новые испытания.
</html>

end

:158
inv+ Сапфир
<script>
IncreaseLuck();
</script>
<html>
В карманах гоблина вы обнаруживаете... редкий сапфир, недоумевая, как он к нему попал. Киньте кубик и почистите соответствующий квадрат удачи. Теперь, забрав его себе, <a href=btn:129>рискнете попить из озера</a> или, если нет, <a href=btn:104>перед вами снова дорога</a>.
</html>

end

:159
<html>
Несколько часов пути и перед вами Изенгард - крепость могущественного мага Сарумана Белого, главы Совета Мудрых, державного властителя Колец и Соцветий. <a href=btn:164>Повернете к крепости</a> или <a href=btn:178>не станете этого делать</a>?
</html>

end

:160
<html>
Вы уже почти вышли к его зеркальной глади, когда ваше внимание привлекает одиноко стоящее исполинское дерево. <a href=btn:58>Подойдете к нему</a> или <a href=btn:236>продолжите путь</a>?
</html>

end

:161
<html>
Мглистые горы кажутся неприступными, и только безумец может карабкаться в потемках по их обрывистым склонам. <a href=btn:102>Постараетесь найти какую-нибудь тропинку</a> или <a href=btn:69>обследуете разветвленную пещеру</a>, чрезвычайно похожую на лабиринт?</html>

end

:162
<html>
К сожалению, он сегодня не в духе и, накинув на глаза капюшон, тает в воздухе. Постояв около минуты и удивляясь неожиданной встрече, вы <a href=btn:159>продолжаете свой путь</a>.
</html>

end

:163
<script>
expr_action1 = 'if (Gold > 9) if (UrqEval("1 Медальон с эмблемой Мустангрима or 1 Медальон с лилией or 1 Медальон с пастью волколака")) alert("Вы уже приобрели медальон!"); else { modifyGold(-10); UrqExec("inv+ Медальон с эмблемой Мустангрима"); } else alert("У Вас не хватает денег!")';
expr_action2 = 'if (Gold > 9) if (UrqEval("1 Медальон с эмблемой Мустангрима") || UrqEval("1 Медальон с лилией") || UrqEval("1 Медальон с пастью волколака")) alert("Вы уже приобрели медальон!"); else { modifyGold(-10); UrqExec("inv+ Медальон с лилией"); } else alert("У Вас не хватает денег!")';
expr_action3 = 'if (Gold > 9) if (UrqEval("1 Медальон с эмблемой Мустангрима or 1 Медальон с лилией or 1 Медальон с пастью волколака")) alert("Вы уже приобрели медальон!"); else { modifyGold(-10); UrqExec("inv+ Медальон с пастью волколака"); } else alert("У Вас не хватает денег!")';
</script>
<html>
На одном из медальонов изображена <a href="javascript: eval(expr_action1)">эмблема Мустангрима - легендарный жеребец Светозар</a><!-- (+69)-->##59$ на втором - <a href="javascript: eval(expr_action2)">освещаемая лунным светом лилия</a><!-- (+17)-->##59$ третий медальон украшает <a href="javascript: eval(expr_action3)">оскаленная пасть волколака</a><!-- (+20)-->. Вы можете приобрести любой из них и, поблагодарив волшебника, <a href=btn:159>продолжить путь</a>.
</html>

end

:164
param=4
proc addStrength
<html>
Изенгард - крепость Светлых Сил - сверкает всеми цветами радуги. Саруман радушен и приветлив (за ужином можете восстановить 4 силы). Вас настораживает только одно - <a href=btn:138>маг не может отвести глаз от вашего Кольца</a>.
</html>

end

:165
<html>
Расчистив путь, вы устремляетесь дальше, проклиная коварство, на этот раз, Белого мага и к вечеру достигаете либо пещерных провалов <a href=btn:161>Мглистого кряжа</a>, либо <a href=btn:245>Серых гор</a>, если выбрали восточный путь.
</html>

end

:166
if 1 Перстень с изумрудом or 1 Перстень с рубином or 1 Охотничий рог then str="<a href=btn:17>у вас имеются союзники</a>" else str="у вас имеются союзники"
<script>
expr_action = 'fightStart(10,12,"ПЕРВЫЙ ТРОЛЛЬ",10,8,"ВТОРОЙ ТРОЛЛЬ"); afterBattle("25")';
</script>
<html>
Однако расслабиться вам не дают. Два здоровенных тролля, вызванных на вершину во мгновение ока каким-то черным колдовством, преграждают вам путь. Если #str$ и вы хотите обратиться к их помощи, то <...> Если нет, <a href="javascript: eval(expr_action)">сражайтесь сами</a>.
</html>

end

:167
proc lose
<html>
Вы уже готовы вступить в цитадель Врага, возглавив союзное воинство, когда часовые Барад-Дура видят вас и поднимают страшный вопль. С зубчатых стен в вас летят бесчисленные стрелы орков, союзный отряд хватается за мечи, а с неба на крылатых тварях спускается пятерка назгулов. Что ж, вы переоценили свои силы и выбраться из этой мясорубки вам не удастся даже с моргульским клинком.
</html>

end

:168
<html>
Благополучно приземлившись на противоположный склон ущелья, <a href=btn:40>продолжайте свой путь</a>.
</html>

end

:169
param=2
proc removeStrength
<html>
С невероятной скоростью увернувшись от града обломков вы устремляетесь в дубравы Черного леса, потеряв все же 2 силы, в то время как Дул-Гуддур погружается в руины. С облегчением вздохнув, <a href=btn:74>продолжайте путь</a>.
</html>

end

:170
<script>
expr_action = 'fightStart(8,10,"ПРОВОДНИК"); afterBattle("24")';
</script>
<html>
У самого подножья Мглистых гор вас ожидает неприятный сюрприз - ваш проводник оказался грабителем, тем более что из заплечного мешка показался краешек вашей драгоценной диадемы. Схватка неизбежна и вы <a href="javascript: eval(expr_action)">обнажаете меч</a>.
</html>

end

:171
<html>
Тогда перед вами снова развилка. Направитесь на север, <a href=btn:81>к Серым горам</a>, на северо-запад, <a href=btn:160>к Рунному озеру</a>, или на северо-восток, <a href=btn:385>к реке Изен</a>?
</html>

end

:172
<html>
Почти миновав без приключений Белые горы, вы встречаете на своем пути опасное крутое ущелье, миновать которое не удается. <a href=btn:123>Повернете назад</a> или <a href=btn:337>попытаетесь перепрыгнуть с разгона</a>?
</html>

end

:173
proc lose
<html>
Увы, вам не повезло. Расстояние до ближайшего склона слишком велико, и вы срываетесь вниз, не оставляя себе ни малейшего шанса. Ни Мордор, ни Элгариол увидеть больше вам не суждено.
</html>

end

:174
<html>
Неожиданно по замку прокатывается зловещий гул и его стены начинают сотрясаться. <a href="javascript: CheckLuck('169', '469')">Проверьте свою удачу.</a>
</html>

end

:175
if 7 Алмаз then str="<a href=btn:196>7 алмазов</a>" & str2="меньше" else str="7 алмазов" & str2="<a href=btn:8>меньше</a>"
<html>
Если на вашей диадеме #str$ - <...> Если #str2$ - <...>
</html>

end

:176
param=1
proc removeStrength
<html>
С невероятной скоростью увернувшись от града обломков, вы устремляетесь в дубравы Черного леса, потеряв все же 1 силу, в то время как Дул-Гуддур погружается в руины. С облегчением вздохнув, <a href=btn:74>продолжаете свой путь</a>.
</html>

end

:177
<script>
expr_action = 'fightStart(9,16,"ДРАКОН"); afterBattle("39")';
</script>
<html>
Вы произносите заклятие огня, и пламя, вырывающееся из пасти стража горы, не приносит вам ни малейшего вреда. Однако каждый удар когтистой лапы, попавший в цель, отнимет у вас 2 силы. Теперь <a href="javascript: eval(expr_action)">деритесь</a>.
</html>

end

:178
<html>
Вы разворачиваете коня и скачете прочь от замка, но на первом же перекрестке вам путь преграждают два белых воина, делая знак остановиться. <a href=btn:183>Обнажите меч</a> или <a href=btn:134>выясните, что они хотят</a>.
</html>

end

:179
param=4
proc removeStrength
<script>
expr_action = 'fightStart(9,16,"ДРАКОН"); afterBattle("39")';
</script>
<html>
Дохнув пламенем (потеряйте 4 силы), страж горы бросается в бой. Каждый удар его когтистой лапы, попавший в цель, отнимает у вас 2 силы. Теперь <a href="javascript: eval(expr_action)">деритесь</a>.
</html>

end

:180
<html>
<a href="javascript: CheckLuck('168', '173')">Проверьте свою удачу</a>.
</html>

end

:181
<html>
Первый встречный вам путник - эльф, куда-то скачущий во весь опор. Странно, что вы заметили, его первым, ведь эльфы - осторожные и чуткие существа. Резко осадив коня, положив руку на эфес меча, он нетерпеливо спрашивает, кто вы и откуда. <a href=btn:2>Расскажете все как есть</a>, <a href=btn:42>потребуете, чтобы он уступил дорогу</a> или <a href=btn:124>молча обнажите меч</a>, давая понять, что будете разговаривать с ним на языке оружия?
</html>

end

:182
<html>
Первый встречный путник - высокий старик с ветвистым посохом, одетый в бурого цвета плащ. <a href=btn:191>Хотите с ним заговорить</a> или <a href=btn:159>проедете мимо</a>?
</html>

end

:183
<script>
expr_action = 'fightStart(8,8,"ПЕРВЫЙ ВОИН",7,8,"ВТОРОЙ ВОИН"); afterBattle("165")';
</script>
<html>
Становится ясно, что Белые Воины не пропустят вас без боя. Из ножен обоих с лязгом вылетают обоюдоострые мечи, и вы <a href="javascript: eval(expr_action)">начинаете схватку</a>.
</html>

end

:184
if 1 Медальон с пастью волколака then link="<a href=btn:204>"
if 1 Огненный бич then link="<a href=btn:222>"
if 1 Медальон с пастью волколака or 1 Огненный бич then instr str=#link$воспользуйтесь ими</a> else str="воспользуйтесь ими"
<html>
Внезапно вечерний закат оглашает вой стаи волколаков, во весь опор несущихся по вашим следам. Если у вас есть медальон с изображением пасти одного из этих существ или огненный бич, #str$. <a href=btn:243>Если же нет</a> - <...>
</html>

end

:185
<html>
Огненный бич не в силах причинить вам ни малейшего вреда, рассыпаясь на тысячи ослепляющих искр, и Барлог, отступая в бессильной злобе, <a href=btn:41>скрывается в облаке косматой тучи</a>.
</html>

end

:186
if 1 Медальон с лилией then str="<a href=btn:203>медальон с лилией</a>" else str="медальон с лилией"
<html>
Захлебываясь от подводного путешествия и не в силах ему противиться, вы ощущаете за спиной илистое дно и водянистые сгустки, которые на ваших глазах приобретают неясные формы человеческих фигур. Это никсы - водяные духи. Если у вас есть #str$, воспользуйтесь его помощью. Если же нет - ваше путешествие закончилось. Обратно никсы вас уже не выпустят.
</html>

end

:187
<html>
Если вы хотите завладеть лошадью одного из них, <a href=btn:220>то</a>. <a href=btn:205>Если нет</a> - <...>
</html>

end

:188
onHorse=0
<html>
Вы просыпаетесь в роскошной комнате незнакомой цитадели, безуспешно пытаясь припомнить, как вы оказались здесь. В заплечном мешке все в целости и сохранности, в том числе и камни, и ваша диадема. Кольцо по-прежнему на цепочке, однако ни оружия, ни денег, ни еды найти не удается. В распахнувшиеся двери входят двое до зубов вооруженных воинов и <a href=btn:219>приказывают вам следовать за ними</a>.
</html>

end

:189
<html>
Вам повезло и вы оставляете стаю ненасытных хищников далеко позади, после чего <a href=btn:54>на Ристанийские степи опускается ночь</a>.
</html>

end

:190
<html>
Спустя несколько часов вас нагоняет мрачного вида всадник. Приглядевшись, вы узнаете в нем одного из назгулов - преданнейших слуг Саурона, посланных, очевидно, на ваши поиски. В руке его моргульский клинок, отмеченный печатью первородного зла. Первая же рана таким клинком будет стоить вам жизни. <a href=btn:113>Попытаетесь надеть кольцо, чтобы стать невидимкой?</a> <a href=btn:110>Или нет?</a>
</html>

end

:191
<html>
<a href="javascript: CheckCharm('64', '162')">Проверьте ваше обаяние.</a>
</html>

end

:192
<html>
Вы напряженно пытаетесь уйти от погони. <a href="javascript: CheckEscapeChase('189', '208')">Киньте кубик трижды за себя и за преследователей</a>. Если ваши очки в большинстве случаев превышают, то вы сумели это сделать.
</html>

end

:193
<html>
Ристанийцы разворачивают коней и, пожелав удачи, <a href=btn:199>исчезают в сумерках в направлении своих табунов</a>.
</html>

end

:194
<html>
Туннель оказывается зловонной ямой, и лишь кинжал Майлина тускло освещает путь. Едва не запутавшись в паутине лабиринтов, вы <a href=btn:214>неожиданно попадаете в настоящую паутину, сотканную каким-то гигантским и жутким существом</a>.
</html>

end

:195
<html>
Вы бросаетесь в реку и с ужасом чувствуете, как <a href=btn:186>неведомая сила увлекает вас на дно</a>.
</html>

end

:196
<html>
<a href=btn:61>Диадема с алмазами надежно защищает вас</a>.
</html>

end

:197
if onHorse=1 then str1="пеший" & str2="<a href=btn:215>конный</a>" else str1="<a href=btn:328>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:198
<html>
Радагаст с интересом слушает вас и предлагает на выбор один из трех медальонов, которые, как он считает, могут пригодится в дороге. За это он требует 10 золотых. <a href=btn:159>Откажетесь от покупки и поедете дальше</a> или <a href=btn:163>сделаете выбор</a>?
</html>

end

:199
<html>
После встречи с ристанийцами день клонится к закату, а перед вами снова две дороги. Изберете <a href=btn:308>левую</a> или <a href=btn:256>правую</a>?
</html>

end

:200
onHorse=1
<html>
Взобравшись на коня, <a href=btn:199>продолжаете путь верхом</a>.
</html>

end

:201
<html>
Ущелье Кирит-Унгол кажется безлюдным. <a href=btn:194>Рискнете перебраться через что-то, отдаленно напоминающее туннель</a> или <a href=btn:276>сделаете другой выбор</a>?
</html>

end

:202
<html>
Тогда какую: <a href=btn:130>меньшую</a> или <a href=btn:107>большую</a>?
</html>

end

:203
inv- Медальон с лилией
param=2
proc removeStrength
<html>
Медальон нащупывают чьи-то липкие руки, после чего он мягко спадает с ваших плеч, а <a href=btn:188>вы теряете сознание</a> (-2 силы).
</html>

end

:204
<html>
Вы прикасаетесь к медальону, и вой над степью превращается в жалобное поскуливание. Ни один из таких преследователей не может причинить вам, наделенному магией фауны, никакого вреда, и <a href=btn:284>вы спокойно укладываетесь спать</a>, тем более что стая во главе с вожаком будет охранять вас до самого утра, повинуясь заключенной в медальоне силе.
</html>

end

:205
<html>
Итак, <a href=btn:199>вы продолжаете путь пешком</a>.
</html>

end

:206
param=8
proc addStrength
inv+ Перстень с рубином
<html>
Ваше хладнокровие, быть может, спасло вам жизнь. Подземелье оказывается огромной залой для тайных совещаний, где в окружении немногочисленных вельмож восседает правитель Гондора князь Денэтор. Уже много лет он ведет непримиримую борьбу против воинства Тьмы и уж конечно, узнав о цели вашего путешествия, сможет вам помочь. За сытным ужином (восстановите 6 сил) князь рассказывает, что вас прибило к крепости течением реки, возвращает все ваши трофеи, оружие и деньги и дарит перстень с рубином. Теперь если в Мордоре вам понадобится помощь, поверните камень внутрь оправы<!-- (+140)-->, и два воина прибудут к вам на выручку. На прощание Денэтор говорит, что не стал бы пробираться в Мордор через перевал Кирит-Унгол. Поблагодарив Денэтора, наутро (сон восстановит 2 силы) вы вновь отправляетесь в дорогу и через несколько часов пути <a href=btn:40>перед вами Ристанийские степи</a>.
</html>

end

:207
proc lose
<html>
Бой кровопролитный, но не долгий, и смерть для израненного тучей стрел тела кажется избавлением...
</html>

end

:208
proc lose
<html>
Вам не удается уйти от волков и после короткого, но жестокого боя вы сами становитесь жертвой кровожадных хищников.
</html>

end

:209
proc lose
<html>
Вы погружаете руку в болотную топь и в тот же миг земля уходит из-под ног. Рука нащупывает пустоту, небо и земля меняются местами, а вы с головой погружаетесь в трясину, которой не видно дна. Некоторое время по поверхности топи колыхается неспокойная рябь, а затем в качестве одного из экспонатов в величественной диадеме навечно предстаете вы.
</html>

end

:210
<script>
expr_action = 'if (Gold > 7) { modifyGold(-8); readParagraph("200"); void(0) } else alert("У Вас не хватает денег!")';
</script>
<html>
Неожиданно для вас ристанийцы предупреждают, что пешему здесь небезопасно и предлагают вам за 8 золотых пересечь границы Мустангрима на одном из своих жеребцов, чьи стада пасутся неподалеку. <a href="javascript: eval(expr_action)">Если вы согласны и у вас не иссяк кошелек</a>, то <...> <a href=btn:193>Иначе</a>.
</html>

end

:211
param=4
proc removeStrength
<html>
Вам удается прорубить проход, но <a href=btn:226>в этот миг чьи-то жвалы впиваются в вашу ногу</a> (потеряйте 4 силы).
</html>

end

:212
param=2
proc addStrength
<html>
Переночевав у радушного хозяина (+2 силы) и поблагодарив его за гостепреимство, утром <a href=btn:22>направляетесь дальше</a>.
</html>

end

:213
inv- Перстень с топазом
inv+ Алмаз
<script>
IncreaseLuck();
</script>
<html>
Потрясенный вашим благородством и тем, что вы сохранили жизнь его наследнику, король произносит магическое заклятие, и топаз на вашем перстне превращается в бриллиант. Киньте кубик и почистите один из квадратов удачи, после чего, поблагодарив радушного короля, вы с сожалением <a href=btn:315>покидаете Лориэн</a>.
</html>

end

:214
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if (dice1 + dice2 >= Agility) { readParagraph('230'); void(0) } else { readParagraph('211'); void(0) }";
</script>
<html>
<a href="javascript: eval(expr_action)">Киньте кубик дважды</a>, после чего сравните результат с вашей изначальной ловкостью.
</html>

end

:215
onHorse=0
<html>
К сожалению, с верным товарищем придется расстаться и <a href=btn:328>вы отпускаете жеребца обратно в степь</a>, который провожает вас жалобным ржанием.
</html>

end

:216
<html>
Вырвавшись на свет из пещерного смрада, вы оглядываясь в поисках врагов, а впереди - конечная цель вашего визита <a href=btn:221>Огнедышащая гора</a>.
</html>

end

:217
<html>
Спустя несколько часов вам попадается справа от дороги постоялый двор - жилой островок посреди пустынного края. <a href=btn:29>Заглянете в него</a>, чтобы передохнуть или <a href=btn:53>поедете дальше</a>?
</html>

end

:218
<html>
<a href="javascript: CheckCharm('114', '514')">Проверьте ваше обаяние</a>.
</html>

end

:219
<html>
Вы идете по длинным узким коридорам. Ваши стражники, игнорируя вопросы, молча ведут вас в мрачное подземелье. <a href=btn:518>Рискнете завладеть оружием и бежать</a> (тогда придется уменьшить на 2 свою ловкость). Или <a href=btn:206>посмотрите, что будет дальше</a>.
</html>

end

:220
<html>
Одна из лошадей с громким ржанием уносится прочь, однако вторую удается подхватить под уздцы. <a href="javascript: CheckLuck('200', '205')">Проверьте свою удачу</a>. Если вам не повезло, считайте, что верный скакун не потерпит нового хозяина.
</html>

end

:221
<html>
Поблизости никого нет, но вы постоянно ожидаете ловушек и осторожно подступаете к Ородруину. Из конусообразного жерла вырываются языки пламени, и вы уже готовы начать подъем, когда замечаете в одном из склонов две пещеры. <a href=btn:202>Обследуете их</a> или <a href=btn:33>полезете прямо на вершину</a>?
</html>

end

:222
<html>
Огненный бич грозно хлещет по волчьим мордам, озаряя тьму багровыми всполохами. Злобно рыча, вся стая удаляется прочь, а вы <a href=btn:54>занимаетесь поиском места для ночлега</a>.
</html>

end

:223
<html>
Поблагодарив волшебника, вы <a href=btn:499>направляетесь дальше</a>.
</html>

end

:224
proc lose
<html>
А вот и сюрприз! Ногу обвивают змеиные щупальца, чавкая илистой жижей. Спустя мгновение вы поскальзываетесь, и неизвестная тварь увлекает вас на дно. Бороться под водой вы еще смогли бы, но будучи с головой в трясине вам это не удается. Быть может, Черный Властелин не сможет найти Кольцо в этой мерзкой топи, но даже в этом у вас не будет никакой уверенности.
</html>

end

:225
<script>
expr_action = 'if (UrqEval("1 Перстень с изумрудом")) { readParagraph("305"); void(0); } else  alert("У Вас нет такой вещи!")';
</script>
<html>
Если у вас действительно есть <a href="javascript: eval(expr_action)">перстень Арагорна</a>, то вы знаете, что надо делать. <a href=btn:299>Если же нет или от него осталась одна оправа</a>.
</html>

end

:226
<script>
expr_action = 'fightStart(10,16,"ШЕЛОБ"); afterBattle("216")';
</script>
<html>
В темноте зловеще поблескивают два мутных глаза. Это Шелоб, исчадие Тьмы, значительно более древнее, чем сам Саурон, приняла вас за свою постоянную добычу-орков. <a href="javascript: eval(expr_action)">Бой неизбежен</a>. Если повержен и этот противник, вам лучше всего поскорее выбираться из проклятого туннеля.
</html>

end

:227
<html>
Поборов далекий приказ врага, вы <a href=btn:75>устремляетесь вперед</a>.
</html>

end

:228
<html>
Прямой путь в Мордор преграждают Гиблые Болота - короткий, но крайне опасный участок пути. <a href=btn:104>Вернетесь</a> или попытаетесь <a href=btn:244>пробраться через трясину</a>?
</html>

end

:229
proc lose
<html>
Ваша попытка столь же смелая, сколь и безрассудная, кончается плачевно. На шум борьбы к стражникам сбегается подмога, которая с удовольствием помогает им прикончить не в меру буйного арестанта.
</html>

end

:230
proc lose
<html>
Как ни печально, вырваться из этой паутины у вас не хватит сил. Ваше путешествие закончено, а вскоре вы с замиранием сердца увидите, кем соткана ваша последняя ловушка.
</html>

end

:231
param=1
proc removeStrength
<script>
IncreaseLuck();
</script>
<html>
Миновав к исходу дня вонючую топь, вы достигаете твердой земли (потеряйте 1 силу) и думаете лишь о том, где расположиться на ночлег. Так или иначе можете почистить один из квадратов удачи, раз <a href=btn:414>вы все-таки миновали эти мерзкие болота</a>.
</html>

end

:232
<html>
Поборов желание, вы <a href=btn:52>устремляетесь к воротам Дул-Гулдура</a>.
</html>

end

:233
<html>
Вы оборачиваетесь, но найти дорогу назад не представляется возможным. Приходится идти наугад не дожидаясь сумерек. <a href=btn:20>Вернитесь</a> и сделайте другой выбор.
</html>

end

:234
play #quest_path$/Snd/MINUS.WAV
<script>
if (newGame)
{
    removeItem('Меч');
    Sword = 0;
    if (!UrqEval('1 Меч Исилдура')) modifyAgility(-1);
}
</script>
<html>
Если у вас есть другое оружие (кроме лука), можете использовать его. В противном случае у вас остается лишь кинжал Майлина и во время поединков вам придется уменьшать на 1 свою ловкость. <a href=btn:231>Теперь</a> - <...>
</html>

end

:235
<html>
Огоньки приводят вас в самое сердце болот, и здесь туманную влагу проясняет как будто темное окно. Взглянув под ноги, вы видите страшную, но завораживающую картину. Под слоем болотной топи в черной глубине зияют уродливые хари, а рядом - скорбные и прекрасные лики. Эльфы? Люди? Орки? Сокрытый памятник великой битвы, происшедшей, быть может, тысячи лет назад. Чело древнего короля украшает роскошный алмаз, и кажется, что стоит только протянуть руку... Впрочем, выбор за вами. <a href=btn:209>Рискнете</a> или <a href=btn:231>нет</a>? А может, <a href=btn:147>проткнете топь мечом</a>, чтобы убедится, что все это настоящее?
</html>

end

:236
<script>
expr_action = "dice = Math.floor(Math.random()*6) + 1; if (dice % 2 == 0) { readParagraph('227'); void(0) } else { readParagraph('237'); void(0) }";
</script>
<html>
Едва показалось Рунное озеро, вы чувствуете, как чья-то злая воля заставляет вас надеть кольцо, но вы пытаетесь сопротивляться. <a href="javascript: eval(expr_action)">Киньте кубик</a><!--, и если выпало четное число, то 227, если нечетное - 237-->.
</html>

end

:237
<html>
Поскольку вы не в силах бороться со столь могущественным магом, а проклятое Кольцо на пальце послушно его воле, <a href=btn:75>теперь Враг знает, кто завладел его сокровищем и где вас искать</a>.
</html>

end

:238
RingUsed=RingUsed+1
<html>
Не в силах противостоять злой воле, вы надеваете Кольцо на палец и чувствуете присутствие Черного мага как если бы он находился рядом. Враг перехитрил вас, и теперь знает не только в чьих руках его Кольцо, но и где вы. <a href=btn:52>Внезапно односторонний контакт с хозяином Кольца обрывается</a>.
</html>

end

:239
<html>
Смрадный туман болот стелется вдоль редких кочек полупрозрачной дымкой, а где-то неподалеку пляшут блуждающие огни, как будто приглашая вас. <a href=btn:235>Пойдете за ними</a> или <a href=btn:20>не станете</a>?
</html>

end

:240
<html>
<a href="javascript: CheckCharm('150', '223')">Проверьте ваше обаяние.</a>
</html>

end

:241
<html>
Он бредет, опираясь на посох и надвинув на глаза серый капюшон, после чего называет вас по имени и спрашивает о цели путешествия. <a href=btn:139>Нападете на него</a>, <a href=btn:146>расскажите правду</a> или <a href=btn:125>ответите, что ищете приключений</a>?
</html>

end

:242
FireSpell=1
<script>
if (newGame) addItem('Огонь');
</script>
<html>
Отныне если вам попадется "огненный" противник, считайте, что сумели воспользоваться заклятьем. <a href=btn:223>Теперь</a>.
</html>

end

:243
if onHorse=1 then str1="<a href=btn:192>на коне</a>" & str2="В противном случае" else str1="на коне" & str2="<a href=btn:208>В противном случае</a>"
<html>
Если вы #str1$, то... #str2$ - ...
</html>

end

:244
if onHorse=1 then str1="не в седле</a>" & str2="<a href=btn:531>конный</a>" else str1="<a href=btn:239>не в седле</a>" & str2="конный"
<html>
Спустя полдня перед вами преддверье Мордора - Гнилые Топи - короткий, но крайне опасный участок пути. Если вы #str1$, то... . А если #str2$ - ...
</html>

end

:245
<script>
expr_action = 'fightStart(7,12,"ХОББОРОТЕНЬ"); afterBattle("81")';
</script>
<html>
Через некоторое время справа от дороги вы замечаете неказистое существо, похожее на хоббита, мирно устроившееся у костра. Вы уже готовы проехать мимо, когда понимаете, что слишком недооценили местных обитателей. Обнажив клыки, существо с омерзительным шипением <a href="javascript: eval(expr_action)">бросается на вашего коня</a>.
</html>

end

:246
inv- Алмаз
if Сапфир then inv_Алмаз=inv_Алмаз+inv_Сапфир & invkill Сапфир
if 1 Перстень с изумрудом then invkill Перстень с изумрудом & inv+ Алмаз
if 1 Перстень с рубином then invkill Перстень с рубином & inv+ Алмаз
if 1 Перстень с топазом then invkill Перстень с топазом & inv+ Алмаз
<html>
Алмаз исчезает в кармане гнома, но все ваши камни (сапфиры, изумруды, рубины, топазы) становятся алмазами. <a href=btn:254>Если у вас были только сапфиры (или в придачу перстень с топазом)</a>, то <...> <a href=btn:249>А если был перстень с рубином или изумрудом</a>, то <...>
</html>

end

:247
if Сапфир then inv_Алмаз=inv_Алмаз+inv_Сапфир & invkill Сапфир
if 1 Перстень с изумрудом then invkill Перстень с изумрудом & inv+ Алмаз
if 1 Перстень с рубином then invkill Перстень с рубином & inv+ Алмаз
if 1 Перстень с топазом then invkill Перстень с топазом & inv+ Алмаз
<html>
Осторожно капнув на грань любого из камней, вы с удивлением <a href=btn:264>обнаруживаете, как со змеиным шипением он превращается в алмаз</a> (если у вас имеются другие камни, можете превратить и их).
</html>

end

:248
<html>
Спустя полдня перед вами <a href=btn:239>Гнилые Топи</a> - короткий, крайне опасный участок пути.
</html>

end

:249
<html>
К сожалению, позвать на подмогу его хозяина вам не удастся. Хотели вы этого или нет, <a href=btn:254>в алмазы превратились все ваши камни</a>.
</html>

end

:250
<html>
В полночь ручей наполняется таинственным лиловым сиянием, а на прибрежном камне появляется один из самых чудесных сюрпризов леса - Ундина. Привлеченная игрой света на камнях вашей диадемы, которую вы сжимаете под рукой, она просит вас подарить один из алмазов, а взамен предлагает волшебную флягу, которая будет превращать в алмазы все драгоценные камни, которые попадутся вам на пути. <a href=btn:260>Согласитесь на ее предложение</a> или <a href=btn:251>откажитесь</a>?
</html>

end

:251
<html>
Отрицательно покачав головой, вы отказываетесь от сделки и Ундина, грустно улыбнувшись, <a href=btn:264>тает в лунном свете</a>.
</html>

end

:252
<html>
Отрицательно покачав головой, продолжаете свой путь. <a href=btn:184>До Мордора уже недалеко</a>.
</html>

end

:253
proc lose
<html>
Бой кровопролитен, но недолог. Изнемогая от ран, вы и ваш спутник сползаете с лошадей, чтобы успокоится навеки. Последнее, что вы видите - залитый кровью, расшитый золотом камзол проводника.
</html>

end

:254
<script>
IncreaseLuck();
</script>
<html>
Попрощавшись с гномом и почистив 1 из квадратов удачи, вы отправляетесь дальше. <a href=btn:184>До Мордора уже недалеко</a>.
</html>

end

:255
proc lose
<html>
Бой кровопролитен, не недолог. Изнемогая от ран, вы сползаете с лошади, чтобы успокоиться навеки. Последним вы видите, как незнакомец в черном плаще врезается в задние ряды разбойников, сокрушая черепа могучим мечом. И, как знать, быть может, он пытался вас спасти?
</html>

end

:256
<html>
Но вот и новый встречный путник - на этот раз огромный (в половину вашего роста) гном, одетый во все зеленое, не спеша шагает по встречной тропинке. Гномы охочи до богатства, и он предлагает вам сделку (тем более что из заплечного мешка показался краешек вашей диадемы). За любой отданный из вашей коллекции алмаз он готов превратить в алмазы все ваши прочие драгоценные камни, если они у вас есть. <a href=btn:246>Согласитесь на это</a> или <a href=btn:252>нет</a>?
</html>

end

:257
if Сапфир then inv_Алмаз=inv_Алмаз+inv_Сапфир & invkill Сапфир
if 1 Перстень с изумрудом then invkill Перстень с изумрудом & inv+ Алмаз
if 1 Перстень с рубином then invkill Перстень с рубином & inv+ Алмаз
if 1 Перстень с топазом then invkill Перстень с топазом & inv+ Алмаз
<html>
Осторожно капнув на грань любого из камней, вы <a href=btn:264>обнаруживаете, как со змеиным шипением он превращается в алмаз</a>. Однако хотели вы этого или нет, на помощь Арагорна отныне рассчитывать не придется.
</html>

end

:258
<html>
Вам повезло, что ваши кони и сильнее, и быстрее преследователей. За считанные мгновения становится ясно, что догнать вас нет никакой возможности, и вы <a href=btn:31>оставляете погоню далеко позади</a>.
</html>

end

:259
<html>
Однако человек в плаще не разделяет ваш энтузиазм, и приходится показать врагу спину. <a href="javascript: CheckEscapeChase('258', '253')">Киньте трижды кубик за себя и за преследователей</a>. Если ваш результат окажется больше, то вам повезло и вы сумели уйти от погони.
</html>

end

:260
inv- Алмаз
inv+ Фляга
<script>
IncreaseLuck();
</script>
<html>
Ундина подхватывает алмаз и со звонким смехом тает в лунном свете, а перед вами - обросшая водорослями фляга с какой-то жидкостью. Кроме того, можете <a href=btn:262>почистить один из квадратов удачи</a>.
</html>

end

:261
if onHorse=1 then str1="пеший" & str2="<a href=btn:193>конный</a>" else str1="<a href=btn:112>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:262
<script>
expr_action  = 'if (UrqEval("1 Перстень с изумрудом")) { readParagraph("257"); void(0); } else alert("У Вас нет такой вещи!")';
expr_action2 = 'if (UrqEval("1 Перстень с топазом")) { readParagraph("247"); void(0); } else  alert("У Вас нет такой вещи!")';
expr_action3 = 'if (UrqEval("1 Сапфир")) { readParagraph("247"); void(0); } else  alert("У Вас нет такой вещи!")';
</script>
<html>
Если вы хотите испробовать ее действие на <a href="javascript: eval(expr_action)">перстне с изумрудом</a> и он у вас есть, то <...> Если на <a href="javascript: eval(expr_action2)">топазе</a> или <a href="javascript: eval(expr_action3)">сапфире</a>, <...> Если у вас <a href=btn:264>ни того, ни другого, ни третьего</a>, то <...>
</html>

end

:263
<html>
После многочасовой скачки сумерки застают вас на самой окраине Черного леса. Не рискуя углубится в дебри дальше, вы укладываетесь на ночлег на берегу живописного ручья, озаряемого полной луной. Если за предыдущий день ничего не ели, <a href=btn:250>опорожните свои запасы и восстановите 4 силы</a>.
</html>

end

:264
param=2
proc addStrength
<html>
Вы долго не можете заснуть после встречи с Ундиной и засыпаете лишь под утро (восстановите 2 силы). С рассветом на вашем пути снова <a href=btn:94>непролазные чащи Черного леса</a>.
</html>

end

:265
if onHorse=1 then str1="пеший" & str2="<a href=btn:244>конный</a>" else str1="<a href=btn:248>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:266
<html>
Среди бесплодной, выжженной, изуродованной земли проходит первая дорога к Изгарным горам и бастиону тьмы Барад-Дуру. <a href=btn:282>Направитесь по ней</a> или <a href=btn:288>нет</a>?
</html>

end

:267
<html>
Далеко отъехать вы не успеваете. За вами устремляется погоня во главе с рыжим верзилой из трактира. Сомнений нет - шайка разбойников всерьез намеревается увеличить свой капитал. <a href=btn:378>Попытаетесь скрыться от преследователей</a> или <a href=btn:255>примете бой</a>?
</html>

end

:268
<html>
<a href="javascript: CheckEscapeChase('270', '255')">Киньте кубик трижды за себя и за преследователей</a>. Если ваш результат больше, то вам посчастливилось уйти от погони.
</html>

end

:269
<html>
Далеко отъехать вы не успеваете. За вами устремляется погоня во главе с рыжим верзилой из трактира. Сомнений нет - шайка разбойников всерьез намеревается увеличить свой капитал. <a href=btn:268>Попытаетесь скрыться от преследователей</a> или <a href=btn:255>примете бой</a>?
</html>

end

:270
<html>
Благодаря сильному и быстрому жеребцу вам без труда удается оторваться от преследователей, <a href=btn:53>оставляя погоню далеко позади</a>.
</html>

end

:271
if 1 Моргульский клинок then str1="<a href=btn:273>такой же клинок, как у противника</a>" & str2="нет" else str1="такой же клинок, как у противника" & str2="<a href=btn:50>нет</a>"
<html>
Если у вас есть #str1$, то <...> Если #str2$, <...>
</html>

end

:272
if 1 Моргульский клинок then str1="<a href=btn:274>такой же клинок, как у противника</a>" & str2="нет" else str1="такой же клинок, как у противника" & str2="<a href=btn:275>нет</a>"
<html>
Если у вас есть #str1$, то <...> Если #str2$, <...>
</html>

end

:273
inv- Моргульский клинок
<script>
if (newGame) removeItem('Моргульский клинок');
expr_action = 'fightStart(9,2,"ПРЕДВОДИТЕЛЬ НАЗГУЛОВ"); prevStrength = Strength; afterBattle("100", "Strength < prevStrength", "die")';
</script>
<html>
Если у вас действительно имеется моргульский клинок, добытый в бою у одного из назгулов, <a href="javascript: eval(expr_action)">используйте его</a> и в случае успешного исхода боя замените вражеским.<!-- Киньте кубик за себя и за противника.--> Если ваша мощность удара больше, то предводитель назгулов сгинет, и вы можете забрать его оружие, но если ему удается ранить вас, считайте путешествие законченным.
</html>

end

:274
inv- Моргульский клинок
<script>
if (newGame) removeItem('Моргульский клинок');
expr_action = 'fightStart(11,2,"ПРЕДВОДИТЕЛЬ НАЗГУЛОВ"); prevStrength = Strength; afterBattle("100", "Strength < prevStrength", "die")';
</script>
<html>
Если у вас имеется моргульский клинок, можете его <a href="javascript: eval(expr_action)">использовать</a>.<!-- Киньте кубик за себя и за противника, и--> В этой схватке победителем выйдет тот, у кого сила удара выше.
</html>

end

:275
<script>
expr_action = 'fightStart(11,8,"ПРЕДВОДИТЕЛЬ НАЗГУЛОВ"); prevStrength = Strength; afterBattle("100", "Strength < prevStrength", "die")';
</script>
</html>
В случае успешного <a href="javascript: eval(expr_action)">боя</a> - <...>
</html>

end

:276
if RingUsed=0 then str="<a href=btn:105>в первый</a>, второй или в третий раз?"
if RingUsed=1 then str="в первый, <a href=btn:63>второй</a> или в третий раз?"
if RingUsed=2 then str="в первый, второй или <a href=btn:60>в третий раз</a>?"
if 1 Моргульский клинок and 1 Плащ назгула then str2="<a href=btn:278>разыграть роль посланника Мордора</a>" else str2="разыграть роль посланника Мордора"
<html>
Вы решаете обогнуть перевал с востока, где в облаке пыли показалось войско союзников Саурона. Авангард заметил вас и готовится к встрече. Если у вас есть моргульский клинок и плащ назгула, вы можете #str2$. Если же нет, или имеется только клинок, у вас остается последняя возможность - надеть кольцо и спастись невидимкой от тучи стрел. Но в который раз вы одеваете его: #str$
</html>

end

:277
<html>
Приставив клинок к длиной шее Горлума, вы устраиваете ему допрос посередине ночи. Извиваясь в отвратительных ужимках, тот плаксиво умоляет отдать ему "его прелесть", т.е. магическое Кольцо, украденное у него десятки лет назад "мерзким хоббитом" Бильбо Бэггинсом. <a href=btn:287>Сохраните жизнь бесполезному существу</a>, хорошенько припугнув, чтобы в дальнейшем он и не вздумал вас преследовать, или вам спокойнее <a href=btn:286>уничтожить подлую тварь</a>?
</html>

end

:278
<html>
Союзники врага принимают вас за назгула (а на кого, по-вашему, вы еще похожи с саваном на плечах и смертоносной сталью в ножнах?) после чего ждут ваших приказов. <a href=btn:167>Возглавите отряд и приведете его к главным воротам</a> или просто <a href=btn:285>свернете его с пути и отправите через перевал Кирит-Унгол</a>?
</html>

end

:279
<html>
Камень притянул вас к себе и не отпустит ни за что на свете. <a href=btn:290>Придется сбросить доспехи</a>, иначе через полчаса вас заметит крылатый назгул, который доставит своему владыке незадачливого пленника и кольцо Всевластья.
</html>

end

:280
<script>
expr_action = 'fightStart(6,10,"ГОРЛУМ"); battleEndCondition("enemy [0].Strength == 2"); afterBattle("277")';
</script>
<html>
Однако выспаться на этот раз вам не удается. В тот момент, когда и без того тусклая луна скрывается во мраке черных туч, на вас накидывается мерзкого вида тварь, длинные цепкие пальцы которой тянутся к вашему горлу. Это Горлум - пещерное существо, покинувшее свои подземные гроты по какой-то причине - <a href="javascript: eval(expr_action)">пытается свести с вами счеты</a>.<!-- Если вы уменьшили силу противника до двух, то 277.-->
</html>

end

:281
<html>
У обветшалых стен некогда могучей крепости вам попадается величественный витязь на рослом жеребце. С интересом оглядев вас с головы до ног, он спрашивает, что привело вас в эти негостеприимные места. <a href=btn:297>Расскажете о цели путешествия</a>, <a href=btn:289>представитесь одним из дунаданцев</a> (одиноких рыцарей исчезнувшего Арнора) или <a href=btn:300>потребуете, чтобы он вначале назвал себя</a>?
</html>

end

:282
<html>
Вы оказываетесь на пороге мрачного ущелья, где две массивные скалы по бокам дороги со страшным грохотом сходятся друг с другом, так что вы едва успеваете отскочить в сторону. Конечно, движущиеся скалы могут в один миг сделать из вас лепешку, если вы окажетесь между ними, но выбор за вами. <a href=btn:294>Рискнете проскочить, когда они раздвинутся</a> или <a href=btn:288>поищете иной путь</a>?
</html>

end

:283
<html>
Вы уже сворачиваете к ним, когда чувствуете, как ваши доспехи неудержимо тянет к одному из камней как магнитом. Вы с трудом вырываетесь из колдовских объятий камня и попадаете под действие второго. <a href=btn:293>Отпрянете назад</a>, <a href=btn:290>сбросите доспехи</a> или <a href=btn:295>попытаетесь пробраться точно между ними</a>?
</html>

end

:284
param=2
proc addStrength
<html>
Ночь проходит спокойно и восстановит 2 силы. Еда восстановит 4, но и пустой желудок отнимает столько же. Утром следующего дня вы отправляетесь дальше, чтобы к вечеру <a href=btn:460>достичь владений Саурона</a>.
</html>

end

:285
<html>
Похвалив себя за находчивость, вы продолжаете свой путь к Ородруину с незащищенной восточной стороны, даже не подозревая, какую "услугу" вы оказали приспешникам Черного мага и какие сюрпризы ожидают их на перевале Кирит-Унгол. Остаток пути проходит без приключений и в сумерках высится конечная цель вашего визита - <a href=btn:221>Огнедышащая гора</a>.
</html>

end

:286
<html>
Меч погружается в клокочущее горло, и спустя миг все кончено. С рассветом вы вновь продолжаете путь и к вечеру <a href=btn:197>достигаете владений Саурона</a>.
</html>

end

:287
GollumSpared=1
<html>
Замахнувшись на Горлума мечом, вы как будто решаетесь снести ему голову, однако того и след простыл. Что ж, наверное, и не стоило пачкать меч о такое ничтожное создание, тем более, что в Мордоре он наверняка не решится вас преследовать. С рассветом вы вновь продолжаете путь и к вечеру <a href=btn:197>достигаете владений Саурона</a>.
</html>

end

:288
<html>
<a href=btn:283>Ваше внимание привлекают два огромных камня, будто поставленные рукою великана посреди степи</a>.
</html>

end

:289
<script>
expr_action = 'if (UrqEval("1 Перстень с изумрудом")) { readParagraph("225"); void(0); } else alert("У Вас нет такой вещи!")';
</script>
<html>
Вы называетесь светлым рыцарем Арнора, борьба со злом - ваше призвание и вас не пугает дикий край. Но есть ли у вас <a href="javascript: eval(expr_action)">перстень одного из этих арнорцев</a>? Если же <a href=btn:299>нет</a> - <...>.
</html>

end

:290
param=1
proc removeAgility
<html>
Вы сбрасываете с себя доспехи и, собрав все силы, устремляетесь прочь. <a href=btn:78>Камни неохотно отпускают вас</a>, однако теперь вы более уязвимы для противника (потеряйте 1 ловкость).
</html>

end

:291
<html>
Обладая такой ловкостью и смекалкой, вам вполне по силам противостоять колдовству камней, которые <a href=btn:78>неохотно пропускают вас</a>.
</html>

end

:292
<html>
На этот раз все в порядке. Скалы с лязгом сходятся за вашей спиной и остаются навеки неподвижными, перекрывая дорогу всякому, кто отправился бы в путь вслед за вами, а впереди уже виднеется бастион Тьмы - <a href=btn:78>Барад-Дур</a>.
</html>

end

:293
param=2
proc removeStrength
<html>
Попытка противостоять колдовству обходится вам в 2 силы и не приносит результатов. <a href=btn:283>Вернитесь</a> и сделайте другой выбор.
</html>

end

:294
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if ((dice1 + dice2) % 2 == 0) { readParagraph('292'); void(0) } else { readParagraph('296'); void(0) }";
</script>
<html>
<a href="javascript: eval(expr_action)">Киньте кубик дважды</a>.<!-- Если в сумме выпало четное число,то 292, если нечетное, то 296.-->
</html>

end

:295
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if (dice1 + dice2 >= Agility) { readParagraph('279'); void(0) } else { readParagraph('291'); void(0) }";
</script>
<html>
<a href="javascript: eval(expr_action)">Киньте кубик дважды</a>.<!-- Если результат больше или равен вашей ловкости, то 279. Если же меньше, 291.-->
</html>

end

:296
proc lose
<html>
На этот раз ваша участь решена. Вы оказались между молотом и наковальней, так что спустя миг все кончено, а скалы раздвигаются вновь, готовые "перемолоть" очередную жертву...
</html>

end

:297
<script>
expr_action = 'fightStart(10,12,"БОРОМИР"); afterBattle("75")';
</script>
<html>
Лицо витязя омрачает скрытый помысел, после чего <a href="javascript: eval(expr_action)">из его ножен с лязгом вылетает обоюдоострый меч</a>. Конечно, вы не могли знать, что завладеть Кольцом Всевластья стало тайной мечтою Боромира, наследника гондорских князей. Если вы сразили и этого витязя, то можете продолжать свой путь, на этот раз, к Рунному озеру.
</html>

end

:298
<html>
Неожиданно по замку проносится зловещий гул и его стены начинают сотрясаться. <a href="javascript: CheckLuck('176', '83')">Проверьте свою удачу</a>.
</html>

end

:299
<html>
Всадник не верит ни одному вашему слову и... замечает прикованное к цепочке предательски выпавшее <a href=btn:297>Кольцо Всевластья</a>.
</html>

end

:300
<html>
Всадник называется Боромиром, сыном наместника Гондора Денэтора, после чего требует от вас объяснений. <a href=btn:289>Назоветесь рыцарем Светлых Сил</a> или <a href=btn:297>расскажите все</a>, как есть, чтобы, если повезет, испросить у него какой-нибудь совет?
</html>

end

:301
if Лук and 3 Стрела then str="<a href=btn:120>лук и черные стрелы</a>" else str="лук и черные стрелы"
<script>
if (UrqEval("onHorse=0")) AgilityFactor = -1;
expr_action = 'fightStart(8,8,"ПЕРВЫЙ НАЗГУЛ",8,8,"ВТОРОЙ НАЗГУЛ"); battleEndCondition("num_killed == 2"); afterBattle("56", ">4", "301.2")';
expr_action2 = 'if (UrqEval("Лук and 3 Стрела")) { readParagraph("120"); void(0) }';
</script>
<html>
На застилающемся тьмою небосклоне появляются черные точки - трое назгулов на крылатых конях. Хорошо, что в их руках обычные, а не моргульские клинки, но они нападают с воздуха, поэтому, если вы не в седле, во время боя придется уменьшить на 1 свою ловкость. Есть ли у вас #str$? Если нет, вам <a href="javascript: eval(expr_action)">придется иметь дело с двумя одновременно</a>, а через четыре раунда к ним прибавится и третий назгул с такими же ловкостью и силой. Если вам удалось сразить двоих, то <...>
</html>

end

:301.2
<script>
if (UrqEval("onHorse=0")) AgilityFactor = -1;
fightStart(8,enemy [0].Strength,"ПЕРВЫЙ НАЗГУЛ",8,enemy [1].Strength,"ВТОРОЙ НАЗГУЛ",8,8,"ТРЕТИЙ НАЗГУЛ"); battleEndCondition("num_killed == 2"); afterBattle("56");
</script>

end

:302
if GollumSpared=1 then str1="<a href=btn:30>вам встречался прежний хозяин Кольца и вы сохранили ему жизнь</a>" & str2="нет" else str1="вам встречался прежний хозяин Кольца и вы сохранили ему жизнь" & str2="<a href=btn:60>нет</a>"
<html>
Вы стягиваете Кольцо с цепочки и готовитесь забросить его в жерло. Внезапно оно словно наливается свинцом и, оттягивая вам палец, так красиво играет отблесками заката, что вы не имеете ни малейшего желания расставаться с ним. Черные думы одолевают вас. А почему бы вам самому не стать Властелином Мрака, низвергнув Саурона? Если когда-либо на пути #str1$, то <...> Если же #str2$ - <...>
</html>

end

:303
inv- Алмаз
invkill Сапфир
invkill Перстень с изумрудом
invkill Перстень с рубином
invkill Перстень с топазом
<html>
Алмаз исчезает в просторном кармане гнома, а все ваши камни, уступающие алмазам (сапфиры, изумруды, рубины, топазы) на ваших глазах превращаются в битое стекло. Вы с рычанием обнажаете меч, однако того и след простыл. <a href=btn:184>Если у вас были только сапфиры или перстень с топазом</a>, то <...> <a href=btn:307>А если перстень с рубином или изумрудом</a>, то <...>
</html>

end

:304
<html>
Если захотите далеко <a href=btn:309>углубиться в лес</a> - <...> Если <a href=btn:263>заночуете на окраине</a> - <...> А если вам по душе скорее миновать его, то <a href=btn:306>ваш путь лежит к развалинам древней крепости на его восточной стороне</a>.
</html>

end

:305
<html>
"Что ж, дело благородное", - отвечает витязь с уважением и, пожелав удачи, расстается с вами, а <a href=btn:75>вы держите путь к Рунному озеру</a>.
</html>

end

:306
param=6
proc addStrength
<html>
Вы с легкостью вырываетесь из мрачного леса на равнины, однако не успеваете добраться до крепости засветло. Сон и ужин восстановят вам 6 сил, а наутро вы <a href=btn:456>продолжаете путь к непонятным развалинам</a>.
</html>

end

:307
<html>
<a href=btn:184>К сожалению, вызвать на помощь его хозяина вы уже не сможете.</a>
</html>

end

:308
<html>
Но вот и первый встречный путник - на этот раз огромный (в половину вашего роста) гном, одетый во все красное, не спеша шагает по встречной тропинке. Гномы охочи до богатства, и он предлагает вам сделку (тем более, что из заплечного мешка показался краешек вашей диадемы). За отданный алмаз (любой из вашей коллекции) он готов превратить в бриллианты все ваши драгоценности, которые у вас есть. <a href=btn:303>Согласитесь</a> или <a href=btn:252>откажитесь</a>?
</html>

end

:309
<html>
Ночь опускается на Лихолесье раньше, чем вы успеваете добраться куда-либо, так что даже серп луны скрывается за кроной угрожающе шелестящей листвы. Как ни печально, вам придется располагаться на ночлег среди неведомых звуков зловещего леса. <a href=btn:316>Устроитесь в чащобе посреди деревьев</a> или <a href=btn:313>поищете что-то, отдаленно напоминающее поляну</a>?
</html>

end

:310
inv+ Сапфир
<html>
Ваш огнедышащий враг повержен. Грифон, не обращая на вас ни малейшего внимания, взмывает ввысь, и вы уже готовы пожалеть, что рисковали своей миссией ради неблагодарного чудовища, когда обнаруживаете под ногами поистине королевский сапфир. <a href=btn:355>С рассветом следующего дня вы продолжаете путь</a>, оставив Лихолесье позади и не переставая удивляться ночным сюрпризам.
</html>

end

:311
<html>
Новая развилка заставляет вас задуматься. Пойдете <a href=btn:154>направо</a> или по лестнице <a href=btn:151>вниз</a>?
</html>

end

:312
<html>
Перед вами снова два коридора. Изберете <a href=btn:154>левый</a> или <a href=btn:55>правый</a>?
</html>

end

:313
<script>
expr_action = 'fightStart(10,10,"ГРИФОН"); battleEndCondition("enemy [0].Strength == 4"); afterBattle("313.1")';
</script>
<html>
Поужинав в тусклом свете лунного серпа и восстановив 4 силы, вы тщетно пытаетесь заснуть, когда неожиданно месяц застилает крылатая тень, и на вас пикирует жуткое создание мрака - грифон. Львиные когти чудовища и угрожающе распахнутый клюв явно говорят о его намерениях, и вам ничего не остается, как, вскочив в седло, <a href="javascript: eval(expr_action)">немедленно принять бой</a>.
</html>

end

:313.1
<html>
Вам удалось трижды ранить этого противника. Теперь можете <a href=btn:320>сохранить ему жизнь</a>. Взамен он готов перенести вас на себе в любое место по вашему желанию. Однако <a href=btn:327>если вам по душе окончательно расквитаться с ним</a>, то <...>
</html>

end

:314
<script>
expr_action = 'fightStart(10,10,"ГРИФОН"); afterBattle("319")';
</script>
<html>
<a href="javascript: eval(expr_action)">Вы вступаете в бой на стороне василиска</a>.
</html>

end

:315
<html>
Куда вы отправитесь, покинув Фангорн? <a href=btn:263>В Мрачные Глубины Лихолесья</a>? К <a href=btn:95>Рунному озеру</a> или <a href=btn:81>Серым горам</a>?
</html>

end

:316
param=4
proc addStrength
<html>
Поужинав и восстановив 4 силы, вы тщетно пытаетесь заснуть, когда с озаряемой всполохами соседней поляны доносится истошный рев. Вскочив в седло и обнажив меч, вы замечаете кошмарную картину: прямо посередине поляны крылатый лев с мордой грифа сцепился с чудовищным ящером с петушиной головой. Скудные знания позволяют вам определить в чудовищах грифона и василиска, как считалось ранее, навеки исчезнувших в конце Первой эпохи. Запустив когти в панцирь василиска, грифон ослаб не меньше, обдаваемый пламенем своего врага. Глаза существ обращены в вашу сторону, и вы готовы усомниться, что каждый из них не зовет вас к себе на помощь. Пришпорите коня и <a href=btn:317>покинете место битвы</a> или вступитесь за одного из монстров? Тогда на кого вы намерены напасть: <a href=btn:314>грифона</a> или <a href=btn:318>василиска</a>?
</html>

end

:317
<html>
После такой кошмарной ночи вы уже не рискуете заснуть и проводите ее остаток бодрствуя. С рассветом следующего дня <a href=btn:94>вы продолжаете путь</a>.
</html>

end

:318
<script>
expr_action = 'fightStart(10,10,"ВАСИЛИСК"); afterBattle("310")';
</script>
<html>
<a href="javascript: eval(expr_action)">Вы вступаете в бой на сторону грифона</a>.
</html>

end

:319
inv+ Алмаз
<html>
Ваш крылатый враг повержен. Василиск, не обращая на вас ни малейшего внимания, уползает в непроходимую чащу, с оглушительным треском круша вековые деревья, и вы уже жалеете, что рисковали своей миссией ради неблагодарного чудовища, когда у самых ног обнаруживаете поистине королевский алмаз. <a href=btn:355>С рассветом следующего дня вы продолжаете путь</a>, не переставая удивляться ночным сюрпризам и оставляя Лихолесье позади.
</html>

end

:320
<html>
Вы до конца не уверены, что поступаете правильно (тем более, что вам приходится оставлять на произвол судьбы собственного жеребца), но выбор сделан. Куда вы потребуете, чтобы грифон доставил вас: туда, где вы найдете <a href=btn:326>алмазы</a>, <a href=btn:323>помощь</a>, <a href=btn:321>совет</a>, <a href=btn:324>союзника</a>?
</html>

end

:321
<html>
Восстановив силы, грифон взмывает ввысь с первыми лучами солнца и, миновав Лихолесье, плавно <a href=btn:456>сбрасывает вас на одну из равнин</a>.
</html>

end

:322
param=2
proc removeStrength
<html>
Вам повезло - вы падаете в заполненный водой ров в том месте, где городскую стену подмывает река Брандуин. Но удар от падения настолько силен, что вы не успеваете достичь берега, <a href=btn:188>теряя сознание</a>, а вместе с ним и 2 силы.
</html>

end

:323
<html>
Восстановив силы, грифон взмывает ввысь с первыми лучами солнца и к полудню достигает мощной, окруженной рвом и валом крепости. Напуганные крылатым чудовищем, лучники открывают стрельбу с бойниц. Увернувшийся от стрел грифон делает крутой вираж, а вы, не удержавшись на его широкой спине, <a href=btn:322>с ужасным криком летите вниз</a>.
</html>

end

:324
<html>
Восстановив силы, грифон взмывает ввысь с первыми лучами солнца и к вечеру следующего дня <a href=btn:396>доставляет вас в живописную долину реки Быстротечной</a>.
</html>

end

:325
<html>
Сила ваших алмазов позволяет окинуть всевидящим взглядом пустынные земли Мордора. Но что вы хотите увидеть? <a href=btn:332>Ородруин</a>, <a href=btn:334>бастион Тьмы Барад-Дур</a> или <a href=btn:330>самого Саурона</a>?
</html>

end

:326
<html>
Восстановив силы, грифон взмывает ввысь, и с первыми лучами солнца <a href=btn:59>переносит вас в самое сердце далекого незнакомого леса</a>.
</html>

end

:327
<script>
expr_action = 'fightStart(10,4,"ГРИФОН"); afterBattle("317")';
</script>
<html>
<a href="javascript: eval(expr_action)">Вы продолжаете бой</a>.
</html>

end

:328
if inv_Алмаз<5 then str1="прошлое" & str2="настоящее" & str3="будущее"
if inv_Алмаз=5 then str1="<a href=btn:331>прошлое</a>" & str2="настоящее" & str3="будущее"
if inv_Алмаз=6 then str1="прошлое" & str2="<a href=btn:325>настоящее</a>" & str3="будущее"
if 7 Алмаз then str1="прошлое" & str2="настоящее" & str3="<a href=btn:333>будущее</a>"
<html>
Крадучись пробираясь в сумерках, вам удается без помех миновать первый боевой форпост Врага - Минас-Моргул. Среди высоких башен ваше внимание привлекает зловещий обелиск, яркий свет которого, льющийся с вершины, невольно принуждает вас зажмуриться. От башни исходит чудовищный ветер, заставляющий никнуть к земле все живое, что приближается к Крепости, но то, что вы приняли за огненный шар на вершине, на самом деле палантир - глаз Врага, а, быть может, не только его, ибо сотворен неизвестно кем в смутных веках Изначальной эпохи. Если <a href=btn:329>не желаете рисковать или на вашей диадеме не больше четырех алмазов</a>, <...> А если пять и более, можете вновь заглянуть в него и, быть может, узнать свою судьбу. В этом случае, если у вас 5 алмазов, вы увидите со стороны свое #str1$, если шесть - #str2$, а если семь - #str3$.
</html>

end

:329
<html>
Неожиданно палантир гаснет, и вы вновь остаетесь наедине со своими мыслями. Вам лучше <a href=btn:266>побыстрее покинуть преддверье Мордора</a>, чтобы не вызывать нового шквала, а быть может, и чего-то похуже.
</html>

end

:330
<html>
Вы совершили роковую ошибку, ибо спустя мгновение на палантире проявляется чудовищный лик Хозяина Кольца, и вам приходится состязаться в чародействе с могущественнейшим из колдунов. Даже начиная развоплощаться и до конца не понимая, в какую ловушку вы угодили, вы полны решимости и <a href=btn:60>пытаетесь сбросить наваждение</a>.
</html>

end

:331
<html>
Стараясь не ослепнуть, вы напряженно всматриваетесь в глубину палантира, на поверхности которого как в калейдоскопе проносятся все ваши приключения, начиная с Эриадора. Расставание с жеребцом навевает вам мрачные мысли, а кроме того <a href=btn:329>появляется смутное чувство</a>, будто вы пропустили на своем пути что-то очень важное, сделали что-то не так, а то и вовсе допустили роковую ошибку.
</html>

end

:332
<html>
Огненная гора грозно высится в глубинах палантира. Вокруг никого не видно, однако языки пламени вырываются не только из жерла, но и от одной из боковых пещер. <a href=btn:329>Это заставляет вас задуматься</a>.
</html>

end

:333
<html>
Поскольку увидеть свое точное, не зависящее от вашего выбора будущее (хотя бы недалекое) довольно трудно, картина получается размытой. Вы видите себя на незнакомой местности посреди двух огромных валунов, <a href=btn:329>от которых (в этом вы уверены) исходит Зло</a>.
</html>

end

:334
<html>
Несмотря на сумерки, Бастион Тьмы уже погружен во мрак. В воздухе носятся смутные крылатые тени, что-то сильно напоминающие, проходы усеяны орками, а на востоке к нему <a href=btn:329>медленно движется многочисленный отряд</a>.
</html>

end

:335
<script>
expr_action = 'fightStart(10,8,"МЕДВЕДЬ"); battleEndCondition("enemy [0].Strength == 4 || Strength <= 5"); afterBattle("335.1")';
//expr_action = 'fightStart(10,8,"МЕДВЕДЬ"); battleEndCondition("enemy [0].Strength == 4 || Strength <= 5"); afterBattle("348")';
</script>
<html>
Неожиданно великан отступает и, отбросив топор, превращается в огромного черного медведя. Каждая рана, нанесенная когтистой лапой, будет стоить вам двух сил. <a href="javascript: eval(expr_action)">Вы продолжаете бой</a>.
</html>

end

:335.1
if Strength > 5 then goto 348 else goto 336
<script>
//if (enemy [0].Strength == 4) readParagraph("348"); else readParagraph("336");
</script>

end

:336
<html>
Становится ясно, что схватка грозит вам гибелью. Можете попытаться <a href=btn:341>выскочить в окно</a> или сделать то же самое, <a href=btn:339>надев Магическое Кольцо</a>.
</html>

end

:337
if onHorse=1 then str1="пеший" & str2="<a href=btn:180>конный</a>" else str1="<a href=btn:353>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:338
<html>
Неожиданно хородримец трубит в рог, созывая подмогу, и спустя мгновение <a href=btn:359>вы окружены многочисленным отрядом врагов</a>.
</html>

end

:339
RingUsed=RingUsed+1
<html>
Ваши пальцы лихорадочно нащупывают Магическое Кольцо, после чего вас покрывает невидимое облако. Теперь <a href=btn:340>выбраться из усадьбы не составляет труда</a>, а может быть, это как раз тот случай, когда Кольцо спасло вам жизнь.

end

:340
<html>
Вы огибаете Каррок с восточной стороны и <a href=btn:367>продолжаете путь</a>, на этот раз, к реке Быстротечной.
</html>

end

:341
<html>
<a href="javascript: CheckLuck('346', '352')">Проверьте свою удачу</a>.
</html>

end

:342
<html>
Сами того не ожидая, вы угодили в жилище Беорна - одинокого гиганта-оборотня, происхождение и прошлое которого не смог прочесть бы даже Майлин. Глаза хозяина наливаются неистовой злобой, и со звериным рыком, от которого холодеет кровь, он атакует вас топором, каждый удар которого, попавший в цель, отнимает у вас 3 силы. <a href=btn:356>Примете бой</a>, благо противник кажется неповоротливым, или <a href=btn:341>попытаетесь выскочить в открытое окно</a>.
</html>

end

:343
if onHorse=1 then str1="пеший" & str2="<a href=btn:369>конный</a>" else str1="<a href=btn:359>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:344
RingUsed=RingUsed+1
<html>
Не в силах противостоять злой воле, вы надеваете Кольцо на палец и чувствуете присутствие Черного мага как если бы он находился рядом. Враг перехитрил вас, и теперь знает не только в чьих руках его Кольцо, но и где вы. <a href=btn:407>Внезапно односторонний контакт с хозяином Кольца обрывается</a>.
</html>

end

:345
<html>
Миновав ворота, вы ступаете в распахнутые настежь двери, после чего вашему взору открывается огромный стол, ломящийся под тяжестью меда, сдобы и разной прочей снеди. По бревенчатому полу свободно ходят овцы и пони, однако хозяина нигде не видно. <a href=btn:340>Покинете усадьбу</a> или <a href=btn:351>вам не терпится дождаться хозяина</a>?
</html>

end

:346
<html>
С легкостью проскочив в оконный проем, вы с завидной скоростью прыгаете в седло и, пришпорив жеребца, <a href=btn:340>переводите дух только по ту сторону горы Каррок</a>.
</html>

end

:347
<html>
Поборов далекий приказ Врага, <a href=btn:407>вы устремляетесь дальше</a>.
</html>

end

:348
<html>
Беорн отступает к двери, начиная <a href=btn:336>превращаться в кого-то еще</a>.
</html>

end

:349
<html>
<a href="javascript: CheckLuck('354', '357')">Проверьте свою удачу</a>.
</html>

end

:350
<html>
Неожиданно, словно повинуясь какой-то древней магии, зыбкая почва уходит из-под ног, и лишь жеребец, взвившись на дыбы, <a href=btn:418>пытается спастись галопом от разверзнувшейся бездны</a>.
</html>

end

:351
<html>
Проходит час, и ваше терпение иссякает. <a href=btn:340>Покинете усадьбу</a> или <a href=btn:365>предпочтете сделать это после сытного обеда</a>.
</html>

end

:352
proc lose
<html>
Пока вы собираетесь с мыслями, противник наносит вам смертельный удар. Ни Мордор, ни Элгариол вам уже не суждено увидеть.
</html>

end

:353
<html>
Без помощи четвероногого товарища преодолеть ущелье вы не в состоянии. Что ж, это как раз тот случай, когда <a href=btn:123>приходится отступить</a>.
</html>

end

:354
<html>
Нахальство - второе счастье. На этот раз все в порядке и, с аппетитом пообедав, <a href=btn:340>вы покидаете странную усадьбу</a>.
</html>

end

:355
<html>
Впереди уже высится гора Каррок, когда вы чувствуете непреодолимое желание надеть Магическое Кольцо. <a href="javascript: CheckWill('347', '344')">Проверьте свою волю</a>.
</html>

end

:356
<script>
enemyStrengthFactor = 3; fightStart(8,12,"БЕОРН"); battleEndCondition("enemy [0].Strength == 4"); afterBattle("335");
</script>

end

:357
<html>
Вы едва поднимаетесь из-за стола, когда распахнувшиеся с резким грохотом двери <a href=btn:342>заслоняет могучая фигура чернобородого великана</a>.
</html>

end

:358
if Agility<=10 then str1="<a href=btn:408>ваша ловкость меньше или равна 10</a>" && str2="больше" else str1="ваша ловкость меньше или равна 10" && str2="<a href=btn:404>больше</a>"
<html>
Бой становится неизбежным. Однако ваш противник имеет мало представления о том, что такое рыцарская честь</a>. Если #str1$, то <...>. Если #str2$ - <...>
</html>

end

:359
<html>
Если <a href=btn:381>вы решили воспользоваться Магическим Кольцом</a>. <a href=btn:207>Иначе</a> - <...>
</html>

end

:360
inv+ 3,Стрела
<html>
Ваш недруг, теряя последние силы, падает с коня, рассыпая по траве черные стрелы из заплечного колчана. Можете подобрать три из них, после чего вам придется поспешить, так как соплеменники убитого, поднимая вой, <a href=btn:343>устремляются в погоню</a>.
</html>

end

:361
<html>
Если <a href=btn:415>вы решили воспользоваться Магическим Кольцом</a>, чтобы стать невидимкой, то <...> Если же <a href=btn:207>нет</a> - <...>
</html>

end

:362
<html>
Узкая тропа приводит вас к высокому гроту, у входа в который навеки замерли два Каменных Гиганта. <a href=btn:529>Обследуете грот</a> или поспешите <a href=btn:379>покинуть странное место</a>?
</html>

end

:363
<html>
Превознемогая невесть откуда взявшуюся тревогу, <a href=btn:372>вы ступаете в темный провал</a>, сжимая в руке кинжал Майлина, которой, словно ожидая этого, то ярко вспыхивает, то гаснет, озаряя всполохами пещерную тьму.
</html>

end

:364
<script>
expr_action = 'if (UrqEval("onHorse=0")) AgilityFactor = -1; fightStart(9,10,"ХОРОДРИМЕЦ"); afterBattle("360", ">5", "368")';
</script>
<html>
Противник с лязгом выхватывает меч, а если вы где-то потеряли собственного жеребца, придется уменьшать во время боя свою ловкость на 1. Теперь <a href="javascript: eval(expr_action)">сражайтесь</a>. <!--Если он повержен за 5 раундов атаки, 360. Если же нет - 368.-->
</html>

end

:365
param=6
proc addStrength
<html>
Убранство роскошного стола располагает к сытой трапезе (можете восстановить 6 сил). Поспешите <a href=btn:349>покинуть "гостепреимный" дом</a> или <a href=btn:375>вам по-прежнему интересно, кто в нем хозяин</a>?
</html>

end

:366
<html>
Вы полны решимости добраться до того секрета, который (вы в этом уверены) скрывает собой грот. Однако кинжал Майлина отказывается светиться в темноте, а по пещерным сводам проносится зловещий гул. Поскольку на самом деле вы не являетесь потомком Элендила, вам лучше всего <a href=btn:511>убираться восвояси</a>, не дожидаясь тех сюрпризов, которые вам готовит древнее колдовство.
</html>

end

:367
<html>
На берегу вы вскоре сталкиваетесь с многочисленным отрядом приспешников Врага - хородримцами. Бронзовые шлемы всадников горделиво украшают конские хвосты, а копья авангарда лениво направляются в вашу сторону. Уверенные в своем превосходстве, они не чувствуют в вас никакой угрозы, и лишь <a href=btn:406>один из всадников на полном скаку приближается к вам</a>.
</html>

end

:368
<html>
На помощь соплеменнику приходит пол-отряда, и спустя мгновение <a href=btn:359>вас окружает скопище врагов</a>.
</html>

end

:369
<html>
<a href="javascript: CheckLuck('373', '410')">Проверьте свою удачу</a>.
</html>

end

:370
<script>
expr_action = "if (UrqEval('1 Перстень с изумрудом')) { readParagraph('450'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Если у вас действительно имеется <a href="javascript: eval(expr_action)">перстень с изумрудом</a>, которым одарил вас принц, то вы знаете, что надо делать. Если же нет, остается <a href=btn:244>искать иные пути в обход Белых гор</a> или попытаться все же <a href=btn:380>пробраться через заколдованное ущелье</a>.
</html>

end

:371
if MoriaPassed=1 then str1="<a href=btn:366>сумели выбраться из Мории</a>" && str2="Иначе" else str1="сумели выбраться из Мории" && str2="<a href=btn:363>Иначе</a>"
<html>
Если вас не пугают лабиринты и вы в свое время #str1$ - <...> #str2$ - <...>
</html>

end

:372
inv+ Меч Исилдура
inv+ Алмаз
<script>
IncreaseLuck();
if (newGame) addItem('Меч Исилдура');
</script>
<html>
Величественный грот заканчивается полутемной залой, где среди груды истлевшего хлама блестит настоящее сокровище - <a href=btn:510>меч Исилдура</a>, ножны которого украшает огромный бриллиант. Киньте кубик и можете почистить выпавшее число удачи.
</html>

end

:373
<html>
Несмотря на многочисленность отряда, вам ничего не стоит в поднявшейся сумятице скрыться среди разверзнутых провалов прибрежных скал. Вскоре вы можете перевести дух, <a href=btn:377>оставляя погоню далеко позади</a>.
</html>

end

:374
if Agility<=10 then str1="<a href=btn:364>ваша ловкость меньше или равна 10</a>" && str2="больше" else str1="ваша ловкость меньше или равна 10" && str2="<a href=btn:338>больше</a>"
<html>
Бой становится неизбежным. Однако ваш противник имеет мало представления о том, что такое рыцарская честь</a>. Если #str1$, то <...>. Если #str2$ - <...>
</html>

end

:375
<html>
Через некоторое время в распахнувшиеся с резким скрипом двери <a href=btn:342>вваливается могучий чернобородый великан</a>.
</html>

end

:376
<html>
И вновь перед вами развилка. Свернете <a href=btn:442>налево</a> или <a href=btn:449>начнете подъем по винтовой лестнице</a>?
</html>

end

:377
<script>
expr_action = "if (UrqEval('1 Перстень с изумрудом')) { readParagraph('370'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Спустя некоторое время вам преграждает путь негостепреимное ущелье, обрывистые края которого исчезают в густом тумане. Неожиданно над скалами проносится зловещее эхо, и замогильные голоса, от которых леденеет кровь, грозно предупреждают: "Только потомок Элендила пройдет здесь!" Если у вас на пальце имеется <a href="javascript: eval(expr_action)">перстень Арагорна</a>, то <...> В противном случае, если опасность вас не пугает и <a href=btn:380>вы полны решимости перебраться на противоположный склон</a>, тогда <...> А если предпочтете не рисковать, остается лишь <a href=btn:244>поискать обходные пути</a>.
</html>

end

:378
<html>
<a href="javascript: CheckEscapeChase('258', '253')">Киньте кубик трижды за себя и за преследователей.</a><!-- Если ваш результат оказался больше, то 258, а если иначе (253).-->
</html>

end

:379
<script>
if (foodAmount == 0) modifyStrength(-4);
</script>
<html>
Миновав к исходу дня Белые горы, вы решаете устроиться на ночлег у их подножия. Если у вас осталась дорожная еда, восстановите 4 силы, но если желудок пуст, сколько же придется потерять. Так или иначе <a href=btn:301>на Средиземье опускаются сумерки</a>.
</html>

end

:380
proc lose
<html>
Вы отважно ступаете в белесый туман и с криком срываетесь в непроглядную пропасть. Что ж, магия, пусть даже и не черная, сыграла с вами злую шутку, а ваше путешествие на этом и заканчивается.
</html>

end

:381
if RingUsed=0 then str1="<a href=btn:515>в первый</a>" & str2="во второй" & str3="в третий"
if RingUsed=1 then str1="в первый" & str2="<a href=btn:462>во второй</a>" & str3="в третий"
if RingUsed=2 then str1="в первый" & str2="во второй" & str3="<a href=btn:60>в третий</a>"
<html>
Но в который раз вы надеваете Магическое Кольцо? Если #str1$ - <...>, если #str2$ (что, впрочем, уже небезопасно) - <...> А если #str3$, то <...>
</html>

end

:382
<script>
expr_action =  'if (UrqEval("1 Моргульский клинок")) { readParagraph("393"); void(0); } else alert("У вас нет такой вещи")';
expr_action2 = 'if (UrqEval("1 Плащ назгула")) { readParagraph("393"); void(0); } else alert("У вас нет такой вещи")';
</script>
<html>
Может, с вами есть <a href="javascript: eval(expr_action)">моргульский клинок</a> или <a href="javascript: eval(expr_action2)">плащ назгула</a>? Или <a href=btn:392>вы не встречали на своем пути кольценосца-призрака</a>?
</html>

end

:383
<html>
Ответите, что служите <a href=btn:391>королю Элгариола</a>, державному властителю Колец и Соцветий <a href=btn:392>Саруману Белому</a> или Владыке Мрака, <a href=btn:393>Черному Властелину</a>, да не будет он назван всуе?
</html>

end

:384
<html>
Поборов далекий приказ Врага, <a href=btn:388>вы устремляетесь вперед</a>.
</html>

end

:385
<html>
Подступы к Изену заняты несметными полчищами безобразной нечисти, одновременно напоминающими и людей, и орков. Заметив вас, четверо воинов с обнаженными ятаганами устремляются навстречу, а пятый властным голосом велит немедленно признаться, кому вы служите. <a href=btn:207>Обнажите меч</a>, <a href=btn:383>постараетесь что-нибудь придумать</a> или <a href=btn:186>броситесь в реку</a>, чтобы, если повезет, достичь другого берега раньше, чем основная масса нечисти поднимает переполох?
</html>

end

:386
<script>
expr_action = 'fightStart(11,6,"КОРШУН"); afterBattle("413")';
</script>
<html>
Вы собираетесь начать спуск, когда внезапно на вас пикирует коршун, гнездо которого вы, как оказалось, едва не потревожили. Обнажив меч, <a href="javascript: eval(expr_action)">вы вступаете в бой</a>, и хотя ваш недруг не может похвастаться силой, вы имеете дело с чрезвычайно ловким противником.
</html>

end

:387
param=2
proc removeStrength
<html>
Крепость Последней Надежды - Минас-Тирит - охвачена осадой несметных полчищ Черного Мага. Стараясь пробиться к воротам, вы с Фарамиром врезаетесь в гущу орков, прокладывая путь мечом, но неожиданный удар, нанесенный сзади, едва не ставит точку на вашем путешествии. В глазах темнеет, и <a href=btn:188>вы теряете сознание</a> (а ним и 2 силы), свалившись с берега в воды Андуина.
</html>

end

:388
<html>
Куда теперь лежит ваш путь: на запад, <a href=btn:395>к Белым горам</a> или на северо-запад, <a href=btn:396>к реке Быстротечной</a>?
</html>

end

:389
<html>
На полпути к Мордору вы чувствуете непреодолимое желание надеть Кольцо. <a href="javascript: CheckWill('384', '390')">Проверьте свою волю</a>.
</html>

end

:390
RingUsed=RingUsed+1
<html>
Не в силах противостоять злой воле, вы надеваете Кольцо и чувствуете присутствие Черного мага как если бы он находился рядом. Теперь Враг знает, где и в чьих руках находится Кольцо Всевластья. <a href=btn:388>Внезапно односторонний контакт с хозяином Кольца обрывается</a>.
</html>

end

:391
<html>
"А кто это такой?" - глаза предводителя изумленно лезут на лоб. <a href=btn:383>Вернитесь</a> и сделайте другой выбор.
</html>

end

:392
<html>
Нечисть с явной неохотой убирает оружие в ножны, а предводитель отряда явно доволен. "Это хорошо, - говорит он. - Мы - Урукхай, нет нам числа". После чего теряет к вам всякий интерес, а вы можете направиться дальше, недоумевая, очеловечил ли орков Белый Маг или изуродовал людей. А скорее всего, заимев таких подручных, Саруман предал общее дело и, поддавшись злу, <a href=btn:389>вознамерился овладеть Магическим Кольцом</a>.
</html>

end

:393
<html>
Недоуменно вытаращившись, предводитель рычит от злости, и вам ничего не остается, как <a href=btn:207>принять бой</a>, с трудом уворачиваясь от стрел и копий.
</html>

end

:394
<html>
<a href=btn:445>Туннель приводит вас в самые глубины Морийского подземелья.</a>
</html>

end

:395
<html>
Вы избираете Белые горы и не спеша <a href=btn:172>начинаете подъем по их каменным склонам</a>.
</html>

end

:396
<html>
У самого брода вам попадается незнакомый всадник на рослом жеребце. Его благородное лицо озаряет улыбка. "А, так значит, ты и есть Хранитель!" - произносит он. Вы недоумеваете, как может кто-то в этих местах знать о вашей тайной миссии, но витязь рассеивает ваши сомнения, называясь сыном наместника Гондора, Фарамиром. Уже много лет его княжество ведет непримиримую борьбу со злом, и принц приглашает вас в столицу Гондора Минас-Тирит, уверенный, что только там вы найдете совет и помощь. <a href=btn:387>Согласитесь на предложение неожиданного союзника</a> или <a href=btn:498>откажетесь</a>?
</html>

end

:397
<html>
Ответите, что <a href=btn:398>ищете приключений</a>, что <a href=btn:401>служите Белому магу Саруману</a> или <a href=btn:402>спешите в Ристанию к конунгу Теодену</a>?
</html>

end

:398
<html>
Лицо витязя мрачнеет и спустя мгновение <a href=btn:207>вас окружает кавалькада всадников</a>.
</html>

end

:399
<html>
Пожелав удачи, Фарамир удаляется во владения отца, а вы <a href=btn:367>продолжаете путь вдоль широкого русла реки Быстротечной</a>.
</html>

end

:400
<html>
По дороге навстречу вам попадается отряд Преображающихся эльфов. Вы до конца не осведомлены, что значит их название, но точно уверены, что этот народ, по крайней мере, не подвержен Злу. Предводитель всадников останавливает кавалькаду и, подъехав ближе, расспрашивает о вашей цели. <a href=btn:403>Расскажете правду</a> или <a href=btn:397>придумаете что-нибудь еще</a>?
</html>

end

:401
<html>
Лицо витязя мрачнеет, и спустя мгновение <a href=btn:207>вас окружают всадники</a>.
</html>

end

:402
<html>
"Ты сбился с пути, - сообщает предводитель. - Это дорога к Рунному озеру" - после чего вся кавалькада, не обращая на вас никакого внимания, отправляется дальше, а вы <a href=btn:281>продолжаете путь к непонятным развалинам</a>.
</html>

end

:403
inv+ Медальон с лилией
<html>
"Так значит, ты и есть Хранитель, - одобрительно подытоживает витязь, убирая меч в ножны и, пожелав удачи, крайне не советует вам пробираться в Мордор через Гиблые болота и предлагает избрать для путешествия более безопасные Ристанийские степи. На прощание предводитель эльфов Всеславур протягивает вам медальон с изображением лилии<!-- (+17)-->, который, как считает, вам вскоре пригодится, после чего вся кавалькада устремляется дальше, а <a href=btn:281>вы держите путь к непонятным развалинам</a>.
</html>

end

:404
<html>
Неожиданно вастак трубит в рог, созывая подмогу, и <a href=btn:361>вас окружает многочисленный отряд врагов</a>.
</html>

end

:405
<html>
<a href=btn:376>Длинный без конца туннель уводит вас все дальше</a>.
</html>

end

:406
<html>
Бросив беглый взгляд на ваши доспехи, Хородримец осторожно спрашивает, что привело вас в дикие края. Молча <a href=btn:374>обнажите меч</a> или, положив руку на эфес, <a href=btn:338>ответите, что Черный Маг не предупредил их о вашей тайной миссии для их же блага</a>?
</html>

end

:407
<html>
У самого подножья горы Каррок высится одинокая, внушительных размеров роскошная усадьба. С южной стороны изгороди располагаются бесчисленные островерхий ульи, за воротами виднеются соломенные крыши амбаров. <a href=btn:345>Повернете к усадьбе</a> или <a href=btn:367>продолжите путь в направлении реки Быстротечной</a>?
</html>

end

:408
<script>
fightStart(9,10,"ВАСТАК"); afterBattle("411", "> 5", "404")';
</script>

end

:409
<html>
Через несколько часов пути перед вами снова развилка. <a href=btn:443>Пустынная дорога</a> уходит вдаль, а <a href=btn:420>узенькая тропинка</a> услужливо убегает в ближайший пролесок.
</html>

end

:410
<html>
Увы, удача изменила вам и <a href=btn:359>уйти от преследователей не удается</a>.
</html>

end

:411
<html>
Несмотря на многочисленность отряда, вам ничего не стоит в поднявшейся суматохе скрыться в ближайшем пролеске. Вскоре вы можете перевести дух, <a href=btn:244>оставляя погоню далеко позади</a>.
</html>

end

:412
<html>
На этот раз ловушка сделала свое черное дело. Не удержавшись в седле, вы с криком летите в мрачный провал, после чего <a href=btn:513>над вами смыкается бурая земля</a>, поглощая собой и вас, и диадему, и Магическое Кольцо.
</html>

end

:413
inv+ Алмаз
<script>
IncreaseLuck();
</script>
<html>
В гнезде коршуна вы обнаруживаете крупный алмаз. <a href=btn:454>Киньте кубик</a> и можете почистить 1 из квадратов удачи.
</html>

end

:414
<html>
Предпочтете расположиться на ночлег <a href=btn:459>там, где находитесь</a> или чуть южнее, <a href=btn:184>в пустынных равнинах Нэндальфа</a>?
</html>

end

:415
if RingUsed=0 then str1="<a href=btn:517>в первый</a>" & str2="во второй" & str3="в третий"
if RingUsed=1 then str1="в первый" & str2="<a href=btn:465>во второй</a>" & str3="в третий"
if RingUsed=2 then str1="в первый" & str2="во второй" & str3="<a href=btn:60>в третий</a>"
<html>
Но в который раз вы надеваете Кольцо? Если #str1$ - <...>, если #str2$ (что, впрочем, уже небезопасно) - <...> А если #str3$, то <...>
</html>

end

:416
<html>
Но как это сделать? После долгих блужданий поиски приводят вас в чрево потухшего вулкана, обрезанная вершина которого уходит далеко ввысь и теряется в зубастом зеве скал. Если у вас есть <a href=btn:44>веревка</a>, чтобы выбраться наружу, то <...> Если надеетесь на какое-нибудь <a href="javascript: useItem('Огонь', 486)">заклятье</a>, можете прибегнуть к магии. <a href=btn:490>Иначе</a> - <...>
</html>

end

:417
<html>
Ваше внимание привлекают семь больших камней, расставленных в определенном порядке, смысл которого вам не понятен. <a href=btn:350>Свернете к ним</a> или <a href=btn:492>поспешите к Рунному озеру</a>?
</html>

end

:418
<html>
<a href="javascript: CheckLuck('419', '412')">Проверьте свою удачу.</a>
</html>

end

:419
<html>
Ваш конь настолько легок и быстр, что спустя несколько мгновений ваша жизнь вне опасности, а над уготованной ловушкой с грохотом сходится бурая земля, поглощая собою камни. Теперь <a href=btn:492>путь свободен</a>.
</html>

end

:420
<script>
expr_action = 'fightStart(8,6,"ВАРГИ",7,6,"ВАРГИ"); afterBattle("438")';
</script>
<html>
В конце тропы вам преграждают путь два чудовищных волка. Скудные знания позволяют вам определить в них варгов, которые, хотя и не столь сильны, как их сородичи - волколаки, но в этих местах не менее опасны. Ваш жеребец взвивается на дыбы, и вам ничего не остается, как <a href="javascript: eval(expr_action)">принять бой</a>.
</html>

end

:421
<html>
Туннель резко сворачивает налево снова, и вы не можете отделаться от мысли, что <a href=btn:423>ходите по кругу</a>.
</html>

end

:422
<html>
Туннель резко поворачивает <a href=btn:421>налево</a>.
</html>

end

:423
<html>
<a href=btn:455>Туннель выводит вас к чему-то похожему на новую развилку.</a>
</html>

end

:424
<html>
Перед вами снова три пути: пойдете <a href=btn:427>прямо</a>, <a href=btn:423>налево</a> или <a href=btn:503>направо</a>?
</html>

end

:425
<html>
Если у вас есть [[ перстень одного из этих рыцарей | if 1 Перстень с изумрудом then goto 505 else goto 425 ]] , то вы знаете, что делать. <a href=btn:497>Иначе</a>.
</html>

end

:426
<html>
Туннель заканчивается тупиком. Либо <a href=btn:427>вернитесь</a> и сделайте другой выбор, либо попытайтесь <a href=btn:434>выломать дверь</a> в конце тупика, чтобы узнать, что за ней скрывается.
</html>

end

:427
<html>
Перед вами снова три пути: пойдете по лестнице <a href=btn:431>вверх</a>, <a href=btn:426>направо</a> или <a href=btn:455>налево</a>?
</html>

end

:428
<html>
Бросив беглый взгляд на ваши доспехи, вастак осторожно спрашивает, что привело вас в дикий Край. Молча <a href=btn:404>обнажаете меч</a> или, положив руку на его эфес, <a href=btn:516>ответите, что Черный маг не предупредил их о вашей тайной миссии для их же блага</a>.
</html>

end

:429
<html>
Туннель резко поворачивает налево, а затем <a href=btn:430>уходит вниз</a>.
</html>

end

:430
<html>
Очередной пещерный провал вновь <a href=btn:145>выводит вас на развилку</a>.
</html>

end

:431
<html>
Очередная пещера-туннель приводит вас к новой развилке. Изберете путь <a href=btn:145>прямо</a> или свернете <a href=btn:429>направо</a>?
</html>

end

:432
<html>
Перед вами три пещеры. Обследуете <a href=btn:144>центральную</a>, <a href=btn:433>левую</a> или <a href=btn:431>правую</a>?
</html>

end

:433
<html>
Пещера-туннель резко поворачивает направо, а затем <a href=btn:311>уходит вниз</a>.
</html>

end

:434
param=2
proc removeStrength
<html>
С превеликим трудом (потеряйте 2 силы) дверь удается выломать, однако скрываемый за ней туннель явно не для вашего роста, а потому идти становится труднее. <a href=btn:426>Вернетесь обратно</a> или <a href=btn:452>продолжите путь вперед</a>?
</html>

end

:435
<html>
Новая развилка не заставляет себя ждать. Повернете <a href=btn:394>налево</a> или <a href=btn:439>направо</a>?
</html>

end

:436
<html>
Новая развилка не заставляет себя ждать, и вас встречает винтовая лестница. Взберетесь <a href=btn:441>наверх</a> или спуститесь <a href=btn:440>вниз</a>?
</html>

end

:437
<html>
Новая развилка не заставляет себя ждать. Повернете <a href=btn:449>налево</a> или <a href=btn:444>направо</a>?
</html>

end

:438
inv+ Медальон с пастью волколака
<html>
На шее одного из хищников вы обнаруживаете медальон, изображение на котором украшает оскаленная пасть вожака стаи<!-- (+20)-->. Можете забрать его с собой, после чего <a href=btn:244>ваш путь лежит через раскинувшиеся неподалеку Гиблые Болота</a>.
</html>

end

:439
<html>
<a href=btn:446>Нескончаемый туннель, уходящий вверх, уводит вас все дальше.</a>
</html>

end

:440
<html>
Путь вниз завален обломками. <a href=btn:436>Вернитесь</a> и начинайте подъем.
</html>

end

:441
<html>
Вы взбираетесь по каменным ступеням, пытаясь добраться до верхних ярусов, и вам это удается, но впереди <a href=btn:439>новый туннель</a>, и от него <a href=btn:447>поворот направо</a>.
</html>

end

:442
<html>
<a href=btn:449>Длинный нескончаемый туннель уводит вас все дальше и дальше.</a>
</html>

end

:443
<html>
По дороге навстречу вам попадается многочисленный отряд приспешников Врага - вастаков. Шлемы всадников горделиво украшают бронзовые крылья, а копья авангарда лениво поворачиваются в вашу сторону. Уверенные в собственном превосходстве, они не чувствуют в вас никакой угрозы и лишь <a href=btn:428>один из всадников на полном скаку приближается к вам</a>.
</html>

end

:444
<html>
<a href=btn:451>Длинный без конца туннель уводит вас все дальше и дальше.</a>
</html>

end

:445
<html>
Снова перед вами развилка. Изберете путь <a href=btn:430>налево</a>, <a href=btn:154>направо</a>?
</html>

end

:446
<html>
Туннель выводит вас на одну из вершин Мглистого кряжа. Зажмурившись от яркого света, вы даже не сразу замечаете полузаросшую тропу, которой можете воспользоваться, чтобы <a href=btn:386>спуститься вниз</a>.
</html>

end

:447
<html>
И снова развилка. Изберете поворот <a href=btn:154>налево</a> или <a href=btn:448>направо</a>?
</html>

end

:448
<html>
Туннель приводит вас в самую сердцевину одной из гор и неожиданно <a href=btn:154>заканчивается тупиком</a>.
</html>

end

:449
<html>
<a href=btn:154>Туннель заканчивается тупиком</a>.
</html>

end

:450
<html>
Изумруд на мгновение вспыхивает ярким, ни на что не похожим светом, после чего туманная мгла вокруг вас рассеивается, обнажая твердую почву. Рискнете <a href=btn:362>пересечь ущелье</a> или <a href=btn:244>поищете обходные пути</a>?
</html>

end

:451
<html>
И вновь перед вами развилка. Изберете поворот <a href=btn:449>направо</a> или спуститесь по лестнице <a href=btn:311>вниз</a>?
</html>

end

:452
<html>
Неожиданно коридор расширяется, и перед вами снова три туннеля. Изберете <a href=btn:435>левый</a>, <a href=btn:437>правый</a> или <a href=btn:436>средний</a>?
</html>

end

:453
<script>
expr_action = 'StrengthFactor = 2; fightStart(8,8,"САУРОН"); afterBattle("532")';
</script>
<html>
<a href="javascript: eval(expr_action)">Вы обнажаете беспощадный к силам Зла меч Исилдура</a>, которым некогда древний герой уже сокрушал Врага. Саурон бледнеет, и отныне ему придает силы лишь отчаяние.
</html>

end

:454
param=6
proc addStrength
<html>
Над Средиземьем уже встает утро. Вокруг все безлюдно.У вас остается только два желания - поесть и выспаться. Избрав своим прибежищем ту самую пещеру, из которой вы вышли и укутавшись в плащ, вы восстановите 6 сил едой и сном. <a href=btn:501>К полудню ваш путь лежит к непонятным развалинам</a>.
</html>

end

:455
<html>
Вскоре перед вами очередная развилка. Пойдете <a href=btn:432>прямо</a>, <a href=btn:422>налево</a>?
</html>

end

:456
<html>
Едва покинув ночную стоянку, вы чувствуете непреодолимое делание надеть Магическое Кольцо. <a href="javascript: CheckWill('457', '458')">Проверьте свою волю</a>.
</html>

end

:457
<html>
Поборов далекий приказ Врага, <a href=btn:400>вы продолжаете путь</a>.
</html>

end

:458
RingUsed=RingUsed+1
<html>
Вы надеваете Кольцо и в тот же миг чувствуете присутствие Черного мага как если бы он находился рядом. Теперь Саурон знает, где и в чьих руках находится Кольцо Всевластья. <a href=btn:400>Неожиданно односторонний контакт с хозяином Кольца пропадает</a>.
</html>

end

:459
<script>
if (foodAmount == 0) modifyStrength(-4);
</script>
<html>
Если у вас осталось немного еды, поужинайте и восстановите 4 силы. <a href=btn:301>В противном случае столько же сил придется потерять</a>.
</html>

end

:460
<html>
Однако ваши ночные стражи постарались, разорвав в клочья неизвестное существо, неосторожно приблизившееся к вашей стоянке. Не испытывая от этого никакого сожаления, <a href=btn:197>вы продолжаете путь</a>.
</html>

end

:461
<html>
Хотите воспользоваться <a href=btn:464>огненным бичом поверженного противника</a>? <a href=btn:41>Предпочтете собственное оружие?</a>
</html>

end

:462
<html>
<a href="javascript: CheckWill('515', '60')">Проверьте свою волю.</a>
</html>

end

:463
<script>
expr_action = "dice1 = Math.floor(Math.random()*6) + 1; dice2 = Math.floor(Math.random()*6) + 1; if (dice1 + dice2 >= Agility) { readParagraph('57'); void(0) } else { readParagraph('484'); void(0) }";
</script>
<html>
<a href="javascript: eval(expr_action)">Киньте кубик дважды</a>.
</html>

end

:464
<html>
Вы хватаете бич, но <a href=btn:41>огонь глубин не в силах причинить магу никакого вреда</a>.
</html>

end

:465
<html>
<a href="javascript: CheckWill('517', '60')">Проверьте свою волю.</a>
</html>

end

:466
<html>
<a href="javascript: CheckLuck('409', '468')">Проверьте свою удачу</a>. Если вам повезет, вы сумели выбраться на противоположный берег.
</html>

end

:467
<script>
expr_action = 'if (Gold > 7) { modifyGold(-8); UrqExec("onHorse=1"); } else alert("У Вас не хватает денег!")';
</script>
<html>
Ристанийцы приветствуют вас как друга Денэтора и предупреждают, что пешему здесь небезопасно, предлагая за 8 золотых пересечь границы Мустангрима на одном из своих жеребцов, чьи стада пасутся неподалеку. Можете <a href="javascript: eval(expr_action)">согласиться</a> или отказаться, после чего <a href=btn:199>перед вами снова дорога</a>.
</html>

end

:468
onHorse=0
param=2
proc removeStrength
<html>
Выпустив поводья, вы со страшной высоты летите вниз, теряя 2 силы, и после продолжительной борьбы с течением волны выбрасывают вас на негостеприимные утесы Белых гор. Только чудом избежав их остроконечных пиков и основательно отдышавшись, вы <a href=btn:379>начинаете подъем по каменным склонам</a>, понимая, что отыскать жеребца (да и жив ли он?) вам уже не удастся.
</html>

end

:469
param=2
proc removeStrength
param=1
proc removeAgility
<html>
Сомнений нет: Дул-Гулдур погружается в руины. Один из обломков пребольно задевает ваше плечо (потеряйте 2 силы и 1 ловкость), но вам удается выбраться даже из такой передряги. Взобравшись на жеребца и потирая ушибленное плечо, вы вновь <a href=btn:74>устремляетесь в дубравы Черного леса</a>.
</html>

end

:470
<html>
Ощупывая пальцами подземные своды, вы осторожно карабкаетесь по каменистым склонам. Кромешную тьму прорезает едва различимый огонек, и вы подступаете к этому единственному источнику света. Оглядевшись, вы обнаруживаете древний алтарь с неясными письменами, различить на котором в полутьме вам удается только одно слово "лукаро". Рядом с неугасимым жертвенником, пламя которого, хотя и тусклое, позволяет разглядеть чудовищных размеров колодец, покоятся сундучки с благовониями и груды истлевших костей. <a href=btn:481>Рискнете воскурить благовония</a>, чтобы вызвать из колодца того, кто там прячется, или <a href=btn:416>вам по душе покинуть неприятное место</a>?
</html>

end

:471
<html>
Разобрать (и даже повторить мысленно) древнюю абракадабру вам так и не удается. Теперь вам ничего не остается, как <a href=btn:416>выбираться на поверхность</a>.
</html>

end

:472
proc lose
<html>
Неожиданно клокочущий колодец наполняется отвратительными чавкающими звуками, и огромных размеров чудище, облизываясь смыкает челюсти на вашем туловище. "Анечноко Арги", - довольно сопит монстр. Последнее, что вы слышите - оглушительный треск собственных костей на длинных, словно колья, зубах чудовища.
</html>

end

:473
<html>
"Ищи Ерог В Анокард У Замла", - ревет монстр, после чего с клокотанием скрывается в породивших его земных глубинах. Если вы <a href=btn:485>поняли, о чем идет речь</a>. Если же <a href=btn:471>нет</a> - <...>
</html>

end

:474
<script>
expr_action = 'if (UrqEval("Лук and 3 Стрела")) { readParagraph("482"); void(0) }';
</script>
<html>
Вы пробуете забросить веревку на вершину одной из скал, но ничего не получается - высота утеса превосходит самые головокружительные размеры. Есть ли у вас есть <a href="javascript: eval(expr_action)">лук и стрелы</a>? Если же <a href=btn:490>нет</a> - <...>
</html>

end

:475
<script>
expr_action = 'if (UrqEval("onHorse=0")) AgilityFactor = -1; takeForce = true; fightStart(12,10,"ТУРИНГВЭТИЛЬ"); afterBattle("504")';
</script>
<html>
<a href="javascript: eval(expr_action)">Противник нападает с воздуха</a>, поэтому, если вы не в седле, придется уменьшить на 1 свою ловкость.
</html>

end

:476
<html>
<a href=btn:244>Гнилые Топи, раскинувшиеся неподалеку, к вашим услугам</a>, но если вам больше по душе Ристанийские степи, можете сделать небольшой крюк и, <a href=btn:40>пересечь их до наступления заката</a>.
</html>

end

:477
inv+ Веревка
<html>
В "хозяйстве" злючки вы находите моток веревки<!-- (+430)--> и, взобравшись на жеребца, <a href=btn:491>отправляетесь дальше</a>, не понимая, что могло вызвать у карлика такое раздражение.
</html>

end

:478
<html>
Ваше внимание привлекают семь больших камней, расставленных в определенном порядке, смысл которого вам не понятен. <a href=btn:495>Свернете к ним</a> или <a href=btn:492>поспешите дальше</a>?
</html>

end

:479
<html>
<a href="javascript: CheckLuck('511', '483')">Проверьте свою удачу.</a>
</html>

end

:480
<html>
С первым же глотком вы чувствуете неладное. Мысли и образы тускнеют, а <a href=btn:135>вас бросает в гибельный сон</a>.
</html>

end

:481
<html>
<a href=btn:473>В смрадном сгустке гниющих паров с оглушительным клокотанием из недр появляется рогатая голова кошмарного ящера, один вид которого наводит беспредельный ужас</a>.
</html>

end

:482
<html>
Умело свив широкую петлю и несколько раз закрутив узлами податливую веревку, вы продеваете в один из них стрелу и, натянув лук, пускаете навстречу солнечному свету. Петля надежно охватывает остроконечный пик одной из скал, и вы <a href=btn:476>выбираетесь на поверхность</a>, понимая, что оставались на волоске от гибели.
</html>

end

:483
<html>
По сводам пещеры проносится жуткий грохот, и Каменные Гиганты обрушиваются, надежно перекрывая выход. Теперь у вас ничего не остается, как <a href=btn:470>продолжить обследование грота</a>.
</html>

end

:484
<html>
Взобравшись на вершину и одев на голову обруч диадемы, <a href=btn:166>вы уже готовы сбросить Магическое Кольцо в породившее его недра горы</a>.
</html>

end

:485
<html>
Вывернув фразу наоборот, вы без труда находите в ней смысл. Непонятным остается, однако, что это за дракон и где его искать. Теперь пора <a href=btn:416>выбираться на поверхность</a>.
</html>

end

:486
<html>
Вы произносите Заклятие Огня, но слабый огонь жертвенника и так не может причинить вам вред, а теперь и вовсе тухнет, <a href=btn:472>оставляя вас в кромешной темноте</a>.
</html>

end

:487
<script>
expr_action = 'if (UrqEval("onHorse=0")) AgilityFactor = -1; fightStart(12,2,"ТУРИНГВЭТИЛЬ"); afterBattle("500")';
</script>
<html>
Противник перекошен от страха и злобы и первым <a href="javascript: eval(expr_action)">нападает с воздуха</a>. Если вы не в седле, вам следует во время боя уменьшить свою ловкость на 1.
</html>

end

:488
onHorse=1
<script>
expr_action = 'AgilityFactor = -1;  fightStart(10,12,"БОРОМИР"); afterBattle("75")';
</script>
<html>
Лицо витязя омрачает скрытый помысел, после чего <a href="javascript: eval(expr_action)">из его ножен с лязгом вылетает обоюдоострый меч</a>. Конечно, вы не могли знать, что завладеть Кольцом Всевластья стало тайной мечтою Боромира, наследника гондорских князей. Поскольку он в седле, а вы - нет, во время боя вам придется уменьшать на 1 свою ловкость. Если вы сразили и этого витязя, то можете забрать его жеребца и продолжать путь к Рунному озеру верхом.
</html>

end

:489
<html>
Едва увидев в вашей руке смертоносную сталь, Турингвэтиль предлагает решить поединок обычным оружием. В этом случае с каждым успешным раундом ваш противник не просто потеряет 2 силы - они перейдут к вам. То же касается и вас, если враг выиграл раунд атаки. <a href=btn:475>Согласитесь</a> или <a href=btn:487>предпочтете одним ударом отправить недруга в чертоги Мандоса</a>?
</html>

end

:490
proc lose
<html>
Собрав остатки сил, вы безнадежно ползете вверх по каменистому обрывистому склону и, сорвавшись, со страшной высоты летите вниз. На этот раз путешествие закончилось и, разбивая голову о тысячелетние утесы, вы навеки исчезаете в мире теней.
</html>

end

:491
<html>
На окраине леса вам попадается неглубокий овраг, на дне которого бьет чистый и прохладный родник. Рискнете <a href=btn:480>попить из него</a>, <a href=btn:494>напоить коня</a> или <a href=btn:236>отправитесь дальше</a>?
</html>

end

:492
<html>
Вы продолжаете путь, когда неожиданно небо заволакивает серая мгла. Вокруг - ни души. <a href=btn:509>Не слышно даже пения птиц</a>.
</html>

end

:493
<script>
expr_action = 'fightStart(7,8,"ПАУК"); spiderAttack = true; afterBattle("74")';
</script>
<html>
Почти на самом выходе из леса <a href="javascript: eval(expr_action)">вас настигает один из пауков</a>, до этого раздумывавший, стоит ли связываться с конным, отлично вооруженным воином. По-видимому, голод взял свое, и членистоногий всерьез надеется употребить в пищу вас. Он неуклюж и неповоротлив, но если за него во время боя выпадет четверка, вы теряете 4 силы независимо от исхода раунда - обитатели Лихолесья весьма ядовиты.
</html>

end

:494
<html>
Фыркая, жеребец с опаской прянет от родника. Наверное, что-то в этом лесу не так, и <a href=btn:236>вы продолжаете путь</a>, потрепав за холку своего любимца.
</html>

end

:495
<html>
<html>
Неожиданно, словно повинуясь какой-то древней магии, зыбкая почва уходит из-под ног. На этот раз ловушка сделала свое черное дело, и вы с криком летите в разверзнувшуюся бездну. <a href=btn:513>Над вами смыкается бурая земля</a>, поглощая собой и вас, и диадему, и Магическое Кольцо.
</html>

end

:496
<html>
На вашем пути попадается непролазный колючий кустарник. Спешившись, вы прорубаете путь и ведете под уздцы своего жеребца. Кустарник расступается, обнажая ягодную поляну, по которой деловито снуют какие-то крохотные, похожие на гномов существа. Внезапно один из них, насупившись, издает рассерженное рычание и, семеня ножками, кидается на вас. <a href=btn:507>Да это не милый лесовичок, а какой-то гномлин!</a>
</html>

end

:497
<html>
Всадник не верит ни одному вашему слову и... замечает прикованное к цепочке <a href=btn:488>Магическое Кольцо, предательски выпавшее из вашего кармана</a>.
</html>

end

:498
inv+ Лук
<html>
Фарамир предлагает вам в подарок охотничий лук и говорит что если найдете к нему черные стрелы, <a href=btn:399>вашим врагам придется несладко</a>.
</html>

end

:499
if onHorse=1 then str1="пеший" & str2="<a href=btn:417>конный</a>" else str1="<a href=btn:478>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:500
inv- Моргульский клинок
<script>
if (newGame) removeItem('Моргульский клинок');
</script>
<html>
Теряя зримый облик, Турингвэтиль превращается в черное облако, которое ветер разметает в клочья. Моргульский клинок, ставший бесполезным, рассыпается в прах, а <a href=btn:104>вы отправляетесь дальше</a>, возвращая небу долгожданную синеву.
</html>

end

:501
if onHorse=1 then str1="пеший" & str2="<a href=btn:281>конный</a>" else str1="<a href=btn:512>пеший</a>" & str2="конный"
<html>
Если вы #str1$, #str2$.
</html>

end

:502
proc lose
<html>
Расправа ужасна. Свирепый дух предпочел разорвать вас на мелкие кусочки. Мгла на сером небе сменяется настоящим мраком, а исчадие тьмы взмывает ввысь, унося в когтях Магическое Кольцо и Судьбу Средиземья.
</html>

end

:503
<html>
Туннель заканчивается тупиком. <a href=btn:424>Вернитесь</a> и сделайте другой выбор.
</html>

end

:504
<script>
IncreaseLuck();
</script>
<html>
Теряя зримый облик, Турингвэтиль превращается в черное облако, которое тут же уносит ветер, а <a href=btn:104>вы продолжаете путь</a>, отправляя в ножны не знающий покоя меч. Киньте кубик и, если повезет, почистите один из квадратов удачи.
</html>

end

:505
<html>
"Что ж, дело благородное", - отвечает витязь с уважением и, пожелав удачи, расстается с вами, а <a href=btn:75>вы держите путь к Рунному озеру</a>.
</html>

end

:506
<html>
Всадник называется Боромиром, сыном наместника Гондора Денэтора, после чего требует от вас объяснений. <a href=btn:508>Назоветесь рыцарем Светлых Сил</a> или <a href=btn:488>расскажите все, как есть</a>, чтобы, если повезет, испросить у него какой-нибудь совет.
</html>

end

:507
<script>
expr_action = 'enemyStrengthFactor = 1; fightStart(8,4,"ГНОМЛИН"); afterBattle("477")';
</script>
<html>
Продолжая рычать, "гном" <a href="javascript: eval(expr_action)">вытаскивает изогнутый кинжал</a>, каждая рана которым (в ногу, иначе ему недостать) будет стоить вам не 2, а 1 силу, но ярости и злости ему хоть отбавляй!
</html>

end

:508
<html>
Вы называетесь светлым рыцарем Арнора. <a href=btn:425>Борьба со злом - ваше призвание</a>, и вас не пугает дикий край.
</html>

end

:509
<script>
expr_action = "if (UrqEval('1 Моргульский клинок')) { readParagraph('489'); void(0) } else alert('У вас нет такой вещи!');"
</script>
<html>
Через некоторое время вам становится ясно, отчего так присмирела природа. В облаке гигантской летучей мыши вас преследует могучий и неистребимый дух из свиты Саурона - Турингвэтиль. Остановить его сможет лишь <a href="javascript: eval(expr_action)">моргульский клинок</a>, если у вас он имеется. В противном случае - <a href=btn:502>ваша участь решена</a>.
</html>

end

:510
<html>
Неожиданно кинжал Майлина отказывается светиться в темноте, а по пещерным сводам проносится зловещий гул. Поскольку на самом деле вы не являетесь потомком Элендила, вам лучше всего <a href=btn:479>убираться восвояси</a>, не дожидаясь тех сюрпризов, которые вам готовит древнее колдовство.
</html>

end

:511
<html>
Вы едва покидаете грот, как за вашей спиной падают Каменные Гиганты, отныне перекрывая вход любому самозванцу. Благополучно увернувшись от обломков, вы можете подумать, <a href=btn:476>куда направиться теперь</a>.
</html>

end

:512
<html>
У обветшалых стен некогда могучей крепости вам попадается величественный витязь на рослом жеребце. С интересом оглядев вас с головы до ног, он спрашивает, что привело вас в дикий край. <a href=btn:488>Расскажите о цели путешествия</a>, <a href=btn:508>представитесь одним из дунаданцев</a> (одиноких рыцарей исчезнувшего Арнора) или <a href=btn:506>потребуете, чтобы тот вначале назвал себя</a>?
</html>

end

:513
param=4
proc removeStrength
param=1
proc removeAgility
<html>
От резкого падения и удара вы лишаетесь чувств и <a href=btn:470>приходите в себя все от той же боли</a>, потеряв 4 силы и 1 ловкость.
</html>

end

:514
<html>
Похоже, выведав вашу тайну, лесной маг не слишком настроен на беседу, но гостеприимства ему не занимать, и вы укладываетесь на ночлег, <a href=btn:212>чувствуя себя в полной безопасности</a>.
</html>

end

:515
RingUsed=RingUsed+1
<html>
На глазах у изумленных хородримцев вас окутывает замогильный мрак, и <a href=btn:373>вы превращаетесь в невидимку под перепуганные крики прислужников Врага</a>.
</html>

end

:516
<html>
<a href=btn:358>Всадник не верит ни одному вашему слову</a>.
</html>

end

:517
RingUsed=RingUsed+1
<html>
На глазах у изумленных вастаков вас окутывает замогильный мрак, и <a href=btn:411>вы превращаетесь в невидимку под перепуганные крики прислужников Врага</a>.
</html>
end

:518
if 1
<script>
if (newGame)
{
    Sword = 0;
    removeItem('Меч');
    if (UrqEval('1 Моргульский клинок')) removeItem('Моргульский клинок');
    if (UrqEval('1 Меч Исилдура')) removeItem('Меч Исилдура');
    if (UrqEval('1 Лук')) removeItem('Лук');
    modifyGold(-Gold);
    while (foodAmount) removeItem('Еда');
}
expr_action = 'if (!UrqEval("1 Огненный бич")) AgilityFactor = -2; fightStart(9,8,"ПЕРВЫЙ СТРАЖНИК",7,10,"ВТОРОЙ СТРАЖНИК"); afterBattle("526")'
</script>
invkill Моргульский клинок
invkill Меч Исилдура
invkill Лук
<html>
Если у вас имеется не совсем обычный пояс, ваша ловкость останется неизменной. В противном случае, как и было сказано, 2 единицы ловкости придется потерять. Однако в любом случае вы можете овладеть мечом одного из противников, если посчастливится его сразить. В этом случае (если у вас нет другого оружия, кроме кинжала Майлина, запрятанного в сапог), ваша ловкость восстановится до изначальной. Теперь <a href="javascript: eval(expr_action)">сражайтесь</a>.
</html>
end

:519
<html>
<a href="javascript: CheckWill('528', '60')">Проверьте свою волю.</a>
</html>

end

:520
<html>
Изображение лилии точно совпадает с формой медальона и приводит в движение скрытый замок. Не оставляя медальон в двери (как знать, может, еще пригодится), вы с силой пытаетесь <a href=btn:156>распахнуть все еще неподатливую дверь</a>.
</html>
end

:521
onHorse=1
<html>
Вы попадаете в конюшню, в которой томится одно из самых удивительных созданий Средиземья - Ликорн. Этот ослепительно-белый единорог предлагает сослужить вам хорошую службу, если вы освободите его из плена. Поскольку вам приходится не выбирать, а выбираться, лучше сделать это вдвоем. По зрелому размышлению, <a href=btn:527>вы так и решаете сделать</a>.
</html>

end

:522
if RingUsed=0 then str1="<a href=btn:528>в первый</a>" & str2="во второй" & str3="в третий"
if RingUsed=1 then str1="в первый" & str2="<a href=btn:519>во второй</a>" & str3="в третий"
if RingUsed=2 then str1="в первый" & str2="во второй" & str3="<a href=btn:60>в третий</a>"
<html>
Но в который раз вы надеваете Магическое Кольцо? Если #str1$ - <...>, если #str2$ (что, впрочем, уже небезопасно) - <...> А если #str3$, <...>
</html>

end

:523
<html>
Вы попадаете в комнату для охраны. Из ножен с лязгом вылетают обоюдоострые мечи, и трое воинов окружают вас с твердым намерением не выпустить живым. Попытаетесь <a href=btn:229>принять бой</a> или <a href=btn:522>воспользуетесь Магическим Кольцом</a>?
</html>

end

:524
param=8
proc addGold
param=10
proc addStrength
<html>
Но как благородное животное сможет помочь вам в вашем трудном деле? Пока вы собираетесь с мыслями, Ликорн ударяет копытом о землю, и 8 золотых, звеня и попрыгивая, падают к вашим ногам. Вы чувствуете, как 10 сил вливаются в вас, наполняя бодростью и уверенностью в победе. Пожелав удачи, единорог склоняет золотую гриву и, пустившись галопом, <a href=btn:377>скрывается среди утесов</a>.
</html>

end

:525
<script>
expr_action = "if (UrqEval('1 Медальон с лилией')) { readParagraph('520'); void(0) } else alert('У вас нет такой вещи!');"
</script>

<html>
Просто так высадить массивную дверь вам не удастся. Есть ли у вас <a href="javascript: eval(expr_action)">медальон с изображением лилии</a>? В противном случае <a href=btn:96>затею придется оставить</a>.
</html>

end

:526
<html>
Блуждания по крепости приводят вас на развилку. Войдете в <a href=btn:523>левую</a> или в <a href=btn:521>правую дверь</a>?
</html>

end

:527
<html>
С первыми лучами солнца, когда едва опускается подъемный мост, вы разбиваете мечом ворота конюшни и, вскочив на спину столь необычного седока, за считанные мгновения оставляете позади себя и мост, и погоню, и негостепреимную цитадель. Ликорн летит быстрее ветра, почти не касаясь копытами земли и лишь в самой сердцевине Белых Гор вдруг <a href=btn:524>переходит на шаг</a>.
</html>

end

:528
<html>
Разумеется, поставив на службу силы Зла, вам ничего не стоит без приключений покинуть цитадель, что вы и делаете. Однако за пределами крепости вам лучше <a href=btn:476>снять Кольцо</a>, так как в такие моменты вы наиболее уязвимы для Черного Мага.
</html>

end

:529
if onHorse=1 then str1="<a href=btn:530>на коне</a>" & str2="В противном случае" else str1="на коне" & str2="<a href=btn:371>В противном случае</a>"
<html>
Если вы #str1$, то... #str2$ - ...
</html>

end

:530
<html>
Верного скакуна придется оставить за пределами грота - лазать по пещерным сводам он все равно не приучен. А вы (если посчастливится выбраться из чертога) <a href=btn:371>продолжите путь верхом</a>.
</html>

end

:531
onHorse=0
<html>
Ваш конь не сможет осилить это гибельное место, и <a href=btn:239>его придется оставить на произвол судьбы</a>.
</html>

end

:532
play #quest_path$/Snd/VICTORY.mp3
<script>
Strength = 0;
PanelClear();
</script>
<html>
<div align="center"><img src="#quest_path$/Img/Back.jpg" class="foto"></div><br>
<HR><br>
Саурон повержен! Теряя зримый облик, его неистребимый дух возносится за пределы Мира, и первые лучи солнца прорезают Тьму. С высоты Ородруина вам видно, как рушится вражеская цитадель Барад-Дур и крепость Темных Сил Минас-Моргул. Вам остается подождать, пока перепуганые орки не разбегутся кто куда, преследуемые жителями Средиземья, и начать обратный, на этот раз, неопасный путь в Элгариол, который с почетом примет победителя.
</html>
end

:lose
play #quest_path$/Snd/DIE.WAV
<script>
Strength = 0;
MusicStop();
PanelClear();
</script>
end

:win
play #quest_path$/Snd/WIN.WAV
end

:die
proc lose
<html>
Вы умерли!
</html>
end

:addStrength
<script>
if (newGame) modifyStrength(param);
</script>
play #quest_path$/Snd/PLUS.WAV
end

:removeStrength
<script>
if (newGame) modifyStrength(-param);
</script>
play #quest_path$/Snd/MINUS.WAV
end

:addAgility
<script>
if (newGame) modifyAgility(param);
</script>
play #quest_path$/Snd/PLUS.WAV
end

:removeAgility
<script>
if (newGame) modifyAgility(-param);
</script>
play #quest_path$/Snd/MINUS.WAV
end

:addGold
<script>
if (newGame) modifyGold(param);
</script>
play #quest_path$/Snd/MONEY.WAV
end

:use_Перстень с изумрудом_Превратить в алмаз
if Фляга then inv+ Алмаз & inv- Перстень с изумрудом
end

:use_Перстень с топазом_Превратить в алмаз
if Фляга then inv+ Алмаз & inv- Перстень с топазом
end

:use_Перстень с рубином_Превратить в алмаз
if Фляга then inv+ Алмаз & inv- Перстень с рубином
end

:use_Сапфир_Превратить в алмаз
if Фляга then inv_Алмаз = inv_Алмаз + inv_Сапфир & invkill Сапфир
end

:startmusicloop
if track<>0 then music #quest_path$/Snd/#track$.mp3 else music #quest_path$/Snd/PROLOG.mp3
end

:endmusicloop
<script>
if (track)
{
	prev_track = track;
	while (track == prev_track) track = Math.floor(Math.random() * 4) + 1;
}
</script>
if track<>0 then music #quest_path$/Snd/#track$.mp3 else music #quest_path$/Snd/PROLOG.mp3
end

:onsave
<script>
SaveGame();
</script>
end

:onload
<script>
LoadGame();
</script>
end

:afterload
<script>
newGame = true;
autoSelect = true;
selectContainer(0);
</script>
end

:code
let Agility=0
let Max_Strength=0
let Strength=0
let StrengthFactor=0
let Charm=0
let binLuck=0
let Gold=0
let foodAmount=0
let RingUsed=-1
let Sword=0
let FireSpell=1
let Sack_MaxAmount=7
let nazgulCount=0
let track=0
proc endmusicloop

<appendStyle element="head">
   img.item {
      position : absolute;
      visibility : 'hidden';
   }
   div.indicator {
      position : absolute;
      color : rgb(96,96,0);
      font-weight : bold;
      left : 103px;
   }
   div.legend {
      position : absolute;
      color : red;
      font-weight : bold;
   }
   a.clickable: link {
      color : red;
   }
</appendStyle>

<appendStyle element="head" src="vendor/jquery/jquery-ui.css"></appendStyle>

<script>
    var Panel = document.createElement('div');
    Panel.id = "Panel";
    Panel.style.backgroundImage = "url('#quest_path$/Img/Panel_temp.bmp')";
    Panel.style.position = "absolute";
    Panel.style.width = '640px';
    Panel.style.height = '140px';

    var element = document.getElementById("framebox");
    element.appendChild(Panel);

    var div = document.createElement('div');
    div.id = "container_legend";
    div.className = "legend";
    Panel.appendChild(div);

    div = document.createElement('div');
    div.id = "Agility_value";
    div.className = "indicator";
    div.style.top = '20px';
    Panel.appendChild(div);

    div = document.createElement('div');
    div.id = "Strength_value";
    div.className = "indicator";
    div.style.top = '35px';
    Panel.appendChild(div);

    div = document.createElement('div');
    div.id = "Charm_value";
    div.className = "indicator";
    div.style.top = '50px';
    Panel.appendChild(div);

    div = document.createElement('div');
    div.id = "Luck_value";
    div.className = "indicator";
    div.style.top = '65px';
    Panel.appendChild(div);

    div = document.createElement('div');
    div.id = "Gold_value";
    div.className = "indicator";
    div.style.top = '80px';
    Panel.appendChild(div);

    div = document.createElement('div');
    div.id = "Water_value";
    div.className = "indicator";
    div.style.top = '95px';
    Panel.appendChild(div);
</script>

<appendContent elementId="framebox">
<div id = "Fight_window" style="position: absolute; width: 340px; height: 255px; visibility: hidden; z-index: 1; background-image : url('#quest_path$/Img/Fight_Window.bmp')"></div>
<div id = "BlockAllEvents" style="position: absolute; width: 640px; height: 480px; top: 0px; left: 0px; visibility: hidden; display: 'none'"></div>
</appendContent>

<appendScript element="head" src="vendor/jquery/jquery-ui.js"></appendScript>
<appendScript element="head" src="vendor/jquery/jquery-ui.min.js"></appendScript>


<appendScript element="body">

var imgUrl = "#quest_path$/Img/";

var isMobile = 'ontouchstart' in document.documentElement;

var newGame;
var Agility, Strength, Max_Strength, Charm;
var sumLuck, binLuck;
var Gold;
var foodAmount;
var numArticle;
var ContainsObjects = new Array(6);
var Sack_MaxAmount;


var headerHeight = 140;
var textHeight;

var Luck = new Array(6);
var Spells_MaxAmount = 10;

var strContainers = new Array("Заплечный мешок", "Оружие", "На человеке",
                              "Одежда", "Заклятия", "Меню");

var imgContainerNames =
[
   "Sack.bmp",
   "Weapon.bmp",
   "At_Me.bmp",
   "Cloths.bmp",
   "Spells.bmp"
];

var itemsRusNames = new Array(5);
itemsRusNames [0] = ["Еда"];
itemsRusNames [1] = ["Меч", "Кинжал Майлина", "Моргульский клинок", "Меч Исилдура"];
itemsRusNames [2] = ["Кольцо Всевластья"];
itemsRusNames [3] = ["Плащ назгула"];
itemsRusNames [4] = ["Огонь"];

var Inventory = new Array(5);
var itemsAmount = new Array(5);

var item_pos = {index0: -1, container: -1};
//var itemInfo = {numContainer, container_startIndex, itemsAmount };
var itemStack = [];

var containers_posX = new Array(135, 172, 216, 251, 255);
var containers_posY = new Array(59, 20, 57, 26, 63);

var highlight_containers_posX = new Array(135, 147, 214, 220, 253);
var highlight_containers_posY = new Array(59, 19, 56, 24, 61);

var container_legend;
var Panel, Fight_window, BlockAllEvents;
var Agility_value, Strength_value, Charm_value, Luck_value, Gold_value;


var selected_container = 0; // Sack
var imgContainer = 0;
var imgItem;
var prev_pointed;
var autoSelect = false;
var drag = false;
var inBasket = false;
var imgBasket, item_moved = "";
var restore_x, restore_y;
var initBattle = true;
var step = 0, phase = 1;
var figureImages = new Array();
var enemy_pictures = new Array(3);
var hero_pictures = new Array(2);
var timerID;
var fight = new Array;
var enemiesCount;
var heroesCount = 1;
var heroResting;
var takeForce;
var spiderAttack;
var heroAlive;
var enemy = new Array(3);
var hero = new Array(2);
var num_killed;
var fightEndParamsStr = ["spendRounds", "numWin", "endCond", "num2"];
var exp_Cond, endCondition, loyaltyEndAction;
var fleeArticle;
var selectedOpponent, selectedHero;
var AgilityFactor = 0;
var enemyPowerFactor = 0;
var enemyStrengthFactor = 0;
var lblStrength = new Array(5);
var imgLabel = new Array(3);
var imgLabel0;
var lbl_ypos = new Array(3);
var expr_action, expr_action1, expr_action2, expr_action3;

function getOffset(evt)
{
    if(evt.offsetX != undefined)
        return {x:evt.offsetX,y:evt.offsetY};

    var el = evt.target;
    var offset = {x:0, y:0};

    while(el.offsetParent)
    {
        offset.x += el.offsetLeft;
        offset.y += el.offsetTop;
        el = el.offsetParent;
    }

    offset.x = evt.pageX - offset.x;
    offset.y = evt.pageY - offset.y;

    return offset;
}


function point_on_containers(e)
{
    if (!Strength)
        return;

   var offset = getOffset(window.event || e);
   var x = offset.x;
   var y = offset.y;
   var point_at = -1;
   if (x >= 135 && x <= 315 && y >= 20 && y <= 104)
      if (y < 59) {
         if (x >= 149 && x <= 222)
            point_at = 1;
         else
            if (x >= 223 && x <= 293 && y >= 26)
               point_at = 3;
      }
      else
         if (y < 95) {
            if (x <= 171)
               point_at = 0;
            else
               if (x <= 215)
                  point_at = 1;
               else
                  if (x <= 250)
                     point_at = 2;
                  else
                     point_at = 4;
         }
         else
            if (x <= 186 && y < 100)
               point_at = 0;
            else
               if (x > 215 && x <= 250)
                  point_at = 2;

   if (point_at != -1)
      highlight_container(point_at);
}

function hideContainer()
{
   imgContainer.onclick = null;
   imgContainer.onmouseout = null;
   if (selected_container != prev_pointed)
       highlight_container(selected_container);
}

function init_Containers()
{
   for (i = 0; i < 5; i++) {
      imgContainer = document.createElement("IMG");
      imgContainer.className = "item";
      imgContainer.style.top = textHeight + highlight_containers_posY [i]  + 'px';
      imgContainer.style.left = highlight_containers_posX [i] + 'px';
      imgContainer.style.visibility = 'hidden';
      imgContainer.src = imgUrl + imgContainerNames [i];
      Panel.appendChild(imgContainer);
   }
   highlight_container(selected_container);
}

function createItem(itemStr, IsObject)
{
   var Item = document.createElement("IMG");
   Item.src = imgUrl + itemStr + ".png";
   Item.className = "item";

   if (createItem.arguments.length == 1)
      IsObject = true;

   if (IsObject) {
      ##36$(Item).tooltip();
      Item.title = itemStr;
      if (itemStr == "Еда")
	     if (!isMobile)
	        Item.ondblclick = eatFood;
	     else
	        Item.onclick = eatFood;

	 itemStack.push(Item.title);

	 Item.onload = function() {
	    itemStr = itemStack.shift();
	    if (itemStack.length == 0)
        {
            fill_Containers();
            item_pos = findItemByString(itemStr);
            autoSelect = true;
            selectContainer(item_pos.container);
        }
     };
   }
   else
      Item.style.visibility = 'visible';

   return Item;
}


function init_Inventory()
{
   for (var i = 0; i < 5; i++) {
       for (var j in itemsRusNames [i])
            Inventory [i][itemsRusNames [i][j]] = 0;
       itemsAmount [i] = 0;
   }

   if (newGame)
       return;

   var container_startIndex = 12;
   var count = Panel.childNodes.length - container_startIndex;

   for (i = 0; i < count; i++)
       Panel.removeChild(Panel.childNodes [container_startIndex]);


   for (i = 0; i < 5; i++) {
        switch (i)
        {
           case 0:
               count = foodAmount;
               break;
           case 1:
               count = Sword;
               break;
           case 2:
               count = RingUsed != -1;
               break;
           case 3:
               count = 0;
               break;
           case 4:
               count = FireSpell;
               break;
        }

        for (var j in itemsRusNames [i])
        {
            itemStr = itemsRusNames [i][j];

            if (i == 1)
            {
                if (j > 1)
                    count = UrqEval(itemStr);
                else if (j == 1)
                    count = 1;
            }
            else if (i == 3)
                count = UrqEval(itemStr);

            if (itemStr == undefined)
                count = 0;

            Inventory [i][itemStr] = count;
            itemsAmount [i] += count;

            while (count--) {
                 imgItem = createItem(itemStr);
                 Panel.appendChild(imgItem);
            }
        }
   }

	/*highlight_container(0);*/
	//selectContainer();
}


function fill_Containers()
{
   var numImage = 12;
   for (var i = 0; i < 5; i++) {
      var amount = itemsAmount [i];
      if (amount > 0)
          refresh_Container(i, numImage, amount, parseInt(Panel.style.height) - 10);
      numImage += amount;
   }
}

function refresh_Container(container, index1, amount, max_height)
{
   var half_amount = Math.floor(amount / 2);
   var posX;

   if (amount == half_amount * 2)
      posX = 455 + 10;
   else
      posX = 455 - Panel.childNodes [index1 + half_amount].width / 2 + 10;
   var i;
   for (i = 0; i < half_amount; i++) {
      posX -= Panel.childNodes [index1 + i].width;
      if (container == 4)
         posX -= 10;
      else
         posX -= 3;
   }
   if (posX < 365) {
      var maxHeight1 = Panel.childNodes [index1].height;
      for (i = 1; i < half_amount; i++) {
         var tmpHeight = Panel.childNodes [index1 + i].height;
         if (tmpHeight > maxHeight1)
            maxHeight1 = tmpHeight;
      }
      var maxHeight2 = Panel.childNodes [index1 + i].height;
      i++;
      for (; i < amount; i++) {
         tmpHeight = Panel.childNodes [index1 + i].height;
         if (tmpHeight > maxHeight2)
            maxHeight2 = tmpHeight;
      }
      max_height -= maxHeight2 - 10;
	  if (half_amount == 0)
          return;
      refresh_Container(container, index1, half_amount, max_height);
      refresh_Container(container, index1 + half_amount, amount - half_amount,
                        max_height + 2 * maxHeight1);
   }

   for (i = 0; i < amount; i++) {
      imgItem = Panel.childNodes [index1 + i];
      imgItem.style.left = posX + 'px';
      imgItem.style.top = textHeight + (max_height - imgItem.height) / 2 + 'px';
      imgItem.style.visibility = 'hidden';
      posX += imgItem.width;
      if (container == 4)
         posX += 10;
      else
         posX += 3;
   }
}

function findItemByString(itemStr)
{
   var Str;
   var item_pos = {index0: 12, container: -1};

   for (var i = 0; i < 5; i++)
	  if (itemsRusNames [i] != null)
		  for (var j in itemsRusNames [i]) {
			 Str = itemsRusNames [i][j];
			 if (itemStr == Str) {
				item_pos.container = i;
				return item_pos;
			 }
			 item_pos.index0 += Inventory [i][Str];
		  }
   item_pos.index0 = -1;
   return item_pos;
}

function itemExists(itemStr)
{
   item_pos = findItemByString(itemStr);
   if (Inventory [item_pos.container][itemStr] == 0) {
      switch (item_pos.container) {
         case 0:
            if (itemStr != 'Еда')
               alert("У Вас нет такой вещи!");
            else
               alert("У Вас нет еды!");
            return 0;
         case 2:
            alert("У Вас нет такого предмета!");
            return 0;
         case 3:
            alert("У Вас нет такой одежды!");
            return 0;
         case 4:
            alert("У Вас нет такого заклятия!");
      }
	  return 0;
   }

   return Inventory [item_pos.container][itemStr];
}


function addItem(itemStr)
{
    item_pos = findItemByString(itemStr);
    if (item_pos.container == 0)
     if (itemsAmount [0] == Sack_MaxAmount) {
        alert("Ваш заплечный мешок полон!");
        return;
     }

    imgItem = createItem(itemStr);

    var container_startIndex = 12;
    for (var i = 0; i < item_pos.container; i++)
        container_startIndex += itemsAmount [i];

    if (itemsAmount [i] == item_pos.index0 - container_startIndex) {
     var sum_items_Above = 0;
     for (++i; i < 5; i++)
        sum_items_Above += itemsAmount [i];

     if (!sum_items_Above)
        Panel.appendChild(imgItem);
     else
        Panel.insertBefore(imgItem, Panel.childNodes [item_pos.index0]);
    }
    else
        Panel.insertBefore(imgItem, Panel.childNodes [item_pos.index0]);

    Inventory [item_pos.container][itemStr]++;
    itemsAmount [item_pos.container]++;
    if (itemStr == 'Еда')
         foodAmount++;

    /*itemStack.push( { numContainer: item_pos.container, container_startIndex: this.container_startIndex, itemsAmount: itemsAmount[item_pos.container] } );

    imgItem.onload = function() {
        var curItemInfo = itemStack.pop();

        refresh_Container(curItemInfo.numContainer, curItemInfo.container_startIndex, curItemInfo.itemsAmount,
                          parseInt(Panel.style.height) - 10);

        if (itemStack.length == 0)
        {
            fill_Containers();
            if (prev_pointed != curItemInfo.numContainer)
                highlight_container(curItemInfo.numContainer);
            selectContainer();
        }
    }*/
}

function removeItem(itemStr)
{
   var container_startIndex = 12;

   item_pos = findItemByString(itemStr);
   item_moved = Panel.childNodes [item_pos.index0];
   for (var i = 0; i < item_pos.container; i++)
		container_startIndex += itemsAmount [i];


   Inventory [i][itemStr]--;
   itemsAmount [i]--;
   if (itemStr == 'Еда')
      foodAmount--;

   Panel.removeChild(item_moved);

   refresh_Container(i, container_startIndex, itemsAmount [i], parseInt(Panel.style.height) - 10);
   autoSelect = true;
   selectContainer(i);
}

function useItem(itemStr, newLoc, modLoc)
{
   if (itemStr != 'Еда') {
	   if (itemExists(itemStr))
		  readParagraph("" + newLoc);
   }
   else
	   if (Strength < Max_Strength) {
		  modifyStrength(4);
		  removeItem('Еда');
	   }
	   else
		  alert("Ваша сила равна максимальной - перекусите позднее!");
}

function eatFood()
{
   useItem('Еда');
}

function show_legend(num)
{
   container_legend.style.top = textHeight + 110 + 'px';
   container_legend.style.left = containers_posX [num] + 'px';
   container_legend.innerHTML = strContainers [num];
}

function highlight_container(num)
{
   if (num != prev_pointed) {
      imgContainer.style.visibility = "hidden";
      imgContainer.onclick = null;
      imgContainer.onmouseout = null;
   }

   imgContainer = Panel.childNodes [num + 7];
   imgContainer.style.visibility = "visible";
   imgContainer.onclick = onSelectContainer;
   imgContainer.onmouseout = hideContainer;
   show_legend(num);
   prev_pointed = num;
}

function onSelectContainer()
{
    autoSelect = false;
    selectContainer(prev_pointed);
}

function selectContainer(sel_index)
{
   if (autoSelect)
       highlight_container(sel_index);

   var itemIndex;

   var prev_container = selected_container;
   if (sel_index != prev_container) {

      itemIndex = 12;
      for (var i = 0; i < prev_container; i++)
         itemIndex += itemsAmount [i];
      for (i = 0; i < itemsAmount [prev_container]; i++)
         Panel.childNodes [itemIndex++].style.visibility = "hidden";
   }

   itemIndex = 12;
   for (i = 0; i < sel_index; i++)
      itemIndex += itemsAmount [i];

   for (i = 0; i < itemsAmount [sel_index]; i++)
      Panel.childNodes [itemIndex++].style.visibility = "visible";

   selected_container = sel_index;
}


function SaveGame()
{
   binLuck = 0;
   for (var i = 0; i < 6; i++) {
      binLuck *= 2;
      if (Luck [5 - i])
         binLuck++;
   }

   return 1;
}


function LoadGame()
{
  sumLuck = 0;
  for (var i = 0; i < 6; i++) {
      if (binLuck % 2) {
         sumLuck++;
         Luck [i] = true;
      }
      else
          Luck [i] = false;

      binLuck = Math.floor(binLuck / 2);
  }
  newGame = false;
  if (container_legend.innerHTML == "")
      PanelShow();
  if (Fight_window.style.visibility == 'visible' || Fight_window.style.display != 'none')
      fightEnd();

  DisplayStuff();
  heroesCount = 1;
  heroResting = false;
  SoundStop();
  MusicPlay();
}

function DisplayStuff()
{
   Agility_value.innerHTML = Agility.toString();
   Strength_value.innerHTML = Strength.toString();
   Charm_value.innerHTML = Charm.toString();
   Luck_value.innerHTML = sumLuck.toString();
   Gold_value.innerHTML = Gold.toString();
   init_Inventory();
}


function modifyStrength(modStrength)
{
   if (Strength != Max_Strength || modStrength < 0)
      Strength += modStrength;
   else
      return;

   if (Strength > Max_Strength)
      Strength = Max_Strength;
   else if (Strength < 0)
      Strength = 0;
   Strength_value.innerHTML = Strength.toString();
   if (Strength == 0) {
      alert("Вы потеряли много сил и умерли!");
	  readParagraph("die");
   }
}

function modifyAgility(modAgility)
{
   Agility += modAgility;
   Agility_value.innerHTML = Agility.toString();
}

function modifyGold(modGold)
{
   Gold += modGold;
   Gold_value.innerHTML = Gold.toString();
}

function setInitial_Parameters()
{
   var table = [[8,22,11], [10,20,10], [12,16,7], [8,22,11], [9,20,10],
                [11,18,8], [10,20,9],  [12,16,7], [8,22,11], [9,20,10], [11,18,8]];

   var dice = Math.floor(Math.random() * 6) + Math.floor(Math.random() * 6);

   Agility = table[dice][0];
   Max_Strength = table[dice][1];
   Strength = Max_Strength;
   Charm = table[dice][2];

   sumLuck = 0;
   var dice1 = Math.floor(Math.random() * 6);
   var dice2 = Math.floor(Math.random() * 6);
   for (var i = 0; i < 6; i++)
      if (i != dice1 && i != dice2) {
         Luck [i] = true;
         sumLuck++;
      }
      else
         Luck [i] = false;

   Gold = 0;
   foodAmount = 0;
   Sword = 0;
   RingUsed = -1;
   FireSpell = 0;
   Sack_MaxAmount = 7;
   heroesCount = 1;
   heroResting = false;
   newGame = true;
}

function IncreaseLuck()
{
   if (newGame) {
       var dice = Math.floor(Math.random() * 6);
	   Luck [dice] = true;
	   sumLuck++;
	   Luck_value.innerHTML = sumLuck.toString();
   }
}

function CheckLuck(Loc1, Loc2)
{
   var loc;
   var dice = Math.floor(Math.random() * 6);
   if (Luck [dice]) {
      Luck [dice] = false;
      sumLuck--;
      Luck_value.innerHTML = sumLuck.toString();
	  if (CheckLuck.arguments.length != 0)
	     loc = eval(Loc1);
   }
   else
      if (CheckLuck.arguments.length == 2)
         loc = eval(Loc2);

   if (loc != null && loc != undefined)
      readParagraph("" + loc);
}

function CheckCharm(Loc1, Loc2)
{
   if (Charm > 12) {
      readParagraph(Loc1);
      return;
   }
   else if (Charm == 5) {
      readParagraph(Loc2);
      return;
   }
   var dice = Math.floor(Math.random() * 6) + Math.floor(Math.random() * 6) + 2;
   if (dice <= Charm) {
      Charm++;
      readParagraph(Loc1);
   }
   else  {
      Charm--;
      readParagraph(Loc2);
   }
   Charm_value.innerHTML = Charm.toString();
}

function CheckWill(Loc1, Loc2)
{
    var dice = Math.floor(Math.random() * 6) + 1;
   if (dice % 2)
      readParagraph(Loc1);
   else
      readParagraph(Loc2);
}

function CheckEscapeChase(Loc1, Loc2)
{
   var hero_points = 0;
   var enemy_points = 0;
   for (var i = 0; i < 3; i++) {
      var dice1 = Math.floor(Math.random() * 6);
      var dice2 = Math.floor(Math.random() * 6);
	  if (dice1 > dice2)
	     hero_points++;
	  else
	     enemy_points++;
   }
   if (hero_points > enemy_points)
      readParagraph(Loc1);
   else
      readParagraph(Loc2);
}

function fightStart(Agility1, Strength1, enemyDesc1)
{
   BlockAllEvents.style.display = '';
   BlockAllEvents.style.visibility = 'visible';
   BlockAllEvents.style.zIndex = 1;
   Fight_window.style.display = '';
   Fight_window.style.visibility = 'visible';
   Fight_window.style.zIndex = 2;

   enemiesCount = Math.floor(fightStart.arguments.length / 3);
   endCondition = null;

   for (var i = 0; i < enemiesCount; i++) {
      enemy [i].Agility = fightStart.arguments [i * 3];
      enemy [i].Strength = fightStart.arguments [i * 3 + 1];
	  enemy [i].StrengthFactor = enemyStrengthFactor;
      enemy [i].Alive = true;
      var desc = "<html>" + fightStart.arguments [i * 3 + 2] + "<br>Ловкость " + enemy [i].Agility + "</html>";
      enemy_pictures [i] = Fight_window.childNodes [i + 2];
      enemy_pictures [i].style.visibility = 'visible';
      enemy_pictures [i].title = desc;

      lblStrength [i + 2].innerHTML = enemy [i].Strength.toString();
      lblStrength [i + 2].style.visibility = 'visible';
   }

   lblStrength [0].style.left = 246 + 'px';
   if (!heroResting) {
      hero [0].Agility = Agility + AgilityFactor;
      hero [0].Strength = Strength;
	  hero [0].StrengthFactor = StrengthFactor;
	  hero [0].Alive = true;
   }


   if (!heroResting) {
      hero_pictures [0] = Fight_window.childNodes [0];
      hero_pictures [0].style.visibility = 'visible';
   }

   num_killed = 0;
   setFigurePositions(0);

   for (i = 0; i < heroesCount; i++) {
	  lblStrength [i].style.top = parseInt(hero_pictures [i].style.top) +
									 hero_pictures [i].height + 3 + 'px';
      lblStrength [i].style.left = 246 + 'px';
	  lblStrength [i].innerHTML = hero [i].Strength.toString();
      lblStrength [i].style.visibility = 'visible';
   }

   if (enemiesCount == 2)
      lbl_ypos [0] = 128 - 21  / 2 - 51;
   else
      if (enemiesCount == 3)
         lbl_ypos [0] = 128 - 51 / 2 - (21 + 51);

   for (i = 0; i < enemiesCount; i++) {
	  if (i) {
		  if (heroesCount == 1) {
			 lbl_ypos [i] = lbl_ypos [i - 1] + 51 + 21;
			 imgLabel0 = Fight_window.childNodes [i + 11];
			 imgLabel0.style.top = lbl_ypos [i] + 'px';
		  }
	  }
	  else
		 if (enemiesCount == 1 || heroesCount == 2)
			imgLabel0 = Fight_window.childNodes [10];
		 else {
			imgLabel0 = Fight_window.childNodes [11];
			imgLabel0.style.top = lbl_ypos [0] + 'px';
		 }

	  imgLabel0.style.visibility = 'visible';

	  lblStrength [i + 2].style.top = parseInt(enemy_pictures [i].style.top) +
										 enemy_pictures [i].height + 3 + 'px';
	  lblStrength [i + 2].style.left = 303 + 'px';
   }

   initBattle = true;
   selectedOpponent = -1;
}

function callAllies(Agility1, Strength1, allyDesc1)
{
   heroesCount = Math.floor(callAllies.arguments.length / 3);

    var j;
    if (heroesCount == 1)
      j = 1;
    else
      j = 0;

   for (var i = 0; i < heroesCount; i++) {
      hero [j].Agility = callAllies.arguments [i * 3];
      hero [j].Strength = callAllies.arguments [i * 3 + 1];
	  hero [j].StrengthFactor = 2;
      hero [j].Alive = true;
	  hero [j].Hurt = false;
      var desc = "<html>" + callAllies.arguments [i * 3 + 2] + "<br>Ловкость " + hero [j].Agility + "</html>";
      hero_pictures [j] = Fight_window.childNodes [j];
      hero_pictures [j].style.visibility = 'visible';
      hero_pictures [j].title = desc;

      lblStrength [j].innerHTML = hero [j].Strength.toString();
      lblStrength [j].style.visibility = 'visible';
	  j++;
   }

   if (heroesCount == 1)
       heroesCount++;
   else
	   heroResting = true;
}

function fightEnd()
{
   for (var i = 0; i < enemiesCount; i++)
	 if (enemy [i].Alive || exp_Cond) {
		Fight_window.childNodes [i + 2].style.visibility = 'hidden';
		lblStrength [i + 2].style.visibility = 'hidden';
		if (enemiesCount > 1)
		   Fight_window.childNodes [i + 11].style.visibility = 'hidden';
	 }
	  if (enemiesCount == 1)
		 Fight_window.childNodes [10].style.visibility = 'hidden';


   for (i = 1; i < heroesCount; i++) {
	  Fight_window.childNodes [i].style.visibility = 'hidden';
	  lblStrength [i].style.visibility = 'hidden';
   }

   Fight_window.style.display = 'none';
}

function removeEnemy(_id)
{
   enemy [_id].Alive = false;

   enemy_pictures [_id].style.visibility = 'hidden';
   lblStrength [_id + 2].style.visibility = 'hidden';
   if (enemiesCount != 1 && (heroesCount == 1 || !hero [0].Alive || !hero [1].Alive))
      imgLabel0 = Fight_window.childNodes [_id + 11];
   else
      imgLabel0 = Fight_window.childNodes [10];

   if (imgLabel0 != Fight_window.childNodes [10] || heroesCount == 1)
   {
      imgLabel0.style.visibility = 'hidden';
	  if (heroesCount == 1)
         Fight_window.childNodes [10].style.visibility = 'hidden'; // глюк после победы над 2-м противником, если их трое
   }
}

function removeAlly(_id)
{
   hero [_id].Alive = false;
   if (_id == 0 && !heroResting)
   {
      heroAlive = false;
	  return;
   }

   hero_pictures [_id].style.visibility = 'hidden';
   lblStrength [_id].style.visibility = 'hidden';
   if (enemiesCount != 1)
   {
      imgLabel0 = Fight_window.childNodes [10];
	  imgLabel0.style.visibility = 'hidden';

	  lbl_ypos [0] = 128 - 21  / 2 - 51;

	  for (var i = 0; i < enemiesCount; i++) {
		 if (i) {
			 lbl_ypos [i] = lbl_ypos [i - 1] + 51 + 21;
			 imgLabel0 = Fight_window.childNodes [i + 11];
			 imgLabel0.style.top = lbl_ypos [i] + 'px';
		 }
		 else {
			imgLabel0 = Fight_window.childNodes [i + 11];
			imgLabel0.style.top = lbl_ypos [0] + 'px';
		 }

		 if (enemy [i].Alive)
			imgLabel0.style.visibility = 'visible';
	  }
	}
}

function setFigurePositions(step)
{
	if (step == 3) {
		 if (hero [0].Hurt)
		 {
			 hero_pictures [0].style.left = 228 + 'px';
			 if (heroesCount == 1)
				 hero_pictures [0].style.top = 107 + 'px';
			 else
				 hero_pictures [0].style.top = 78 + 'px';
			 hero_pictures [0].src = figureImages [8].src;
		 }
		 else
		 {
			 hero_pictures [0].style.left = 236 + 'px';
			 if (heroesCount == 1)
				hero_pictures [0].style.top = 102 + 'px';
			 else
				 hero_pictures [0].style.top = 73 + 'px';
			 hero_pictures [0].src = figureImages [6].src;
		 }
		 if (heroesCount == 2)
			 if (hero [1].Hurt) {
				 hero_pictures [1].style.left = 228 + 'px';
				 hero_pictures [1].style.top = 150 + 'px';
				 hero_pictures [1].src = figureImages [8].src;
			 }
			 else {
				 hero_pictures [1].style.left = 236 + 'px';
				 hero_pictures [1].style.top = 145 + 'px';
				 hero_pictures [1].src = figureImages [6].src;
			 }
	}
	else {
		 hero_pictures [0].style.left = 236 + 'px';
		 hero_pictures [0].src = figureImages [step * 2].src;
		 if (heroesCount == 1)
			hero_pictures [0].style.top = 102 + 'px';
		 else {
			 hero_pictures [0].style.top = 73 + 'px';
			 hero_pictures [1].style.left = 236 + 'px';
			 hero_pictures [1].style.top = 145 + 'px';
			 hero_pictures [1].src = figureImages [step * 2].src;
		 }
	}

    var enemy_X, enemy_Y;
    if (enemiesCount == 1)
       enemy_Y = 98;
    else
        if (enemiesCount == 2)
            enemy_Y = 128 - 28 / 2 - figureImages [0].height;
        else
            enemy_Y = 128 - figureImages [0].height / 2 - 28 - figureImages [0].height;

   for (var i = 0; i < enemiesCount; i++) {

      if (enemy [i].Alive) {
          if (step == 3)
            if (enemy [i].Hurt) {
               enemy_X = 290;
               enemy_Y += 7;
               enemy_pictures [i].src = figureImages [9].src;
            }
            else {
               enemy_X = 287;
               enemy_pictures [i].src = figureImages [7].src;
            }
         else {
            if (step == 2) {
               enemy_X = 274;
               enemy_Y += 14;
            }
            else
               enemy_X = 287;

            enemy_pictures [i].src = figureImages [step * 2 + 1].src;
         }
         enemy_pictures [i].style.left = enemy_X + 'px';
         enemy_pictures [i].style.top = enemy_Y + 'px';
      }
      enemy_Y += figureImages [0].height + 14;
      if (step != 2 || !enemy [i].Alive)
         enemy_Y += 14;
   }
}

function battleSequence()
{
   if (phase == 1) {
      step++;
      if (step == 4) {
         step = 2;
         phase = 2;
      }
   }
   else
      if (!step) {

         fight.spendRounds++;

		heroAlive = true;
		var allAlliesPerished = true;
		for (i = 0; i < heroesCount; i++)
		    if (hero [i].Alive)
				if (hero [i].Strength < 1)
				{
				    hero [i].Strength = 0;
					removeAlly(i);
					if (!heroAlive)
				        break;
				}
				else {
				    lblStrength [i].innerHTML = hero [i].Strength.toString();
					if (i == 0 && !heroResting) {
						Strength = hero [0].Strength;
						Strength_value.innerHTML = Strength.toString();
					}
					if (allAlliesPerished)
					    allAlliesPerished = false;
				}

         for (var i = 0; i < enemiesCount; i++)
		 {
            if (enemy [i].Alive)
               if (enemy [i].Strength > 0)
                  lblStrength [i + 2].innerHTML = enemy [i].Strength;
			   else {
                  num_killed++;
                  removeEnemy(i);
               }
		 }

         clearInterval(timerID);
         phase = 1;

         exp_Cond = eval(fight.endCond);
		 if (!exp_Cond)
		    exp_Cond = eval(endCondition);

         if (num_killed == enemiesCount || exp_Cond || !heroAlive || allAlliesPerished)
		 {
			if (num_killed == enemiesCount || exp_Cond) {
			   fightEnd();
			   if (num_killed == enemiesCount)
			       readParagraph("win");
			   else
                   SoundStop();
               afterBattle();
               return;
            }
            else
               if (!heroAlive)
			    {
				  readParagraph("die");
                  fightEnd();
                  return;
               }
               else {
				  heroesCount = 1;
                  hero [0].Agility = Agility + AgilityFactor;
                  hero [0].Strength = Strength;
				  hero [0].Alive = true;
                  hero [0].Hurt = false;
				  hero_pictures [0].style.visibility = 'visible';
                  Fight_window.childNodes [1].style.visibility = 'hidden';
                  lblStrength [1].style.visibility = 'hidden';
				  lblStrength [0].innerHTML = Strength.toString();
                  lblStrength [0].style.top = 151 + 'px';
				  lblStrength [0].style.visibility = 'visible';
				  hero_pictures [0].title = null;
                  heroResting = false;
               }
		 }
      }
      else step--;

   setFigurePositions(step);
}

function onLabel()
{
   selectedOpponent = parseInt(this.id);
   imgLabel0 = Fight_window.childNodes [selectedOpponent + 10];
   imgLabel0.src = imgLabel [selectedOpponent].src;
   imgLabel0.onclick = battleRound;
   if (selectedOpponent != 0)
      selectedOpponent--;
}

function out_of_Label()
{
   var S = new String;

   S = imgLabel0.src;
   imgLabel0.src = S.substring(0, S.length - 13) + ".png";
   imgLabel0.onclick = null;
}

function battleRound()
{
   var multiAttack_hero = false;
   var hero_index;
   var rand = new RandomNumberGenerator();
   for (var i = 0; i < heroesCount; i++) {
	   hero [i].Hurt = false;
	   if (hero [i].Alive) {
	      hero_index = i;
		  dice = Math.floor(rand.next() * 6) + 1;
	      //dice = Math.floor(Math.random() * 6) + 1;
	      hero [i].Power = dice * 2 + hero [i].Agility;
	   }
	   else
	   {
          multiAttack_hero = true;
		  continue;
	   }
   }
   var multiAttack_enemy = false;
   var enemy_index;
   for (i = 0; i < enemiesCount; i++) {
        enemy [i].Hurt = false;
        if (enemy [i].Alive) {
		    enemy_index = i;
			dice = Math.floor(rand.next() * 6) + 1;
	        //dice = Math.floor(Math.random() * 6) + 1;
			enemy [i].Power = dice * 2 + enemy [i].Agility;
			if (spiderAttack)
				if (dice == 4)
				{
					hero [0].Strength -= 2;
					hero [0].Power = 0;
				}
		}
		else
		{
		   multiAttack_enemy = true;
		   continue;
		}
	}
	/*if (multiAttack_enemy)
	   if (enemiesCount == 3 && enemy [2].Alive)
   	      enemy_index = 2;
	   else if (enemiesCount != 1 && enemy [1].Alive)
		     enemy_index = 1;
	   else enemy_index = 0;*/


   /*if (heroesCount == 1 && enemiesCount > 1 && num_killed == 0)
       multiAttack_hero = true;*/

    if (heroesCount == 1)
	{
       if (multiAttack_enemy)
	      multiAttack_enemy = false;

	   if (enemiesCount - num_killed > 1)
	      multiAttack_hero = true;
	}

   if (multiAttack_hero)
      for (i = 0; i < enemiesCount; i++)
	     if (enemy [i].Alive)
			 if (enemy [i].Power > hero [hero_index].Power) {
				 if (enemy [i].StrengthFactor)
					hero [hero_index].Strength -= enemy [i].StrengthFactor;
				 else
					hero [hero_index].Strength -= 2;
				 if (!hero [hero_index].Hurt)
					 hero [hero_index].Hurt = true;
			 }
			  else
				 if (i == selectedOpponent)
					if (hero [hero_index].Power > enemy [i].Power) {
					   if (hero [hero_index].StrengthFactor)
						  enemy [i].Strength -= hero [hero_index].StrengthFactor;
					   else
						  enemy [i].Strength -= 2;
					   enemy [i].Hurt = true;
					}


	if (multiAttack_enemy) {
		if (heroesCount == 2 && !heroResting)
			selectedHero = 1;
		else
			selectedHero = 0;

		  for (i = 0; i < heroesCount; i++)
			 if (hero [i].Alive)
				 if (hero [i].Power > enemy [enemy_index].Power) {
					 if (hero [i].StrengthFactor)
						enemy [enemy_index].Strength -= hero [i].StrengthFactor;
					 else
						enemy [enemy_index].Strength -= 2;

					 if (!enemy [enemy_index].Hurt)
						enemy [enemy_index].Hurt = true;
					 hero [i].Hurt = false;
					 //alert("hit: " + enemy_index + "," + enemy [enemy_index].Strength)
				 }
				 else
					 if (i == selectedHero)
						if (enemy [enemy_index].Power > hero [i].Power) {
						   if (enemy [enemy_index].StrengthFactor)
							  hero [i].Strength -= enemy [enemy_index].StrengthFactor;
						   else
							  hero [i].Strength -= 2;
						   hero [i].Hurt = true;
						   //alert("hurt: " + enemy_index + "," + hero [i].Strength)
						}

	}

	if (!multiAttack_hero && !multiAttack_enemy)
		for (i = 0; i < enemiesCount; i++)
		{
            if (heroesCount == 2)
 			    hero_index = i;
			else
			{
			    if (!enemy [i].Alive)
				    continue;
				hero_index = 0;
			}
			if (enemy [i].Power > hero [hero_index].Power) {
				 if (enemy [i].StrengthFactor)
					hero [hero_index].Strength -= enemy [i].StrengthFactor;
				 else
					hero [hero_index].Strength -= 2;

				if (takeForce)
				{
				    enemy [i].Strength += 2;
					if (enemy [i].Strength > 10)
					   enemy [i].Strength = 10;
				}


			 if (!hero [hero_index].Hurt)
				hero [hero_index].Hurt = true;
		  }
		  else
			 if (hero [hero_index].Power > enemy [i].Power) {
			 	if (hero [hero_index].StrengthFactor)
				   enemy [i].Strength -= hero [hero_index].StrengthFactor;
				else
				   enemy [i].Strength -= 2;

				if (takeForce)
				{
				    hero [hero_index].Strength += 2;
					if (hero [hero_index].Strength > Max_Strength)
					   hero [hero_index].Strength = Max_Strength;
				}
				enemy [i].Hurt = true;
			}
		}

   timerID = setInterval("battleSequence()", 200);
}

function battleEndCondition(cond)
{
   endCondition = cond;
}


function afterBattle(loc1, endCond, loc2)
/* Функция, определяющая дальнейшие действия по завершении сражения.
 * Первый параметр задает номер параграфа, на который надо перейти
 * в случае победы героя (стандартное действие). Второй возможный
 * параметр expRounds задается в виде ">n", ">=n", <n", "<=n", где
 * n - количество раундов атаки. Если число проведенных раундов атаки
 * определяется соотношением, заданным в expRounds, происходит
 * переход на параграф loc2, который задается третьим параметром. */
{
   var loc;

   if (initBattle) {
      var len = afterBattle.arguments.length;
      if (len == 2)
         len--;
	  else if (len > 3)
		 len == 3;
	  fight.spendRounds = 1;


      for (var i = 0; i < 4; i++)
         if (i < len)
            fight [fightEndParamsStr [i + 1]] = afterBattle.arguments [i];
         else
            fight [fightEndParamsStr [i + 1]] = "";

	  if (len == 3 && (endCond.charAt(0) == ">" || endCond.charAt(0) == "<"))
	     fight.endCond = "fight.spendRounds" + fight.endCond;

      initBattle = false;

	  //UrqExec("play #quest_path$/Snd/FIGHT.mp3");
       SoundPlay("#quest_path$/Snd/FIGHT.mp3");
	  return;
   }

   BlockAllEvents.style.display = 'none';
   BlockAllEvents.style.zIndex = -1;

   exp_Cond = eval(fight.endCond);

   if (!exp_Cond || exp_Cond == "")
      readParagraph(fight.numWin);
   else
      readParagraph(fight.num2);

   AgilityFactor = 0;
   enemyPowerFactor = 0;
   enemyStrengthFactor = 0;
   heroesCount = 1;
   heroResting = false;
   takeForce = false;
   spiderAttack = false;
}

function Flee(numArticle)
{
   if (initBattle) {
      //flee = true;
      fleeArticle = numArticle;
   }
   else {
      fight.numWin = fleeArticle;
      fight.spendRounds = 0;
      fightEnd();
      afterBattle();
   }
}

function createCopy()
{
   removeItem('Копия');
   copy = true;
}

function createLabel(Label, _id)
{
   if (_id > 0)
      Label += _id;

   imgLabel0 = createItem(Label, false);
   imgLabel0.id = _id.toString();
   if (_id == 0)
      imgLabel0.style.top = '107px';
   imgLabel0.style.left = '23px';
   imgLabel0.style.visibility = 'hidden';

   //if (!isMobile)
   {
        imgLabel0.onmouseover = onLabel;
        imgLabel0.onmouseout = out_of_Label;
   }
   /*
   {
        imgLabel0.ontouchstart = onLabel;
        imgLabel0.ontouchend = out_of_Label;
   }*/

   Fight_window.appendChild(imgLabel0);

   imgLabel [_id] = new Image();
   imgLabel [_id].src = imgUrl + Label + "_Selected.png";
}

function InitGame()
{

   /*textHeight = document.body.clientHeight - Panel.style.posHeight - 10;
   document.all.Text.style.posHeight = textHeight;*/


    textHeight = 0;
    Panel = document.getElementById('Panel');
    Fight_window = document.getElementById('Fight_window');
    BlockAllEvents = document.getElementById('BlockAllEvents');

    Agility_value = document.getElementById('Agility_value');
    Strength_value = document.getElementById('Strength_value');
    Charm_value = document.getElementById('Charm_value');
    Luck_value = document.getElementById('Luck_value');
    Gold_value = document.getElementById('Gold_value');


    container_legend = document.getElementById('container_legend');
    container_legend.style.top = textHeight + 110 + 'px';

    var ind_y = textHeight + 12;
    var k = 1;
    var indicator;

   sumLuck = 0;
   for (var i = 0; i < 6; i++) {
      if (i < 5) {
         Inventory [i] = new Array;
         /*for (var j in itemsRusNames [i])
            Inventory [i][itemsRusNames [i][j]] = 0;*/
         var figImg = document.createElement("IMG");
         figImg.style.position = 'absolute';
         figImg.style.visibility = 'hidden';
         ##36$(figImg).tooltip({content: function () {
            return ##36$(this).prop('title');
         }});
         Fight_window.appendChild(figImg);
      }
       do
       {
           indicator = Panel.childNodes [k++];
       }
      while (indicator.tagName != 'DIV');
      indicator.style.top = ind_y + 'px';
      ind_y += 16;

      var Str;
      figureImages [i] = new Image();
      var j = Math.floor(i / 2);
      if (j * 2 == i)
         Str = imgUrl + "Hero_Move";
      else
         Str = imgUrl + "Enemy_Move";
      Str += j + ".bmp";
      figureImages [i].src = Str;
   }

   for (i = 0; i < 4; i++) {
      figureImages [i + 6] = new Image();
      j = Math.floor(i / 2);
      if (j * 2 == i)
         Str = imgUrl + "Hero_";
      else
         Str = imgUrl + "Enemy_";
      if (i < 2)
         Str += "Move3";
      else
         Str += "Hurt";
      Str += ".bmp";
      figureImages [i + 6].src = Str;
   }


   for (i = 0; i < 5; i++) {
      lblStrength [i] = document.createElement("DIV");
      lblStrength [i].style.position = 'absolute';
      lblStrength [i].style.color = 'Yellow';
      lblStrength [i].style.fontWeight = 'bold';
      lblStrength [i].style.visibility = 'hidden';
      Fight_window.appendChild(lblStrength [i]);

      if (i < 3) {
         enemy [i] = new Array(6);
         enemy [i].Agility = 0;
         enemy [i].Strength = 0;
         enemy [i].Power = 0;
         enemy [i].Hurt = false;
         enemy [i].Alive = false;
		 enemy [i].StrengthFactor = 0;
      }
   }

   for (i = 0; i < 2; i++)
      hero [i] = new Array(6);

   for (i = 0; i < 4; i++)
      createLabel("Fight_Label", i);

   setInitial_Parameters();
   init_Containers();
   DisplayStuff();
   Panel.onmousemove = point_on_containers;
   //Panel.addEventListener("mousemove", point_on_containers, false);
}

function PanelClear()
{
    Agility_value.style.display = 'none';
    Strength_value.style.display = 'none';
    Charm_value.style.display = 'none';
    Luck_value.style.display = 'none';
    Gold_value.style.display = 'none';
    Water_value.style.display = 'none';


    var itemIndex = 12;
    for (var i = 0; i < selected_container; i++)
        itemIndex += itemsAmount [i];
    for (i = 0; i < itemsAmount [selected_container]; i++)
        Panel.childNodes [itemIndex++].style.visibility = "hidden";

    imgContainer.style.visibility = "hidden";
    container_legend.innerHTML = "";

    Panel.style.backgroundImage = "url('#quest_path$/Img/Panel_die.bmp')";

    BlockAllEvents.style.display = '';
    BlockAllEvents.style.visibility = 'visible';
    BlockAllEvents.style.zIndex = 1;
}

function PanelShow()
{
   Agility_value.style.display = '';
   Strength_value.style.display = '';
   Charm_value.style.display = '';
   Luck_value.style.display = '';
   Gold_value.style.display = '';
   Water_value.style.display = '';

   Panel.style.backgroundImage = "url('#quest_path$/Img/Panel_temp.bmp')";

   BlockAllEvents.style.display = 'none';

   selected_container = 0;
   highlight_container(selected_container);
}

function nextRandomNumber()
{
   this.seed = (this.seed*9301+49297) % 233280;
   return this.seed/(233280.0);
}

function RandomNumberGenerator()
{
   this.seed = new Date().getTime();
   this.next = nextRandomNumber;
   return this;
}
</appendScript>

<script>
InitGame();
</script>

goto -10
